---
title: "testing formula"
output: html_document
date: "2024-09-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
# Load necessary packages
library(rvest)
library(dplyr)

# Initialize an empty data frame to store all data
all_schedule_data <- data.frame()

# Define months and days to iterate through
months <- c("09", "10")  # September and October

# Loop through each month and day
for(month in months) {
  for(day in 1:31) {  # Use 1 to 31, but not all days will have data
    day_str <- sprintf("%02d", day)  # Format day as two digits
    
    # Define the URL with the current date
    url <- paste0("https://d3s.prestosports.com/sports/msoc/2023-24/schedule?date=2023-", month, "-", day_str)
    
    # Read the HTML content
    page <- read_html(url)
    
    # Extract the table and convert to a data frame
    daily_schedule <- page %>%
      html_node("table") %>%
      html_table(fill = TRUE)
    
    # Check if daily_schedule is NULL or has unnamed columns
    if (!is.null(daily_schedule)) {
      # Rename columns if any are unnamed
      colnames(daily_schedule) <- make.names(colnames(daily_schedule), unique = TRUE)
      
      # Add a date column to the daily data for reference
      daily_schedule <- daily_schedule %>%
        mutate(Date = paste("2023-", month, "-", day_str, sep=""))
      
      # Append the daily data to the cumulative data frame
      all_schedule_data <- rbind(all_schedule_data, daily_schedule)
    }
  }
}

all_schedule_data <- all_schedule_data %>%
  rename(
    away_team_score = X,
    home_team_score = X.1
  )

# Display the complete data frame
print(all_schedule_data)










```
```{r}
library(dplyr) 
library(stringr)
# Update scores for Vanguard vs Whittier
all_schedule_data <- all_schedule_data %>%
  mutate(home_team_score = ifelse(Home == "Vanguard" & Away == "Whittier", 2, home_team_score),
         away_team_score = ifelse(Home == "Vanguard" & Away == "Whittier", 1, away_team_score))

# Update scores for Mount St. Vincent vs Yeshiva
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Mount St. Vincent" & Away == "Yeshiva", 1, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Vincent" & Away == "Yeshiva", 4, away_team_score)
  )

# Update scores for St. Scholastica vs UW-Eau Claire
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "St. Scholastica" & Away == "UW-Eau Claire", 1, home_team_score),
    away_team_score = ifelse(Home == "St. Scholastica" & Away == "UW-Eau Claire", 7, away_team_score)
  )

# Update scores for Southern Virginia vs Dickinson
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Southern Virginia" & Away == "Dickinson", 0, home_team_score),
    away_team_score = ifelse(Home == "Southern Virginia" & Away == "Dickinson", 2, away_team_score)
  )

# Update scores for Messiah vs TCNJ
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Messiah" & Away == "TCNJ", 4, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "TCNJ", 0, away_team_score)
  )

# Update scores for Greensboro vs Hampden-Sydney
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Greensboro" & Away == "Hampden-Sydney", 0, home_team_score),
    away_team_score = ifelse(Home == "Greensboro" & Away == "Hampden-Sydney", 1, away_team_score)
  )

# Update score for Cal Lutheran vs Marymount
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "Marymount", 1, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "Marymount", 0, away_team_score)
  )

# Update score for Carleton vs Northland
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Carleton" & Away == "Northland", 6, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "Northland", 1, away_team_score)
  )

# Update score for Swarthmore vs Rosemont
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Rosemont", 0, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Rosemont", 1, away_team_score)
  )

# Update score for Hanover vs Centre
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Hanover" & Away == "Centre", 2, home_team_score),
    away_team_score = ifelse(Home == "Hanover" & Away == "Centre", 0, away_team_score)
  )

# Update score for Ripon vs Wis. Lutheran (tie)
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Ripon" & Away == "Wis. Lutheran", 1, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Wis. Lutheran", 1, away_team_score)
  )

# Update score for Medgar Evers vs Ursinus
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Medgar Evers" & Away == "Ursinus", 0, home_team_score),
    away_team_score = ifelse(Home == "Medgar Evers" & Away == "Ursinus", 8, away_team_score)
  )

# Update score for Brevard vs Bob Jones (tie)
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Brevard" & Away == "Bob Jones", 1, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Bob Jones", 1, away_team_score)
  )

# Update score for Hood vs Neumann
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Hood" & Away == "Neumann", 0, home_team_score),
    away_team_score = ifelse(Home == "Hood" & Away == "Neumann", 5, away_team_score)
  )

# Update score for Widener vs Coast Guard
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Widener" & Away == "Coast Guard", 2, home_team_score),
    away_team_score = ifelse(Home == "Widener" & Away == "Coast Guard", 1, away_team_score)
  )

# Update score for Stetson vs St. Thomas (Minn.)
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Stetson" & Away == "St. Thomas (Minn.)", 7, home_team_score),
    away_team_score = ifelse(Home == "Stetson" & Away == "St. Thomas (Minn.)", 0, away_team_score)
  )

# Update score for Randolph vs Mary Baldwin
all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Randolph" & Away == "Mary Baldwin", 2, home_team_score),
    away_team_score = ifelse(Home == "Randolph" & Away == "Mary Baldwin", 0, away_team_score)
  )

# Update scores for Pacific (Ore.) games with complete list

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games
    home_team_score = ifelse(Home == "Multnomah" & Away == "Pacific (Ore.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Multnomah" & Away == "Pacific (Ore.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Bushnell" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Bushnell" & Away == "Pacific (Ore.)", 2, away_team_score),
    
    home_team_score = ifelse(Home == "UC Santa Cruz" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "UC Santa Cruz" & Away == "Pacific (Ore.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "George Fox" & Away == "Pacific (Ore.)", 1, home_team_score),
    away_team_score = ifelse(Home == "George Fox" & Away == "Pacific (Ore.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Whitworth" & Away == "Pacific (Ore.)", 3, home_team_score),
    away_team_score = ifelse(Home == "Whitworth" & Away == "Pacific (Ore.)", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Whitman" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Whitman" & Away == "Pacific (Ore.)", 1, away_team_score),
    
    home_team_score = ifelse(Home == "	
Puget Sound" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "	
Puget Sound" & Away == "Pacific (Ore.)", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific Lutheran" & Away == "Pacific (Ore.)", 6, home_team_score),
    away_team_score = ifelse(Home == "Pacific Lutheran" & Away == "Pacific (Ore.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Willamette" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Willamette" & Away == "Pacific (Ore.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Linfield" & Away == "Pacific (Ore.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Linfield" & Away == "Pacific (Ore.)", 2, away_team_score),
    
    # Home games
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Cal Lutheran", 2, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Cal Lutheran", 2, away_team_score),
    
      home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Pacific Lutheran", 1, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Pacific Lutheran", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Lewis & Clark", 4, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Lewis & Clark", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Whitman", 0, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Whitman", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Linfield", 2, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Linfield", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Willamette", 3, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Willamette", 1, away_team_score),

    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "George Fox", 2, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "George Fox", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Whitworth", 0, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Whitworth", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "	
Puget Sound", 0, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "	
Puget Sound", 0, away_team_score)
  )


# Update scores for Carleton games with home/away status
all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Carleton
    home_team_score = ifelse(Home == "Carleton" & Away == "Northland", 6, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "Northland", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "Gustavus Adolphus", 1, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "Gustavus Adolphus", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "North Central (Ill.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "North Central (Ill.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "Simpson", 6, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "Simpson", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "St. Olaf", 0, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "St. Olaf", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "Macalester", 2, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "Macalester", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "Augsburg", 0, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "Augsburg", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Carleton" & Away == "St. Mary's (Minn.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Carleton" & Away == "St. Mary's (Minn.)", 0, away_team_score),

    
    # Away games for Carleton
    home_team_score = ifelse(Home == "Augustana" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Augustana" & Away == "Carleton", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Viterbo" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Viterbo" & Away == "Carleton", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Bethany Lutheran" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Bethany Lutheran" & Away == "Carleton", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Concordia - Moorhead" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Concordia - Moorhead" & Away == "Carleton", 10, away_team_score),
    
    home_team_score = ifelse(Home == "Bethel (Minn.)" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Bethel (Minn.)" & Away == "Carleton", 2, away_team_score),
    
    home_team_score = ifelse(Home == "St. Scholastica" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "St. Scholastica" & Away == "Carleton", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Cornell" & Away == "Carleton", 1, home_team_score),
    away_team_score = ifelse(Home == "Cornell" & Away == "Carleton", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Hamline" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Hamline" & Away == "Carleton", 4, away_team_score),
    
    home_team_score = ifelse(Home == "Saint John's (Minn.)" & Away == "Carleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Saint John's (Minn.)" & Away == "Carleton", 2, away_team_score),
  )
    


# Update scores for Ferrum games with home/away status
# Update scores for Ferrum games with separate mutate calls

all_schedule_data <- all_schedule_data %>%
  # Home games
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Southern Virginia", 2, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Southern Virginia", 0, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Mary Baldwin", 5, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Mary Baldwin", 0, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Randolph", 0, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Randolph", 1, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Virginia Wesleyan", 0, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Virginia Wesleyan", 3, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Roanoke", 0, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Roanoke", 1, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Bridgewater (Va.)", 1, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Bridgewater (Va.)", 3, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Ferrum" & Away == "Guilford", 2, home_team_score),
         away_team_score = ifelse(Home == "Ferrum" & Away == "Guilford", 0, away_team_score)) %>%

  # Away games
  mutate(home_team_score = ifelse(Home == "Pfeiffer" & Away == "Ferrum", 3, home_team_score),
         away_team_score = ifelse(Home == "Pfeiffer" & Away == "Ferrum", 0, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Methodist" & Away == "Ferrum", 2, home_team_score),
         away_team_score = ifelse(Home == "Methodist" & Away == "Ferrum", 0, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Johnson & Wales (NC)" & Away == "Ferrum", 2, home_team_score),
         away_team_score = ifelse(Home == "Johnson & Wales (NC)" & Away == "Ferrum", 1, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Averett" & Away == "Ferrum", 3, home_team_score),
         away_team_score = ifelse(Home == "Averett" & Away == "Ferrum", 2, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Shenandoah" & Away == "Ferrum", 4, home_team_score),
         away_team_score = ifelse(Home == "Shenandoah" & Away == "Ferrum", 3, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Warren Wilson" & Away == "Ferrum", 1, home_team_score),
         away_team_score = ifelse(Home == "Warren Wilson" & Away == "Ferrum", 2, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Ferrum", 2, home_team_score),
         away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Ferrum", 0, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Ferrum", 6, home_team_score),
         away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Ferrum", 0, away_team_score)) %>%
  mutate(home_team_score = ifelse(Home == "Lynchburg" & Away == "Ferrum", 2, home_team_score),
         away_team_score = ifelse(Home == "Lynchburg" & Away == "Ferrum", 1, away_team_score))


# Update scores for Mary Baldwin games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Mary Baldwin
    home_team_score = ifelse(Home == "Randolph" & Away == "Mary Baldwin", 2, home_team_score),
    away_team_score = ifelse(Home == "Randolph" & Away == "Mary Baldwin", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Randolph-Macon" & Away == "Mary Baldwin", 7, home_team_score),
    away_team_score = ifelse(Home == "Randolph-Macon" & Away == "Mary Baldwin", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Ferrum" & Away == "Mary Baldwin", 5, home_team_score),
    away_team_score = ifelse(Home == "Ferrum" & Away == "Mary Baldwin", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Wilson" & Away == "Mary Baldwin", 4, home_team_score),
    away_team_score = ifelse(Home == "Wilson" & Away == "Mary Baldwin", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Mary Baldwin", 5, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Mary Baldwin", 0, away_team_score),
    
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Mary Baldwin", 4, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Mary Baldwin", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Southern Virginia" & Away == "Mary Baldwin", 2, home_team_score),
    away_team_score = ifelse(Home == "Southern Virginia" & Away == "Mary Baldwin", 0, away_team_score),
    
    home_team_score = ifelse(Home == "William Peace" & Away == "Mary Baldwin", 4, home_team_score),
    away_team_score = ifelse(Home == "William Peace" & Away == "Mary Baldwin", 0, away_team_score),
    
    # Home games for Mary Baldwin
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Hampden-Sydney", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Hampden-Sydney", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Lancaster Bible", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Lancaster Bible", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Eastern Mennonite", 1, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Eastern Mennonite", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "St. Mary's (Md.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "St. Mary's (Md.)", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "VMI", 1, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "VMI", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Greensboro", 1, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Greensboro", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Pfeiffer", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Pfeiffer", 1, away_team_score),
    
     home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Methodist", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Methodist", 3, away_team_score),
  )


# Update scores for Ripon games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Ripon
    home_team_score = ifelse(Home == "Ripon" & Away == "Wisconsin Lutheran", 1, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Wisconsin Lutheran", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Buena Vista", 4, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Buena Vista", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Illinois Col.", 1, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Illinois Col.", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Lake Forest", 1, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Lake Forest", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Lakeland", 2, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Lakeland", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Cornell College", 0, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Cornell College", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Maranatha Baptist", 5, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Maranatha Baptist", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Monmouth (Ill.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Monmouth (Ill.)", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Ripon" & Away == "Concordia-Moorhead", 1, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Concordia-Moorhead", 0, away_team_score),

    # Away games for Ripon
    home_team_score = ifelse(Home == "Edgewood" & Away == "Ripon", 0, home_team_score),
    away_team_score = ifelse(Home == "Edgewood" & Away == "Ripon", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Eureka" & Away == "Ripon", 2, home_team_score),
    away_team_score = ifelse(Home == "Eureka" & Away == "Ripon", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Maranatha Baptist" & Away == "Ripon", 0, home_team_score),
    away_team_score = ifelse(Home == "Maranatha Baptist" & Away == "Ripon", 9, away_team_score),
    
    home_team_score = ifelse(Home == "Coe" & Away == "Ripon", 3, home_team_score),
    away_team_score = ifelse(Home == "Coe" & Away == "Ripon", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Grinnell" & Away == "Ripon", 1, home_team_score),
    away_team_score = ifelse(Home == "Grinnell" & Away == "Ripon", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Beloit" & Away == "Ripon", 2, home_team_score),
    away_team_score = ifelse(Home == "Beloit" & Away == "Ripon", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Lawrence" & Away == "Ripon", 1, home_team_score),
    away_team_score = ifelse(Home == "Lawrence" & Away == "Ripon", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Knox" & Away == "Ripon", 1, home_team_score),
    away_team_score = ifelse(Home == "Knox" & Away == "Ripon", 1, away_team_score)
  )

# Update scores for Swarthmore games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Swarthmore
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Rosemont", 0, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Rosemont", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Coast Guard", 2, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Coast Guard", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Widener", 0, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Widener", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Gettysburg", 1, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Gettysburg", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Washington (Md.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Washington (Md.)", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "New Jersey City", 2, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "New Jersey City", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Misericordia", 2, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Misericordia", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Dickinson", 2, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Dickinson", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Swarthmore" & Away == "McDaniel", 3, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "McDaniel", 2, away_team_score),

    # Away games for Swarthmore
    home_team_score = ifelse(Home == "Kean" & Away == "Swarthmore", 1, home_team_score),
    away_team_score = ifelse(Home == "Kean" & Away == "Swarthmore", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Wilkes" & Away == "Swarthmore", 1, home_team_score),
    away_team_score = ifelse(Home == "Wilkes" & Away == "Swarthmore", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Franklin and Marshall" & Away == "Swarthmore", 1, home_team_score),
    away_team_score = ifelse(Home == "Franklin and Marshall" & Away == "Swarthmore", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Johns Hopkins" & Away == "Swarthmore", 4, home_team_score),
    away_team_score = ifelse(Home == "Johns Hopkins" & Away == "Swarthmore", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Ursinus" & Away == "Swarthmore", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Swarthmore", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Muhlenberg" & Away == "Swarthmore", 0, home_team_score),
    away_team_score = ifelse(Home == "Muhlenberg" & Away == "Swarthmore", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Haverford" & Away == "Swarthmore", 0, home_team_score),
    away_team_score = ifelse(Home == "Haverford" & Away == "Swarthmore", 2, away_team_score),
  )

# Update scores for Union College games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Union
    home_team_score = ifelse(Home == "Union" & Away == "SUNY Oneonta", 0, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "SUNY Oneonta", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Western New England", 3, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Western New England", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "	Mass-Boston", 2, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "	Mass-Boston", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Albany College of Pharmacy and Health Sciences", 9, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Albany College of Pharmacy and Health Sciences", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Vassar", 1, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Vassar", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Elmira", 5, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Elmira", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Ithaca", 2, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Ithaca", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Hobart", 0, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Hobart", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Union" & Away == "Skidmore", 1, home_team_score),
    away_team_score = ifelse(Home == "Union" & Away == "Skidmore", 0, away_team_score),
    
    # Away games for Union
    home_team_score = ifelse(Home == "SUNY New Paltz" & Away == "Union", 1, home_team_score),
    away_team_score = ifelse(Home == "SUNY New Paltz" & Away == "Union", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Plattsburgh State" & Away == "Union", 2, home_team_score),
    away_team_score = ifelse(Home == "Plattsburgh State" & Away == "Union", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Williams" & Away == "Union", 2, home_team_score),
    away_team_score = ifelse(Home == "Williams" & Away == "Union", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Moravian" & Away == "Union", 0, home_team_score),
    away_team_score = ifelse(Home == "Moravian" & Away == "Union", 0, away_team_score),
    
    home_team_score = ifelse(Home == "RPI" & Away == "Union", 1, home_team_score),
    away_team_score = ifelse(Home == "RPI" & Away == "Union", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Bard" & Away == "Union", 0, home_team_score),
    away_team_score = ifelse(Home == "Bard" & Away == "Union", 2, away_team_score),
    
    home_team_score = ifelse(Home == "St. Lawrence" & Away == "Union", 1, home_team_score),
    away_team_score = ifelse(Home == "St. Lawrence" & Away == "Union", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Rochester Tech" & Away == "Union", 2, home_team_score),
    away_team_score = ifelse(Home == "Rochester Tech" & Away == "Union", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Clarkson" & Away == "Union", 1, home_team_score),
    away_team_score = ifelse(Home == "Clarkson" & Away == "Union", 1, away_team_score)
  )


# Update scores for Brevard games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Brevard
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Bob Jones", 1, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Bob Jones", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Warren Wilson", 2, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Warren Wilson", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Carolina University", 0, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Carolina University", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Washington and Lee", 2, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Washington and Lee", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Southern Virginia", 0, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Southern Virginia", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Mary Baldwin", 5, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Mary Baldwin", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Brevard" & Away == "Methodist", 1, home_team_score),
    away_team_score = ifelse(Home == "Brevard" & Away == "Methodist", 2, away_team_score),
    
    # Away games for Brevard
    home_team_score = ifelse(Home == "Berea" & Away == "Brevard", 1, home_team_score),
    away_team_score = ifelse(Home == "Berea" & Away == "Brevard", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Maryville (Tenn.)" & Away == "Brevard", 1, home_team_score),
    away_team_score = ifelse(Home == "Maryville (Tenn.)" & Away == "Brevard", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Emory" & Away == "Brevard", 2, home_team_score),
    away_team_score = ifelse(Home == "Emory" & Away == "Brevard", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Brevard", 4, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Brevard", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Johnson & Wales (NC)" & Away == "Brevard", 3, home_team_score),
    away_team_score = ifelse(Home == "Johnson & Wales (NC)" & Away == "Brevard", 2, away_team_score),
    
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Brevard", 6, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Brevard", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Warren Wilson" & Away == "Brevard", 0, home_team_score),
    away_team_score = ifelse(Home == "Warren Wilson" & Away == "Brevard", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Greensboro" & Away == "Brevard", 0, home_team_score),
    away_team_score = ifelse(Home == "Greensboro" & Away == "Brevard", 1, away_team_score),
    
    home_team_score = ifelse(Home == "William Peace" & Away == "Brevard", 2, home_team_score),
    away_team_score = ifelse(Home == "William Peace" & Away == "Brevard", 0, away_team_score)
  )


# Update scores for Bryn Athyn games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Bryn Athyn
    home_team_score = ifelse(Home == "Bryn Athyn" & Away == "Albright", 1, home_team_score),
    away_team_score = ifelse(Home == "Bryn Athyn" & Away == "Albright", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Bryn Athyn" & Away == "Penn State Abington", 1, home_team_score),
    away_team_score = ifelse(Home == "Bryn Athyn" & Away == "Penn State Abington", 6, away_team_score),
    
    home_team_score = ifelse(Home == "Bryn Athyn" & Away == "John Jay", 4, home_team_score),
    away_team_score = ifelse(Home == "Bryn Athyn" & Away == "John Jay", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Bryn Athyn" & Away == "St. Elizabeth", 1, home_team_score),
    away_team_score = ifelse(Home == "Bryn Athyn" & Away == "St. Elizabeth", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Bryn Athyn" & Away == "Cairn", 0, home_team_score),
    away_team_score = ifelse(Home == "Bryn Athyn" & Away == "Cairn", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Bryn Athyn" & Away == "Summit", 4, home_team_score),
    away_team_score = ifelse(Home == "Bryn Athyn" & Away == "Summit", 1, away_team_score),
  
    
    # Away games for Bryn Athyn
    home_team_score = ifelse(Home == "Delaware Valley" & Away == "Bryn Athyn", 4, home_team_score),
    away_team_score = ifelse(Home == "Delaware Valley" & Away == "Bryn Athyn", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Gwynedd Mercy" & Away == "Bryn Athyn", 1, home_team_score),
    away_team_score = ifelse(Home == "Gwynedd Mercy" & Away == "Bryn Athyn", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Wilson" & Away == "Bryn Athyn", 0, home_team_score),
    away_team_score = ifelse(Home == "Wilson" & Away == "Bryn Athyn", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Notre Dame (Md.)" & Away == "Bryn Athyn", 0, home_team_score),
    away_team_score = ifelse(Home == "Notre Dame (Md.)" & Away == "Bryn Athyn", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Ursinus" & Away == "Bryn Athyn", 3, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Bryn Athyn", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Keystone" & Away == "Bryn Athyn", 3, home_team_score),
    away_team_score = ifelse(Home == "Keystone" & Away == "Bryn Athyn", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Rosemont" & Away == "Bryn Athyn", 7, home_team_score),
    away_team_score = ifelse(Home == "Rosemont" & Away == "Bryn Athyn", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Valley Forge" & Away == "Bryn Athyn", 0, home_team_score),
    away_team_score = ifelse(Home == "Valley Forge" & Away == "Bryn Athyn", 2, away_team_score)
  )

# Update scores for Lewis & Clark games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Lewis & Clark
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Caltech", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Caltech", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Bushnell", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Bushnell", 4, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Linfield", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Linfield", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Puget Sound", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Puget Sound", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "George Fox", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "George Fox", 4, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Pacific Lutheran", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Pacific Lutheran", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Willamette", 2, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Willamette", 4, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Pacific (Ore.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Pacific (Ore.)", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Lewis & Clark" & Away == "Whitman", 1, home_team_score),
    away_team_score = ifelse(Home == "Lewis & Clark" & Away == "Whitman", 4, away_team_score),
    

    
    # Away games for Lewis & Clark
    home_team_score = ifelse(Home == "Occidental" & Away == "Lewis & Clark", 5, home_team_score),
    away_team_score = ifelse(Home == "Occidental" & Away == "Lewis & Clark", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Whittier" & Away == "Lewis & Clark", 5, home_team_score),
    away_team_score = ifelse(Home == "Whittier" & Away == "Lewis & Clark", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific" & Away == "Lewis & Clark", 4, home_team_score),
    away_team_score = ifelse(Home == "Pacific" & Away == "Lewis & Clark", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Whitworth" & Away == "Lewis & Clark", 6, home_team_score),
    away_team_score = ifelse(Home == "Whitworth" & Away == "Lewis & Clark", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Whitman" & Away == "Lewis & Clark", 7, home_team_score),
    away_team_score = ifelse(Home == "Whitman" & Away == "Lewis & Clark", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Willamette" & Away == "Lewis & Clark", 4, home_team_score),
    away_team_score = ifelse(Home == "Willamette" & Away == "Lewis & Clark", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Linfield" & Away == "Lewis & Clark", 5, home_team_score),
    away_team_score = ifelse(Home == "Linfield" & Away == "Lewis & Clark", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Puget Sound" & Away == "Lewis & Clark", 3, home_team_score),
    away_team_score = ifelse(Home == "Puget Sound" & Away == "Lewis & Clark", 1, away_team_score),
    
    home_team_score = ifelse(Home == "George Fox" & Away == "Lewis & Clark", 0, home_team_score),
    away_team_score = ifelse(Home == "George Fox" & Away == "Lewis & Clark", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Pacific Lutheran" & Away == "Lewis & Clark", 5, home_team_score),
    away_team_score = ifelse(Home == "Pacific Lutheran" & Away == "Lewis & Clark", 0, away_team_score)
  )


# Update scores for Neumann games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Neumann
    home_team_score = ifelse(Home == "Neumann" & Away == "Rutgers-Camden", 0, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Rutgers-Camden", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Neumann" & Away == "Widener", 1, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Widener", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Neumann" & Away == "Penn St.-Abington", 1, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Penn St.-Abington", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Neumann" & Away == "Centenary (N.J.)", 4, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Centenary (N.J.)", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Neumann" & Away == "Marywood", 1, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Marywood", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Neumann" & Away == "Penn St.-Schuylkill", 7, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Penn St.-Schuylkill", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Neumann" & Away == "Immaculata", 0, home_team_score),
    away_team_score = ifelse(Home == "Neumann" & Away == "Immaculata", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Cabrini" & Away == "Neumann", 1, home_team_score),
    away_team_score = ifelse(Home == "Cabrini" & Away == "Neumann", 0, away_team_score),

    # Away games for Neumann
    home_team_score = ifelse(Home == "Hood" & Away == "Neumann", 0, home_team_score),
    away_team_score = ifelse(Home == "Hood" & Away == "Neumann", 5, away_team_score),
    
    home_team_score = ifelse(Home == "Lancaster Bible" & Away == "Neumann", 1, home_team_score),
    away_team_score = ifelse(Home == "Lancaster Bible" & Away == "Neumann", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Eastern" & Away == "Neumann", 1, home_team_score),
    away_team_score = ifelse(Home == "Eastern" & Away == "Neumann", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Gwynedd Mercy" & Away == "Neumann", 1, home_team_score),
    away_team_score = ifelse(Home == "Gwynedd Mercy" & Away == "Neumann", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Marymount" & Away == "Neumann", 2, home_team_score),
    away_team_score = ifelse(Home == "Marymount" & Away == "Neumann", 2, away_team_score),
  )

# Update scores for Roanoke games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Roanoke
    home_team_score = ifelse(Home == "Roanoke" & Away == "Oglethorpe", 1, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Oglethorpe", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Covenant", 2, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Covenant", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Greensboro", 2, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Greensboro", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Eastern Mennonite", 1, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Eastern Mennonite", 2, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Lynchburg", 1, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Lynchburg", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Hampden-Sydney", 1, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Hampden-Sydney", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Shenandoah", 2, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Shenandoah", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Roanoke" & Away == "Randolph", 3, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Randolph", 1, away_team_score),

    # Away games for Roanoke
    home_team_score = ifelse(Home == "Denison" & Away == "Roanoke", 2, home_team_score),
    away_team_score = ifelse(Home == "Denison" & Away == "Roanoke", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Capital" & Away == "Roanoke", 2, home_team_score),
    away_team_score = ifelse(Home == "Capital" & Away == "Roanoke", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Marietta" & Away == "Roanoke", 0, home_team_score),
    away_team_score = ifelse(Home == "Marietta" & Away == "Roanoke", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Washington and Lee" & Away == "Roanoke", 2, home_team_score),
    away_team_score = ifelse(Home == "Washington and Lee" & Away == "Roanoke", 3, away_team_score),
    
    home_team_score = ifelse(Home == "Christopher Newport" & Away == "Roanoke", 2, home_team_score),
    away_team_score = ifelse(Home == "Christopher Newport" & Away == "Roanoke", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Roanoke", 2, home_team_score),
    away_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Roanoke", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Ferrum" & Away == "Roanoke", 0, home_team_score),
    away_team_score = ifelse(Home == "Ferrum" & Away == "Roanoke", 1, away_team_score),
    
    home_team_score = ifelse(Home == "Randolph-Macon" & Away == "Roanoke", 1, home_team_score),
    away_team_score = ifelse(Home == "Randolph-Macon" & Away == "Roanoke", 0, away_team_score),
    
    home_team_score = ifelse(Home == "Averett" & Away == "Roanoke", 4, home_team_score),
    away_team_score = ifelse(Home == "Averett" & Away == "Roanoke", 2, away_team_score),
  )

# Update scores for Rockford games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Rockford
    home_team_score = ifelse(Home == "Rockford" & Away == "UW-Whitewater", 0, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "UW-Whitewater", 2, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Eureka", 3, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Eureka", 4, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Monmouth (Ill.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Monmouth (Ill.)", 0, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Concordia-Chicago", 1, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Concordia-Chicago", 0, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Wis. Lutheran", 1, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Wis. Lutheran", 0, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Edgewood", 1, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Edgewood", 0, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Marian", 1, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Marian", 1, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Rockford" & Away == "Benedictine", 1, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Benedictine", 0, away_team_score),
    home_team_score = ifelse(Home == "Rockford" & Away == "Milwaukee Engineering", 1, home_team_score),
    away_team_score = ifelse(Home == "Rockford" & Away == "Milwaukee Engineering", 6, away_team_score),

    # Away games for Rockford
    home_team_score = ifelse(Home == "Blackburn" & Away == "Rockford", 1, home_team_score),
    away_team_score = ifelse(Home == "Blackburn" & Away == "Rockford", 0, away_team_score),
    home_team_score = ifelse(Home == "Principia" & Away == "Rockford", 2, home_team_score),
    away_team_score = ifelse(Home == "Principia" & Away == "Rockford", 0, away_team_score),
    home_team_score = ifelse(Home == "CConcordia (Wis.)" & Away == "Rockford", 3, home_team_score),
    away_team_score = ifelse(Home == "Concordia (Wis.)" & Away == "Rockford", 2, away_team_score),
    home_team_score = ifelse(Home == "Aurora" & Away == "Rockford", 4, home_team_score),
    away_team_score = ifelse(Home == "Aurora" & Away == "Rockford", 0, away_team_score),
    home_team_score = ifelse(Home == "St. Norbert" & Away == "Rockford", 3, home_team_score),
    away_team_score = ifelse(Home == "St. Norbert" & Away == "Rockford", 0, away_team_score),
    home_team_score = ifelse(Home == "Dominican" & Away == "Rockford", 3, home_team_score),
    away_team_score = ifelse(Home == "Dominican" & Away == "Rockford", 0, away_team_score),
    home_team_score = ifelse(Home == "Lakeland" & Away == "Rockford", 0, home_team_score),
    away_team_score = ifelse(Home == "Lakeland" & Away == "Rockford", 1, away_team_score),
    home_team_score = ifelse(Home == "Illinois Tech" & Away == "Rockford", 1, home_team_score),
    away_team_score = ifelse(Home == "Illinois Tech" & Away == "Rockford", 0, away_team_score),
  )

# Update scores for Chapman games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Chapman
    home_team_score = ifelse(Home == "Chapman" & Away == "St. Katherine", 2, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "St. Katherine", 0, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Stanton", 4, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Stanton", 2, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Bethesda University", 2, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Bethesda University", 1, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Redlands", 1, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Redlands", 2, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Claremont-Mudd-Scripps", 1, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Claremont-Mudd-Scripps", 0, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "UC Santa Cruz", 0, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "UC Santa Cruz", 1, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Occidental", 0, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Occidental", 0, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Chapman" & Away == "Whittier", 3, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Whittier", 1, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Caltech", 1, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Caltech", 0, away_team_score),
    home_team_score = ifelse(Home == "Chapman" & Away == "Pomona-Pitzer", 2, home_team_score),
    away_team_score = ifelse(Home == "Chapman" & Away == "Pomona-Pitzer", 2, away_team_score),  # Tie

    # Away games for Chapman
    home_team_score = ifelse(Home == "Hope Int'l" & Away == "Chapman", 1, home_team_score),
    away_team_score = ifelse(Home == "Hope Int'l" & Away == "Chapman", 0, away_team_score),
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "Chapman", 3, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "Chapman", 1, away_team_score),
    home_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Chapman", 2, home_team_score),
    away_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Chapman", 2, away_team_score),  # Tie
    home_team_score = ifelse(Home == "La Verne" & Away == "Chapman", 1, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Chapman", 1, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Caltech" & Away == "Chapman", 2, home_team_score),
    away_team_score = ifelse(Home == "Caltech" & Away == "Chapman", 2, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Redlands" & Away == "Chapman", 5, home_team_score),
    away_team_score = ifelse(Home == "Redlands" & Away == "Chapman", 0, away_team_score)
  )

# Update scores for Farmingdale State games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Farmingdale State
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Lehman", 3, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Lehman", 0, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Eastern", 1, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Eastern", 4, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Hunter", 5, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Hunter", 0, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "St. Joseph's (Brkln)", 4, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "St. Joseph's (Brkln)", 0, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Mount St. Mary", 4, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Mount St. Mary", 1, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "SUNY-Old Westbury", 6, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "SUNY-Old Westbury", 1, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Manhattanville", 1, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Manhattanville", 2, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Brooklyn", 7, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Brooklyn", 1, away_team_score),
    home_team_score = ifelse(Home == "Farmingdale State" & Away == "Maritime (N.Y.)", 3, home_team_score),
    away_team_score = ifelse(Home == "Farmingdale State" & Away == "Maritime (N.Y.)", 0, away_team_score),

    # Away games for Farmingdale State
    home_team_score = ifelse(Home == "Eastern Connecticut" & Away == "Farmingdale State", 2, home_team_score),
    away_team_score = ifelse(Home == "Eastern Connecticut" & Away == "Farmingdale State", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Yeshiva" & Away == "Farmingdale State", 0, home_team_score), 
    away_team_score = ifelse(Home == "Yeshiva" & Away == "Farmingdale State", 1, away_team_score),
    home_team_score = ifelse(Home == "Oneonta State" & Away == "Farmingdale State", 3, home_team_score),
    away_team_score = ifelse(Home == "Oneonta State" & Away == "Farmingdale State", 0, away_team_score),
    home_team_score = ifelse(Home == "Merchant Marine" & Away == "Farmingdale State", 1, home_team_score),
    away_team_score = ifelse(Home == "Merchant Marine" & Away == "Farmingdale State", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Purchase" & Away == "Farmingdale State", 3, home_team_score),
    away_team_score = ifelse(Home == "Purchase" & Away == "Farmingdale State", 1, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Vincent" & Away == "Farmingdale State", 1, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Vincent" & Away == "Farmingdale State", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Sarah Lawrence" & Away == "Farmingdale State", 2, home_team_score),
    away_team_score = ifelse(Home == "Sarah Lawrence" & Away == "Farmingdale State", 0, away_team_score),
    home_team_score = ifelse(Home == "St. Joseph's (L.I.)" & Away == "Farmingdale State", 0, home_team_score),
    away_team_score = ifelse(Home == "St. Joseph's (L.I.)" & Away == "Farmingdale State", 0, away_team_score) # Tie
  )

# Update scores for Catholic games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Catholic
    home_team_score = ifelse(Home == "Catholic" & Away == "Shenandoah", 2, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Shenandoah", 1, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Messiah", 0, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Messiah", 4, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Randolph-Macon", 3, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Randolph-Macon", 0, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Moravian", 1, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Moravian", 0, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Susquehanna", 3, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Susquehanna", 0, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Drew", 3, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Drew", 1, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Lycoming", 1, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Lycoming", 1, away_team_score),
    home_team_score = ifelse(Home == "Catholic" & Away == "Goucher", 6, home_team_score),
    away_team_score = ifelse(Home == "Catholic" & Away == "Goucher", 1, away_team_score),


    # Away games for Catholic
    home_team_score = ifelse(Home == "Cortland State" & Away == "Catholic", 2, home_team_score),
    away_team_score = ifelse(Home == "Cortland State" & Away == "Catholic", 1, away_team_score),
    home_team_score = ifelse(Home == "Emory" & Away == "Catholic", 3, home_team_score),
    away_team_score = ifelse(Home == "Emory" & Away == "Catholic", 1, away_team_score),
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Catholic", 0, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Catholic", 3, away_team_score),
    home_team_score = ifelse(Home == "Gettysburg" & Away == "Catholic", 2, home_team_score),
    away_team_score = ifelse(Home == "Gettysburg" & Away == "Catholic", 0, away_team_score),
    home_team_score = ifelse(Home == "Marymount" & Away == "Catholic", 3, home_team_score),
    away_team_score = ifelse(Home == "Marymount" & Away == "Catholic", 2, away_team_score),
    home_team_score = ifelse(Home == "Scranton" & Away == "Catholic", 1, home_team_score),
    away_team_score = ifelse(Home == "Scranton" & Away == "Catholic", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Catholic", 1, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Catholic", 2, away_team_score),
    home_team_score = ifelse(Home == "Wilkes" & Away == "Catholic", 1, home_team_score),
    away_team_score = ifelse(Home == "Wilkes" & Away == "Catholic", 4, away_team_score),
    home_team_score = ifelse(Home == "Mary Washington" & Away == "Catholic", 1, home_team_score),
    away_team_score = ifelse(Home == "Mary Washington" & Away == "Catholic", 0, away_team_score),
    home_team_score = ifelse(Home == "Juniata" & Away == "Catholic", 0, home_team_score),
    away_team_score = ifelse(Home == "Juniata" & Away == "Catholic", 4, away_team_score)
  )


# Update scores for Eastern Mennonite games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Eastern Mennonite
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "McDaniel", 0, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "McDaniel", 0, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Wilson", 1, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Wilson", 0, away_team_score),
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Averett", 0, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Averett", 0, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Randolph-Macon", 2, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Randolph-Macon", 2, away_team_score),  
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Randolph", 1, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Randolph", 0, away_team_score),
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Ferrum", 6, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Ferrum", 0, away_team_score),
    home_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Hampden-Sydney", 1, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Hampden-Sydney", 4, away_team_score),

    # Away games for Eastern Mennonite
    home_team_score = ifelse(Home == "Eastern" & Away == "Eastern Mennonite", 2, home_team_score),
    away_team_score = ifelse(Home == "Eastern" & Away == "Eastern Mennonite", 1, away_team_score),
    home_team_score = ifelse(Home == "Hood" & Away == "Eastern Mennonite", 0, home_team_score),
    away_team_score = ifelse(Home == "Hood" & Away == "Eastern Mennonite", 2, away_team_score),
    home_team_score = ifelse(Home == "Southern Virginia" & Away == "Eastern Mennonite", 3, home_team_score),
    away_team_score = ifelse(Home == "Southern Virginia" & Away == "Eastern Mennonite", 2, away_team_score),
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Eastern Mennonite", 1, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Eastern Mennonite", 3, away_team_score),
    home_team_score = ifelse(Home == "Roanoke" & Away == "Eastern Mennonite", 1, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Eastern Mennonite", 2, away_team_score),
    home_team_score = ifelse(Home == "Guilford" & Away == "Eastern Mennonite", 0, home_team_score),
    away_team_score = ifelse(Home == "Guilford" & Away == "Eastern Mennonite", 2, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Eastern Mennonite", 3, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Eastern Mennonite", 0, away_team_score),
    home_team_score = ifelse(Home == "Marymount" & Away == "Eastern Mennonite", 4, home_team_score),
    away_team_score = ifelse(Home == "Marymount" & Away == "Eastern Mennonite", 1, away_team_score),
    home_team_score = ifelse(Home == "Shenandoah" & Away == "Eastern Mennonite", 2, home_team_score),
    away_team_score = ifelse(Home == "Shenandoah" & Away == "Eastern Mennonite", 1, away_team_score),
    home_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Eastern Mennonite", 1, home_team_score),
    away_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Eastern Mennonite", 1, away_team_score) 
  )

# Update scores for UW-Eau Claire games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for UW-Eau Claire
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Northland", 7, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Northland", 0, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Beloit", 5, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Beloit", 0, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Simpson", 5, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Simpson", 0, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Northern Mich.", 1, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Northern Mich.", 0, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Bethel (Minn.)", 4, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Bethel (Minn.)", 0, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "St. Olaf", 0, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "St. Olaf", 1, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "UW-Whitewater", 2, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "UW-Whitewater", 3, away_team_score),
    home_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Luther", 5, home_team_score),
    away_team_score = ifelse(Home == "UW-Eau Claire" & Away == "Luther", 2, away_team_score),

    # Away games for UW-Eau Claire
    home_team_score = ifelse(Home == "St. Scholastica" & Away == "UW-Eau Claire", 1, home_team_score),
    away_team_score = ifelse(Home == "St. Scholastica" & Away == "UW-Eau Claire", 7, away_team_score),
    home_team_score = ifelse(Home == "UW-Superior" & Away == "UW-Eau Claire", 1, home_team_score),
    away_team_score = ifelse(Home == "UW-Superior" & Away == "UW-Eau Claire", 1, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Macalester" & Away == "UW-Eau Claire", 0, home_team_score),
    away_team_score = ifelse(Home == "Macalester" & Away == "UW-Eau Claire", 0, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Chicago" & Away == "UW-Eau Claire", 4, home_team_score),
    away_team_score = ifelse(Home == "Chicago" & Away == "UW-Eau Claire", 1, away_team_score),
    home_team_score = ifelse(Home == "Crown (Minn.)" & Away == "UW-Eau Claire", 0, home_team_score),
    away_team_score = ifelse(Home == "Crown (Minn.)" & Away == "UW-Eau Claire", 5, away_team_score),
    home_team_score = ifelse(Home == "Edgewood" & Away == "UW-Eau Claire", 1, home_team_score),
    away_team_score = ifelse(Home == "Edgewood" & Away == "UW-Eau Claire", 5, away_team_score),
    home_team_score = ifelse(Home == "Dubuque" & Away == "UW-Eau Claire", 0, home_team_score),
    away_team_score = ifelse(Home == "Dubuque" & Away == "UW-Eau Claire", 2, away_team_score),
    home_team_score = ifelse(Home == "Hamline" & Away == "UW-Eau Claire", 0, home_team_score),
    away_team_score = ifelse(Home == "Hamline" & Away == "UW-Eau Claire", 3, away_team_score),
    home_team_score = ifelse(Home == "Wis.-Platteville" & Away == "UW-Eau Claire", 4, home_team_score),
    away_team_score = ifelse(Home == "Wis.-Platteville" & Away == "UW-Eau Claire", 2, away_team_score)
  )

# Update scores for Ursinus games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Ursinus
    home_team_score = ifelse(Home == "Ursinus" & Away == "Immaculata", 5, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Immaculata", 2, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Rosemont", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Rosemont", 0, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "King's (Pa.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "King's (Pa.)", 0, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Johns Hopkins", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Johns Hopkins", 0, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Muhlenberg", 0, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Muhlenberg", 1, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Swarthmore", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Swarthmore", 1, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Haverford" & Away == "Ursinus", 2, home_team_score),
    away_team_score = ifelse(Home == "Haverford" & Away == "Ursinus", 0, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Franklin and Marshall", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Franklin and Marshall", 3, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Delaware Valley", 2, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Delaware Valley", 0, away_team_score),
    home_team_score = ifelse(Home == "Ursinus" & Away == "Dickinson", 1, home_team_score),
    away_team_score = ifelse(Home == "Ursinus" & Away == "Dickinson", 4, away_team_score),

    # Away games for Ursinus
    home_team_score = ifelse(Home == "Medgar Evers" & Away == "Ursinus", 0, home_team_score),
    away_team_score = ifelse(Home == "Medgar Evers" & Away == "Ursinus", 8, away_team_score),
    home_team_score = ifelse(Home == "Penn St.-Berks" & Away == "Ursinus", 0, home_team_score),
    away_team_score = ifelse(Home == "Penn St.-Berks" & Away == "Ursinus", 9, away_team_score),
    home_team_score = ifelse(Home == "McDaniel" & Away == "Ursinus", 4, home_team_score),
    away_team_score = ifelse(Home == "McDaniel" & Away == "Ursinus", 1, away_team_score),
    home_team_score = ifelse(Home == "Washington College" & Away == "Ursinus", 2, home_team_score),
    away_team_score = ifelse(Home == "Washington College" & Away == "Ursinus", 0, away_team_score),
    home_team_score = ifelse(Home == "Moravian" & Away == "Ursinus", 3, home_team_score),
    away_team_score = ifelse(Home == "Moravian" & Away == "Ursinus", 3, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Gettysburg" & Away == "Ursinus", 2, home_team_score),
    away_team_score = ifelse(Home == "Gettysburg" & Away == "Ursinus", 1, away_team_score)
  )

# Update scores for Howard Payne games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Howard Payne
    home_team_score = ifelse(Home == "Howard Payne" & Away == "Dallas Christian", 1, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "Dallas Christian", 2, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "University of Dallas", 3, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "University of Dallas", 2, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "Lyon", 0, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "Lyon", 1, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "Texas Lutheran", 0, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "Texas Lutheran", 2, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "Mary Hardin-Baylor", 1, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "Mary Hardin-Baylor", 3, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "Concordia (Tex.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "Concordia (Tex.)", 1, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "Sul Ross St.", 2, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "Sul Ross St.", 2, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Howard Payne" & Away == "LeTourneau", 3, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "LeTourneau", 1, away_team_score),
    home_team_score = ifelse(Home == "Howard Payne" & Away == "East Tex. Baptist", 0, home_team_score),
    away_team_score = ifelse(Home == "Howard Payne" & Away == "East Tex. Baptist", 3, away_team_score),

    # Away games for Howard Payne
    home_team_score = ifelse(Home == "Southwestern Assemblies of God University" & Away == "Howard Payne", 4, home_team_score),
    away_team_score = ifelse(Home == "Southwestern Assemblies of God University" & Away == "Howard Payne", 0, away_team_score),
    home_team_score = ifelse(Home == "Schreiner" & Away == "Howard Payne", 2, home_team_score),
    away_team_score = ifelse(Home == "Schreiner" & Away == "Howard Payne", 1, away_team_score),
    home_team_score = ifelse(Home == "Centenary (La.)" & Away == "Howard Payne", 3, home_team_score),
    away_team_score = ifelse(Home == "Centenary (La.)" & Away == "Howard Payne", 2, away_team_score),
    home_team_score = ifelse(Home == "Texas-Dallas" & Away == "Howard Payne", 1, home_team_score),
    away_team_score = ifelse(Home == "Texas-Dallas" & Away == "Howard Payne", 0, away_team_score),
    home_team_score = ifelse(Home == "Ozarks (Ark.)" & Away == "Howard Payne", 2, home_team_score),
    away_team_score = ifelse(Home == "Ozarks (Ark.)" & Away == "Howard Payne", 1, away_team_score),
    home_team_score = ifelse(Home == "McMurry" & Away == "Howard Payne", 0, home_team_score),
    away_team_score = ifelse(Home == "McMurry" & Away == "Howard Payne", 0, away_team_score),  # Tie
    home_team_score = ifelse(Home == "Hardin-Simmons" & Away == "Howard Payne", 2, home_team_score),
    away_team_score = ifelse(Home == "Hardin-Simmons" & Away == "Howard Payne", 0, away_team_score)
  )

# Update scores for Mount St. Joseph games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Mount St. Joseph
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Boyce College", 2, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Boyce College", 7, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Berea", 1, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Berea", 3, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Ohio Christian", 3, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Ohio Christian", 0, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Asbury", 2, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Asbury", 3, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "UC Clermont", 0, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "UC Clermont", 3, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Franklin", 0, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Franklin", 4, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Bluffton", 4, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Bluffton", 2, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Earlham", 1, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Earlham", 2, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Hanover", 1, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Hanover", 3, away_team_score),

    # Away games for Mount St. Joseph
    home_team_score = ifelse(Home == "Maryville (Tenn.)" & Away == "Mount St. Joseph", 2, home_team_score),
    away_team_score = ifelse(Home == "Maryville (Tenn.)" & Away == "Mount St. Joseph", 0, away_team_score),
    home_team_score = ifelse(Home == "Covenant" & Away == "Mount St. Joseph", 4, home_team_score),
    away_team_score = ifelse(Home == "Covenant" & Away == "Mount St. Joseph", 0, away_team_score),
    home_team_score = ifelse(Home == "Olivet" & Away == "Mount St. Joseph", 3, home_team_score),
    away_team_score = ifelse(Home == "Olivet" & Away == "Mount St. Joseph", 1, away_team_score),
    home_team_score = ifelse(Home == "Rose-Hulman" & Away == "Mount St. Joseph", 6, home_team_score),
    away_team_score = ifelse(Home == "Rose-Hulman" & Away == "Mount St. Joseph", 0, away_team_score),
    home_team_score = ifelse(Home == "Transylvania" & Away == "Mount St. Joseph", 7, home_team_score),
    away_team_score = ifelse(Home == "Transylvania" & Away == "Mount St. Joseph", 0, away_team_score),
    home_team_score = ifelse(Home == "Anderson" & Away == "Mount St. Joseph", 3, home_team_score),
    away_team_score = ifelse(Home == "Anderson" & Away == "Mount St. Joseph", 1, away_team_score),
    home_team_score = ifelse(Home == "Manchester" & Away == "Mount St. Joseph", 4, home_team_score),
    away_team_score = ifelse(Home == "Manchester" & Away == "Mount St. Joseph", 0, away_team_score),
    home_team_score = ifelse(Home == "Defiance" & Away == "Mount St. Joseph", 8, home_team_score),
    away_team_score = ifelse(Home == "Defiance" & Away == "Mount St. Joseph", 0, away_team_score)
  )

# Update scores for N.C. Wesleyan games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for N.C. Wesleyan
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Bethany (W.V.)", 3, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Bethany (W.V.)", 1, away_team_score),
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Randolph", 2, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Randolph", 1, away_team_score),
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Pfeiffer", 2, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Pfeiffer", 1, away_team_score),
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "William Peace", 2, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "William Peace", 1, away_team_score),
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Brevard", 6, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Brevard", 0, away_team_score),
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Mary Baldwin", 4, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Mary Baldwin", 1, away_team_score),

    # Away games for N.C. Wesleyan
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Johns Hopkins", 1, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Johns Hopkins", 1, away_team_score),
    home_team_score = ifelse(Home == "RPI" & Away == "N.C. Wesleyan", 2, home_team_score),
    away_team_score = ifelse(Home == "RPi" & Away == "N.C. Wesleyan", 2, away_team_score),
    home_team_score = ifelse(Home == "Christopher Newport" & Away == "N.C. Wesleyan", 1, home_team_score),
    away_team_score = ifelse(Home == "Christopher Newport" & Away == "N.C. Wesleyan", 0, away_team_score),
    home_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "N.C. Wesleyan", 2, home_team_score),
    away_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "N.C. Wesleyan", 0, away_team_score),
    home_team_score = ifelse(Home == "Marymount" & Away == "N.C. Wesleyan", 4, home_team_score),
    away_team_score = ifelse(Home == "Marymount" & Away == "N.C. Wesleyan", 1, away_team_score),
    home_team_score = ifelse(Home == "Barton" & Away == "N.C. Wesleyan", 4, home_team_score),
    away_team_score = ifelse(Home == "Barton" & Away == "N.C. Wesleyan", 2, away_team_score),
    home_team_score = ifelse(Home == "Southern Virginia" & Away == "N.C. Wesleyan", 1, home_team_score),
    away_team_score = ifelse(Home == "Southern Virginia" & Away == "N.C. Wesleyan", 3, away_team_score),
    home_team_score = ifelse(Home == "Methodist" & Away == "N.C. Wesleyan", 3, home_team_score),
    away_team_score = ifelse(Home == "Methodist" & Away == "N.C. Wesleyan", 1, away_team_score),
    home_team_score = ifelse(Home == "Greensboro" & Away == "N.C. Wesleyan", 1, home_team_score),
    away_team_score = ifelse(Home == "Greensboro" & Away == "N.C. Wesleyan", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Regent" & Away == "N.C. Wesleyan", 0, home_team_score),
    away_team_score = ifelse(Home == "Regent" & Away == "N.C. Wesleyan", 5, away_team_score)
  )


# Update scores for Washington and Lee games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Washington and Lee
    home_team_score = ifelse(Home == "Washington and Lee" & Away == "Sewanee", 3, home_team_score),
    away_team_score = ifelse(Home == "Washington and Lee" & Away == "Sewanee", 1, away_team_score),
    home_team_score = ifelse(Home == "Washington and Lee" & Away == "Shenandoah", 2, home_team_score),
    away_team_score = ifelse(Home == "Washington and Lee" & Away == "Shenandoah", 1, away_team_score),
    home_team_score = ifelse(Home == "Washington and Lee" & Away == "Randolph-Macon", 2, home_team_score),
    away_team_score = ifelse(Home == "Washington and Lee" & Away == "Randolph-Macon", 0, away_team_score),
    home_team_score = ifelse(Home == "Washington and Lee" & Away == "Guilford", 5, home_team_score),
    away_team_score = ifelse(Home == "Washington and Lee" & Away == "Guilford", 1, away_team_score),
    home_team_score = ifelse(Home == "Washington and Lee" & Away == "Lynchburg", 4, home_team_score),
    away_team_score = ifelse(Home == "Washington and Lee" & Away == "Lynchburg", 0, away_team_score),
    home_team_score = ifelse(Home == "Stockton" & Away == "Washington and Lee", 0, home_team_score),
    away_team_score = ifelse(Home == "Stockton" & Away == "Washington and Lee", 0, away_team_score),
    

    # Away games for Washington and Lee
    home_team_score = ifelse(Home == "Oglethorpe" & Away == "Washington and Lee", 1, home_team_score),
    away_team_score = ifelse(Home == "Oglethorpe" & Away == "Washington and Lee", 0, away_team_score),
    home_team_score = ifelse(Home == "Emory" & Away == "Washington and Lee", 0, home_team_score),
    away_team_score = ifelse(Home == "Emory" & Away == "Washington and Lee", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Otterbein" & Away == "Washington and Lee", 3, home_team_score),
    away_team_score = ifelse(Home == "Otterbein" & Away == "Washington and Lee", 3, away_team_score), # Tie
    home_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Washington and Lee", 0, home_team_score),
    away_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Washington and Lee", 1, away_team_score),
    home_team_score = ifelse(Home == "Averett" & Away == "Washington and Lee", 0, home_team_score),
    away_team_score = ifelse(Home == "Averett" & Away == "Washington and Lee", 3, away_team_score),
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Washington and Lee", 1, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Washington and Lee", 2, away_team_score),
    home_team_score = ifelse(Home == "Randolph" & Away == "Washington and Lee", 1, home_team_score),
    away_team_score = ifelse(Home == "Randolph" & Away == "Washington and Lee", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Washington and Lee", 0, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Washington and Lee", 9, away_team_score),
  )

# Update scores for Webster games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Webster
    home_team_score = ifelse(Home == "Webster" & Away == "Maryville (Tenn.)", 4, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Maryville (Tenn.)", 2, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Dominican", 0, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Dominican", 4, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Health Sciences and Pharmacy (Mo.)", 5, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Health Sciences and Pharmacy (Mo.)", 0, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Rhodes", 0, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Rhodes", 1, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Wis.-Platteville", 0, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Wis.-Platteville", 4, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Illinois Col.", 0, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Illinois Col.", 2, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Westminster (MO)", 3, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Westminster (MO)", 1, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Washington U.", 0, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Washington U.", 2, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "MUW", 0, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "MUW", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Webster" & Away == "Fontbonne", 1, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Fontbonne", 0, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Blackburn", 6, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Blackburn", 0, away_team_score),
    home_team_score = ifelse(Home == "Webster" & Away == "Principia", 5, home_team_score),
    away_team_score = ifelse(Home == "Webster" & Away == "Principia", 1, away_team_score),

    # Away games for Webster
    home_team_score = ifelse(Home == "Grinnell" & Away == "Webster", 0, home_team_score),
    away_team_score = ifelse(Home == "Grinnell" & Away == "Webster", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "SIUE" & Away == "Webster", 3, home_team_score),
    away_team_score = ifelse(Home == "SIUE" & Away == "Webster", 1, away_team_score),
    home_team_score = ifelse(Home == "Eureka" & Away == "Webster", 2, home_team_score),
    away_team_score = ifelse(Home == "Eureka" & Away == "Webster", 1, away_team_score),
    home_team_score = ifelse(Home == "Spalding" & Away == "Webster", 1, home_team_score),
    away_team_score = ifelse(Home == "Spalding" & Away == "Webster", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Greenville" & Away == "Webster", 1, home_team_score),
    away_team_score = ifelse(Home == "Greenville" & Away == "Webster", 0, away_team_score),
    home_team_score = ifelse(Home == "Lyon" & Away == "Webster", 3, home_team_score),
    away_team_score = ifelse(Home == "Lyon" & Away == "Webster", 2, away_team_score)
  )

# Update scores for Messiah games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Messiah
    home_team_score = ifelse(Home == "Messiah" & Away == "TCNJ", 4, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "TCNJ", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Brockport State", 2, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Brockport State", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Rutgers-Camden", 4, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Rutgers-Camden", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Elizabethtown", 3, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Elizabethtown", 2, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Mary Washington", 1, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Mary Washington", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Lycoming", 2, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Lycoming", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Widener", 2, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Widener", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Lancaster Bible", 4, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Lancaster Bible", 1, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Hood", 6, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Hood", 0, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Alvernia", 1, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Alvernia", 0, away_team_score),

    # Away games for Messiah
    home_team_score = ifelse(Home == "Dickinson" & Away == "Messiah", 0, home_team_score),
    away_team_score = ifelse(Home == "Dickinson" & Away == "Messiah", 1, away_team_score),
    home_team_score = ifelse(Home == "Salisbury" & Away == "Messiah", 1, home_team_score),
    away_team_score = ifelse(Home == "Salisbury" & Away == "Messiah", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Eastern" & Away == "Messiah", 0, home_team_score),
    away_team_score = ifelse(Home == "Eastern" & Away == "Messiah", 3, away_team_score),
    home_team_score = ifelse(Home == "Albright" & Away == "Messiah", 2, home_team_score),
    away_team_score = ifelse(Home == "Albright" & Away == "Messiah", 0, away_team_score),
    home_team_score = ifelse(Home == "Penn St.-Harrisburg" & Away == "Messiah", 1, home_team_score),
    away_team_score = ifelse(Home == "Penn St.-Harrisburg" & Away == "Messiah", 2, away_team_score),
    home_team_score = ifelse(Home == "Stevenson" & Away == "Messiah", 1, home_team_score),
    away_team_score = ifelse(Home == "Stevenson" & Away == "Messiah", 2, away_team_score),
    home_team_score = ifelse(Home == "York (PA)" & Away == "Messiah", 0, home_team_score),
    away_team_score = ifelse(Home == "York (PA)" & Away == "Messiah", 3, away_team_score)
  )

# Update scores for Tufts games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Tufts
    home_team_score = ifelse(Home == "MIT" & Away == "Tufts", 1, home_team_score),
    away_team_score = ifelse(Home == "MIT" & Away == "Tufts", 4, away_team_score),
    home_team_score = ifelse(Home == "Tufts" & Away == "Maine-Farmington", 7, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Maine-Farmington", 0, away_team_score),
    home_team_score = ifelse(Home == "Tufts" & Away == "Amherst", 1, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Amherst", 3, away_team_score),
    home_team_score = ifelse(Home == "Tufts" & Away == "Hamilton", 3, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Hamilton", 0, away_team_score),
    home_team_score = ifelse(Home == "Tufts" & Away == "Wesleyan", 0, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Wesleyan", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Tufts" & Away == "Emerson", 1, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Emerson", 0, away_team_score),
    home_team_score = ifelse(Home == "Tufts" & Away == "Bates", 3, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Bates", 1, away_team_score),
    home_team_score = ifelse(Home == "Tufts" & Away == "Williams", 2, home_team_score),
    away_team_score = ifelse(Home == "Tufts" & Away == "Williams", 0, away_team_score),

    # Away games for Tufts
    home_team_score = ifelse(Home == "Connecticut College" & Away == "Tufts", 1, home_team_score),
    away_team_score = ifelse(Home == "Connecticut College" & Away == "Tufts", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Salem State" & Away == "Tufts", 0, home_team_score),
    away_team_score = ifelse(Home == "Salem State" & Away == "Tufts", 4, away_team_score),
    home_team_score = ifelse(Home == "Colby" & Away == "Tufts", 2, home_team_score),
    away_team_score = ifelse(Home == "Colby" & Away == "Tufts", 3, away_team_score),
    home_team_score = ifelse(Home == "Babson" & Away == "Tufts", 0, home_team_score),
    away_team_score = ifelse(Home == "Babson" & Away == "Tufts", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Trinity (Conn.)" & Away == "Tufts", 1, home_team_score),
    away_team_score = ifelse(Home == "Trinity (Conn.)" & Away == "Tufts", 3, away_team_score),
    home_team_score = ifelse(Home == "Middlebury" & Away == "Tufts", 3, home_team_score),
    away_team_score = ifelse(Home == "Middlebury" & Away == "Tufts", 0, away_team_score),
    home_team_score = ifelse(Home == "Bowdoin" & Away == "Tufts", 0, home_team_score),
    away_team_score = ifelse(Home == "Bowdoin" & Away == "Tufts", 1, away_team_score)
  )

# Update scores for La Verne games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for La Verne
    home_team_score = ifelse(Home == "La Verne" & Away == "Linfield", 3, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Linfield", 0, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "George Fox", 1, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "George Fox", 2, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "Bethesda University", 4, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Bethesda Univeristy", 1, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "Whittier", 0, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Whittier", 4, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "Chapman", 1, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Chapman", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "La Verne" & Away == "Pomona-Pitzer", 1, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Pomona-Pitzer", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "La Verne" & Away == "Redlands", 1, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Redlands", 2, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "Cal Lutheran", 3, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Cal Lutheran", 2, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "UC Santa Cruz", 0, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "UC Santa Cruz", 3, away_team_score),
    home_team_score = ifelse(Home == "La Verne" & Away == "Occidental", 0, home_team_score),
    away_team_score = ifelse(Home == "La Verne" & Away == "Occidental", 2, away_team_score),

    # Away games for La Verne
    home_team_score = ifelse(Home == "St. Johns (MN)" & Away == "La Verne", 2, home_team_score),
    away_team_score = ifelse(Home == "St. Johns (MN)" & Away == "La Verne", 4, away_team_score),
    home_team_score = ifelse(Home == "Lakeland" & Away == "La Verne", 1, home_team_score),
    away_team_score = ifelse(Home == "Lakeland" & Away == "La Verne", 2, away_team_score),
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "La Verne", 1, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "La Verne", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Caltech" & Away == "La Verne", 4, home_team_score),
    away_team_score = ifelse(Home == "Caltech" & Away == "La Verne", 2, away_team_score),
    home_team_score = ifelse(Home == "Occidental" & Away == "La Verne", 3, home_team_score),
    away_team_score = ifelse(Home == "Occidental" & Away == "La Verne", 1, away_team_score),
    home_team_score = ifelse(Home == "Claremont-Mudd-Scripps" & Away == "La Verne", 1, home_team_score),
    away_team_score = ifelse(Home == "Claremont-Mudd-Scripps" & Away == "La Verne", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "La Verne", 1, home_team_score),
    away_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "La Verne", 2, away_team_score),
    home_team_score = ifelse(Home == "Redlands" & Away == "La Verne", 0, home_team_score),
    away_team_score = ifelse(Home == "Redlands" & Away == "La Verne", 0, away_team_score) # Tie
  )

# Add missing games for La Verne
all_schedule_data <- all_schedule_data %>%
  add_row(Date = "2023-09-08", Home = "La Verne", Away = "Linfield", home_team_score = 3, away_team_score = 0, Time.Status = "Final", Links = "BX") %>%
  add_row(Date = "2023-09-10", Home = "La Verne", Away = "George Fox", home_team_score = 1, away_team_score = 2, Time.Status = "Final", Links = "BX") %>%
  add_row(Date = "2023-09-13", Home = "La Verne", Away = "Bethesda", home_team_score = 4, away_team_score = 1, Time.Status = "Final", Links = "BX") %>%
  add_row(Date = "2023-09-02", Home = "St. Johns (MN)", Away = "La Verne", home_team_score = 2, away_team_score = 4, Time.Status = "Final", Links = "BX") %>%
  add_row(Date = "2023-09-03", Home = "Lakeland", Away = "La Verne", home_team_score = 1, away_team_score = 2, Time.Status = "Final", Links = "BX")



# Update scores for Bridgewater (Va.) games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Bridgewater (Va.)
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Regent", 1, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Regent", 0, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "William Peace", 5, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "William Peace", 1, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Wilson", 2, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Wilson", 0, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "McDaniel", 1, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "McDaniel", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Shenandoah", 2, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Shenandoah", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Virginia Wesleyan", 1, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Virginia Wesleyan", 5, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Eastern Mennonite", 3, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Eastern Mennonite", 0, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Averett", 1, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Averett", 0, away_team_score),
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Penn St.-Harrisburg", 0, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Penn St.-Harrisburg", 0, away_team_score), 
    home_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Washington and Lee", 0, home_team_score),
    away_team_score = ifelse(Home == "Bridgewater (Va.)" & Away == "Washington and Lee", 9, away_team_score),

    # Away games for Bridgewater (Va.)
    home_team_score = ifelse(Home == "St. Vincent" & Away == "Bridgewater (Va.)", 0, home_team_score),
    away_team_score = ifelse(Home == "St. Vincent" & Away == "Bridgewater (Va.)", 3, away_team_score),
    home_team_score = ifelse(Home == "St. Mary's (Md.)" & Away == "Bridgewater (Va.)", 1, home_team_score),
    away_team_score = ifelse(Home == "St. Mary's (Md.)" & Away == "Bridgewater (Va.)", 1, away_team_score),
    home_team_score = ifelse(Home == "Guilford" & Away == "Bridgewater (Va.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Guilford" & Away == "Bridgewater (Va.)", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Lynchburg" & Away == "Bridgewater (Va.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Lynchburg" & Away == "Bridgewater (Va.)", 0, away_team_score),
    home_team_score = ifelse(Home == "Randolph-Macon" & Away == "Bridgewater (Va.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Randolph-Macon" & Away == "Bridgewater (Va.)", 0, away_team_score),
    home_team_score = ifelse(Home == "Ferrum" & Away == "Bridgewater (Va.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Ferrum" & Away == "Bridgewater (Va.)", 3, away_team_score),
    home_team_score = ifelse(Home == "Randolph" & Away == "Bridgewater (Va.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Randolph" & Away == "Bridgewater (Va.)", 1, away_team_score) # Tie
  )

# Update scores for Coast Guard games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Coast Guard
    home_team_score = ifelse(Home == "Coast Guard" & Away == "Mass-Dartmouth", 6, home_team_score),
    away_team_score = ifelse(Home == "Coast Guard" & Away == "Mass-Dartmouth", 0, away_team_score),
    home_team_score = ifelse(Home == "Coast Guard" & Away == "MIT", 2, home_team_score),
    away_team_score = ifelse(Home == "Coast Guard" & Away == "MIT", 3, away_team_score),
    home_team_score = ifelse(Home == "Coast Guard" & Away == "Wheaton (Mass.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Coast Guard" & Away == "Wheaton (Mass.)", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Mass-Boston" & Away == "Coast Guard", 1, home_team_score),
    away_team_score = ifelse(Home == "Mass-Boston" & Away == "Coast Guard", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Coast Guard" & Away == "Rhode Island Col.", 0, home_team_score),
    away_team_score = ifelse(Home == "Coast Guard" & Away == "Rhode Island Col.", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Coast Guard" & Away == "Salve Regina", 1, home_team_score),
    away_team_score = ifelse(Home == "Coast Guard" & Away == "Salve Regina", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Coast Guard" & Away == "Babson", 1, home_team_score),
    away_team_score = ifelse(Home == "Coast Guard" & Away == "Babson", 1, away_team_score), # Tie

    # Away games for Coast Guard
    home_team_score = ifelse(Home == "Widener" & Away == "Coast Guard", 2, home_team_score),
    away_team_score = ifelse(Home == "Widener" & Away == "Coast Guard", 1, away_team_score),
    home_team_score = ifelse(Home == "Swarthmore" & Away == "Coast Guard", 2, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "Coast Guard", 1, away_team_score),
    home_team_score = ifelse(Home == "Merchant Marine" & Away == "Coast Guard", 1, home_team_score),
    away_team_score = ifelse(Home == "Merchant Marine" & Away == "Coast Guard", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Endicott" & Away == "Coast Guard", 2, home_team_score),
    away_team_score = ifelse(Home == "Endicott" & Away == "Coast Guard", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Springfield" & Away == "Coast Guard", 0, home_team_score),
    away_team_score = ifelse(Home == "Springfield" & Away == "Coast Guard", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Clark" & Away == "Coast Guard", 0, home_team_score),
    away_team_score = ifelse(Home == "Clark" & Away == "Coast Guard", 4, away_team_score),
    home_team_score = ifelse(Home == "Connecticut College" & Away == "Coast Guard", 3, home_team_score),
    away_team_score = ifelse(Home == "Connecticut College" & Away == "Coast Guard", 0, away_team_score),
    home_team_score = ifelse(Home == "WPI" & Away == "Coast Guard", 2, home_team_score),
    away_team_score = ifelse(Home == "WPI" & Away == "Coast Guard", 0, away_team_score),
    home_team_score = ifelse(Home == "Emerson" & Away == "Coast Guard", 0, home_team_score),
    away_team_score = ifelse(Home == "Emerson" & Away == "Coast Guard", 1, away_team_score)
  )

# Update scores for Elizabethtown games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Elizabethtown
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "St. John Fisher", 1, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "St. John Fisher", 0, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Rutgers-Newark", 2, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Rutgers-Newark", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Stevenson", 0, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Stevenson", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Scranton", 2, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Scranton", 1, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Lebanon Valley", 1, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Lebanon Valley", 3, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Catholic", 1, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Catholic", 2, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Wilkes", 3, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Wilkes", 0, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Moravian", 1, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Moravian", 0, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Pratt", 10, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Pratt", 0, away_team_score),
    home_team_score = ifelse(Home == "Elizabethtown" & Away == "Lycoming", 0, home_team_score),
    away_team_score = ifelse(Home == "Elizabethtown" & Away == "Lycoming", 0, away_team_score), # Tie

    # Away games for Elizabethtown
    home_team_score = ifelse(Home == "Franklin & Marshall" & Away == "Elizabethtown", 1, home_team_score),
    away_team_score = ifelse(Home == "Franklin & Marshall" & Away == "Elizabethtown", 0, away_team_score),
    home_team_score = ifelse(Home == "Alvernia" & Away == "Elizabethtown", 2, home_team_score),
    away_team_score = ifelse(Home == "Alvernia" & Away == "Elizabethtown", 4, away_team_score),
    home_team_score = ifelse(Home == "Messiah" & Away == "Elizabethtown", 3, home_team_score),
    away_team_score = ifelse(Home == "Messiah" & Away == "Elizabethtown", 2, away_team_score),
    home_team_score = ifelse(Home == "Drew" & Away == "Elizabethtown", 0, home_team_score),
    away_team_score = ifelse(Home == "Drew" & Away == "Elizabethtown", 1, away_team_score),
    home_team_score = ifelse(Home == "Juniata" & Away == "Elizabethtown", 1, home_team_score),
    away_team_score = ifelse(Home == "Juniata" & Away == "Elizabethtown", 2, away_team_score),
    home_team_score = ifelse(Home == "Susquehanna" & Away == "Elizabethtown", 4, home_team_score),
    away_team_score = ifelse(Home == "Susquehanna" & Away == "Elizabethtown", 0, away_team_score),
    home_team_score = ifelse(Home == "Goucher" & Away == "Elizabethtown", 1, home_team_score),
    away_team_score = ifelse(Home == "Goucher" & Away == "Elizabethtown", 0, away_team_score)
  )



# Update scores for Hampden-Sydney games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Hampden-Sydney
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Franciscan", 3, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Franciscan", 0, away_team_score),
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Sewanee", 1, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Sewanee", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Lynchburg", 1, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Lynchburg", 4, away_team_score),
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Ferrum", 2, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Ferrum", 0, away_team_score),
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Washington and Lee", 1, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Washington and Lee", 2, away_team_score),
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Randolph-Macon", 1, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Randolph-Macon", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Randolph", 1, home_team_score),
    away_team_score = ifelse(Home == "Hampden-Sydney" & Away == "Randolph", 1, away_team_score), # Tie

    # Away games for Hampden-Sydney
    home_team_score = ifelse(Home == "Greensboro", 0, home_team_score),
    away_team_score = ifelse(Home == "Greensboro" & Away == "Hampden-Sydney", 1, away_team_score),
    home_team_score = ifelse(Home == "Marymount", 1, home_team_score),
    away_team_score = ifelse(Home == "Marymount" & Away == "Hampden-Sydney", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Mary Baldwin", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Hampden-Sydney", 5, away_team_score),
    home_team_score = ifelse(Home == "Virginia Wesleyan", 1, home_team_score),
    away_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Hampden-Sydney", 2, away_team_score),
    home_team_score = ifelse(Home == "Roanoke", 1, home_team_score),
    away_team_score = ifelse(Home == "Roanoke" & Away == "Hampden-Sydney", 0, away_team_score),
    home_team_score = ifelse(Home == "Shenandoah", 1, home_team_score),
    away_team_score = ifelse(Home == "Shenandoah" & Away == "Hampden-Sydney", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Averett", 0, home_team_score),
    away_team_score = ifelse(Home == "Averett" & Away == "Hampden-Sydney", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Eastern Mennonite", 1, home_team_score),
    away_team_score = ifelse(Home == "Eastern Mennonite" & Away == "Hampden-Sydney", 4, away_team_score)
  )

# Update scores for Hanover games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Hanover
    home_team_score = ifelse(Home == "Hanover" & Away == "Wabash", 2, home_team_score),
    away_team_score = ifelse(Home == "Hanover" & Away == "Wabash", 1, away_team_score),
    home_team_score = ifelse(Home == "Hanover" & Away == "Otterbein", 1, home_team_score),
    away_team_score = ifelse(Home == "Hanover" & Away == "Otterbein", 2, away_team_score),
    home_team_score = ifelse(Home == "Hanover" & Away == "Earlham", 4, home_team_score),
    away_team_score = ifelse(Home == "Hanover" & Away == "Earlham", 0, away_team_score),
    home_team_score = ifelse(Home == "Hanover" & Away == "Manchester", 0, home_team_score),
    away_team_score = ifelse(Home == "Hanover" & Away == "Manchester", 1, away_team_score),
    home_team_score = ifelse(Home == "Franklin" & Away == "Hanover", 2, home_team_score),
    away_team_score = ifelse(Home == "Franklin" & Away == "Hanover", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Hanover" & Away == "Anderson", 3, home_team_score),
    away_team_score = ifelse(Home == "Hanover" & Away == "Anderson", 2, away_team_score),

    # Away games for Hanover
    home_team_score = ifelse(Home == "Centre" & Away == "Hanover", 0, home_team_score),
    away_team_score = ifelse(Home == "Centre" & Away == "Hanover", 2, away_team_score),
    home_team_score = ifelse(Home == "Spalding" & Away == "Hanover", 1, home_team_score),
    away_team_score = ifelse(Home == "Spalding" & Away == "Hanover", 0, away_team_score),
    home_team_score = ifelse(Home == "Kenyon" & Away == "Hanover", 1, home_team_score),
    away_team_score = ifelse(Home == "Kenyon" & Away == "Hanover", 0, away_team_score),
    home_team_score = ifelse(Home == "Ohio Wesleyan" & Away == "Hanover", 3, home_team_score),
    away_team_score = ifelse(Home == "Ohio Wesleyan" & Away == "Hanover", 1, away_team_score),
    home_team_score = ifelse(Home == "Defiance" & Away == "Hanover", 3, home_team_score),
    away_team_score = ifelse(Home == "Defiance" & Away == "Hanover", 2, away_team_score),
    home_team_score = ifelse(Home == "Transylvania" & Away == "Hanover", 1, home_team_score),
    away_team_score = ifelse(Home == "Transylvania" & Away == "Hanover", 2, away_team_score),
    home_team_score = ifelse(Home == "Bluffton" & Away == "Hanover", 3, home_team_score),
    away_team_score = ifelse(Home == "Bluffton" & Away == "Hanover", 4, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Hanover", 1, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Joseph" & Away == "Hanover", 3, away_team_score),
    home_team_score = ifelse(Home == "Rose-Hulman" & Away == "Hanover", 0, home_team_score),
    away_team_score = ifelse(Home == "Rose-Hulman" & Away == "Hanover", 1, away_team_score),
    home_team_score = ifelse(Home == "Berea" & Away == "Hanover", 0, home_team_score),
    away_team_score = ifelse(Home == "Berea" & Away == "Hanover", 1, away_team_score)
  )

# Update scores for Johns Hopkins games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Johns Hopkins" & Away == "Gettysburg", 3, home_team_score),
    away_team_score = ifelse(Home == "Johns Hopkins" & Away == "Gettysburg", 2, away_team_score),
    home_team_score = ifelse(Home == "Johns Hopkins" & Away == "Lycoming", 3, home_team_score),
    away_team_score = ifelse(Home == "Johns Hopkins" & Away == "Lycoming", 1, away_team_score),
    home_team_score = ifelse(Home == "Johns Hopkins" & Away == "Hobart", 2, home_team_score),
    away_team_score = ifelse(Home == "Johns Hopkins" & Away == "Hobart", 0, away_team_score),
    home_team_score = ifelse(Home == "Johns Hopkins" & Away == "Muhlenberg", 1, home_team_score),
    away_team_score = ifelse(Home == "Johns Hopkins" & Away == "Muhlenberg", 1, away_team_score),


    # Away games for Johns Hopkins
    home_team_score = ifelse(Home == "Rowan" & Away == "Johns Hopkins", 1, home_team_score),
    away_team_score = ifelse(Home == "Rowan" & Away == "Johns Hopkins", 1, away_team_score),
    home_team_score = ifelse(Home == "Dickinson" & Away == "Johns Hopkins", 4, home_team_score),
    away_team_score = ifelse(Home == "Dickinson" & Away == "Johns Hopkins", 2, away_team_score),
    home_team_score = ifelse(Home == "McDaniel" & Away == "Johns Hopkins", 0, home_team_score),
    away_team_score = ifelse(Home == "McDaniel" & Away == "Johns Hopkins", 1, away_team_score),
  )

# Update scores for Lake Forest games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Lake Forest
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Wheaton (Ill.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Wheaton (Ill.)", 2, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Elmhurst", 2, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Elmhurst", 1, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Carthage", 2, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Carthage", 6, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "North Central (Ill.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "North Central (Ill.)", 2, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Lawrence", 4, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Lawrence", 0, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Aurora", 2, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Aurora", 6, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Grinnell", 4, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Grinnell", 3, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Beloit", 2, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Beloit", 0, away_team_score),
    home_team_score = ifelse(Home == "Lake Forest" & Away == "Illinois Col.", 1, home_team_score),
    away_team_score = ifelse(Home == "Lake Forest" & Away == "Illinois Col.", 1, away_team_score), # Tie

    # Away games for Lake Forest
    home_team_score = ifelse(Home == "Neb. Wesleyan" & Away == "Lake Forest", 2, home_team_score),
    away_team_score = ifelse(Home == "Neb. Wesleyan" & Away == "Lake Forest", 0, away_team_score),
    home_team_score = ifelse(Home == "Colorado College" & Away == "Lake Forest", 4, home_team_score),
    away_team_score = ifelse(Home == "Colorado College" & Away == "Lake Forest", 1, away_team_score),
    home_team_score = ifelse(Home == "Dominican" & Away == "Lake Forest", 2, home_team_score),
    away_team_score = ifelse(Home == "Dominican" & Away == "Lake Forest", 0, away_team_score),
    home_team_score = ifelse(Home == "Illinois Wesleyan" & Away == "Lake Forest", 0, home_team_score),
    away_team_score = ifelse(Home == "Illinois Wesleyan" & Away == "Lake Forest", 2, away_team_score),
    home_team_score = ifelse(Home == "Ripon" & Away == "Lake Forest", 1, home_team_score),
    away_team_score = ifelse(Home == "Ripon" & Away == "Lake Forest", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Knox" & Away == "Lake Forest", 0, home_team_score),
    away_team_score = ifelse(Home == "Knox" & Away == "Lake Forest", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Monmouth (Ill.)" & Away == "Lake Forest", 3, home_team_score),
    away_team_score = ifelse(Home == "Monmouth (Ill.)" & Away == "Lake Forest", 2, away_team_score),
    home_team_score = ifelse(Home == "Cornell College" & Away == "Lake Forest", 0, home_team_score),
    away_team_score = ifelse(Home == "Cornell College" & Away == "Lake Forest", 0, away_team_score) # Tie
  )

# Update scores for Pfeiffer games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Pfeiffer
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Ferrum", 3, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Ferrum", 0, away_team_score),
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Piedmont", 5, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Piedmont", 1, away_team_score),
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Johnson & Wales (NC)", 0, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Johnson & Wales (NC)", 1, away_team_score),
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Brevard", 2, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Brevard", 4, away_team_score),
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Greensboro", 3, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Greensboro", 2, away_team_score),
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "William Peace", 1, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "William Peace", 0, away_team_score),
    home_team_score = ifelse(Home == "Pfeiffer" & Away == "Southern Virginia", 3, home_team_score),
    away_team_score = ifelse(Home == "Pfeiffer" & Away == "Southern Virginia", 3, away_team_score), # Tie

    # Away games for Pfeiffer
    home_team_score = ifelse(Home == "Guilford" & Away == "Pfeiffer", 0, home_team_score),
    away_team_score = ifelse(Home == "Guilford" & Away == "Pfeiffer", 4, away_team_score),
    home_team_score = ifelse(Home == "Johnson & Wales (NC)" & Away == "Pfeiffer", 0, home_team_score),
    away_team_score = ifelse(Home == "Johnson & Wales (NC)" & Away == "Pfeiffer", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Averett" & Away == "Pfeiffer", 2, home_team_score),
    away_team_score = ifelse(Home == "Averett" & Away == "Pfeiffer", 1, away_team_score),
    home_team_score = ifelse(Home == "Bob Jones" & Away == "Pfeiffer", 2, home_team_score),
    away_team_score = ifelse(Home == "Bob Jones" & Away == "Pfeiffer", 1, away_team_score),
    home_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Pfeiffer", 2, home_team_score),
    away_team_score = ifelse(Home == "N.C. Wesleyan" & Away == "Pfeiffer", 1, away_team_score),
    home_team_score = ifelse(Home == "Methodist" & Away == "Pfeiffer", 2, home_team_score),
    away_team_score = ifelse(Home == "Methodist" & Away == "Pfeiffer", 0, away_team_score),
    home_team_score = ifelse(Home == "Warren Wilson" & Away == "Pfeiffer", 1, home_team_score),
    away_team_score = ifelse(Home == "Warren Wilson" & Away == "Pfeiffer", 5, away_team_score),
    home_team_score = ifelse(Home == "Mary Baldwin" & Away == "Pfeiffer", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Baldwin" & Away == "Pfeiffer", 1, away_team_score)
  )

# Update scores for Stevenson games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Stevenson
    home_team_score = ifelse(Home == "Stevenson" & Away == "Widener", 0, home_team_score),
    away_team_score = ifelse(Home == "Stevenson" & Away == "Widener", 0, away_team_score),
    home_team_score = ifelse(Home == "Stevenson" & Away == "Hood", 3, home_team_score),
    away_team_score = ifelse(Home == "Stevenson" & Away == "Hood", 0, away_team_score),

    # Away games for Stevenson
    home_team_score = ifelse(Home == "Immaculata" & Away == "Stevenson", 3, home_team_score),
    away_team_score = ifelse(Home == "Immaculata" & Away == "Stevenson", 0, away_team_score),
    home_team_score = ifelse(Home == "Marymount" & Away == "Stevenson", 2, home_team_score),
    away_team_score = ifelse(Home == "Marymount" & Away == "Stevenson", 1, away_team_score),
    home_team_score = ifelse(Home == "Albright" & Away == "Stevenson", 0, home_team_score),
    away_team_score = ifelse(Home == "Albright" & Away == "Stevenson", 3, away_team_score),
  )

# Update scores for Westminster (Pa.) games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Westminster (Pa.)
    home_team_score = ifelse(Home == "Westminster (Pa.)" & Away == "Grove City", 0, home_team_score),
    away_team_score = ifelse(Home == "Westminster (Pa.)" & Away == "Grove City", 2, away_team_score),
    home_team_score = ifelse(Home == "Westminster (Pa.)" & Away == "Waynesburg", 3, home_team_score),
    away_team_score = ifelse(Home == "Westminster (Pa.)" & Away == "Waynesburg", 5, away_team_score),
    # Away games for Westminster (Pa.)
    home_team_score = ifelse(Home == "Thiel" & Away == "Westminster (Pa.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Thiel" & Away == "Westminster (Pa.)", 3, away_team_score),
    home_team_score = ifelse(Home == "Washington and Jefferson" & Away == "Westminster (Pa.)", 1, home_team_score),
    away_team_score = ifelse(Home == "Washington and Jefferson" & Away == "Westminster (Pa.)", 1, away_team_score),
    home_team_score = ifelse(Home == "St. Vincent" & Away == "Westminster (Pa.)", 2, home_team_score),
    away_team_score = ifelse(Home == "St. Vincent" & Away == "Westminster (Pa.)", 1, away_team_score),
    home_team_score = ifelse(Home == "Chatham" & Away == "Westminster (Pa.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Chatham" & Away == "Westminster (Pa.)", 1, away_team_score) # Tie
  )

# Update scores for Lyon games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Lyon
    home_team_score = ifelse(Home == "Lyon" & Away == "Spalding", 2, home_team_score),
    away_team_score = ifelse(Home == "Lyon" & Away == "Spalding", 1, away_team_score),
    home_team_score = ifelse(Home == "Lyon" & Away == "MUW", 4, home_team_score),
    away_team_score = ifelse(Home == "Lyon" & Away == "MUW", 0, away_team_score),

    # Away games for Lyon
    home_team_score = ifelse(Home == "Hendrix" & Away == "Lyon", 0, home_team_score),
    away_team_score = ifelse(Home == "Hendrix" & Away == "Lyon", 1, away_team_score),
    home_team_score = ifelse(Home == "Rhodes" & Away == "Lyon", 2, home_team_score),
    away_team_score = ifelse(Home == "Rhodes" & Away == "Lyon", 0, away_team_score),
    home_team_score = ifelse(Home == "Principia" & Away == "Lyon", 0, home_team_score),
    away_team_score = ifelse(Home == "Principia" & Away == "Lyon", 2, away_team_score),
  )

# Update scores for specific Elmira games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Elmira
    home_team_score = ifelse(Home == "Elmira" & Away == "Keuka", 2, home_team_score),
    away_team_score = ifelse(Home == "Elmira" & Away == "Keuka", 0, away_team_score),
    home_team_score = ifelse(Home == "Elmira" & Away == "Houghton", 2, home_team_score),
    away_team_score = ifelse(Home == "Elmira" & Away == "Houghton", 1, away_team_score),
    home_team_score = ifelse(Home == "Elmira" & Away == "Alfred", 4, home_team_score),
    away_team_score = ifelse(Home == "Elmira" & Away == "Alfred", 0, away_team_score),

    # Away games for Elmira
    home_team_score = ifelse(Home == "Hartwick" & Away == "Elmira", 0, home_team_score),
    away_team_score = ifelse(Home == "Hartwick" & Away == "Elmira", 1, away_team_score),
    home_team_score = ifelse(Home == "Nazareth" & Away == "Elmira", 1, home_team_score),
    away_team_score = ifelse(Home == "Nazareth" & Away == "Elmira", 1, away_team_score) # Tie
  )

# Update scores for selected Randolph-Macon games

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Randolph-Macon
    home_team_score = ifelse(Home == "Randolph-Macon" & Away == "Regent", 5, home_team_score),
    away_team_score = ifelse(Home == "Randolph-Macon" & Away == "Regent", 1, away_team_score),
    home_team_score = ifelse(Home == "Randolph-Macon" & Away == "Virginia Wesleyan", 2, home_team_score),
    away_team_score = ifelse(Home == "Randolph-Macon" & Away == "Virginia Wesleyan", 3, away_team_score),
    home_team_score = ifelse(Home == "Randolph-Macon" & Away == "Shenandoah", 2, home_team_score),
    away_team_score = ifelse(Home == "Randolph-Macon" & Away == "Shenandoah", 5, away_team_score),

    # Away games for Randolph-Macon
    home_team_score = ifelse(Home == "Randolph" & Away == "Randolph-Macon", 1, home_team_score),
    away_team_score = ifelse(Home == "Randolph" & Away == "Randolph-Macon", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Immaculata" & Away == "Randolph-Macon", 2, home_team_score),
    away_team_score = ifelse(Home == "Immaculata" & Away == "Randolph-Macon", 3, away_team_score)
  )

# Update scores for specific Wabash games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Wabash
    home_team_score = ifelse(Home == "Wabash" & Away == "Illinois Wesleyan", 1, home_team_score),
    away_team_score = ifelse(Home == "Wabash" & Away == "Illinois Wesleyan", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Wabash" & Away == "DePauw", 3, home_team_score),
    away_team_score = ifelse(Home == "Wabash" & Away == "DePauw", 3, away_team_score), # Tie

    # Away games for Wabash
    home_team_score = ifelse(Home == "Kenyon" & Away == "Wabash", 2, home_team_score),
    away_team_score = ifelse(Home == "Kenyon" & Away == "Wabash", 0, away_team_score),
    home_team_score = ifelse(Home == "Birmingham Southern" & Away == "Wabash", 2, home_team_score),
    away_team_score = ifelse(Home == "Birmingham Southern" & Away == "Wabash", 3, away_team_score),
    home_team_score = ifelse(Home == "Berry" & Away == "Wabash", 0, home_team_score),
    away_team_score = ifelse(Home == "Berry" & Away == "Wabash", 0, away_team_score) # Tie
  )


# Update scores for selected Cal Lutheran games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Cal Lutheran
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "Pacific (Ore.)", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "Whittier", 3, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "Whittier", 0, away_team_score),
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "Occidental", 0, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "Occidental", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Cal Lutheran" & Away == "Redlands", 1, home_team_score),
    away_team_score = ifelse(Home == "Cal Lutheran" & Away == "Redlands", 3, away_team_score),

    # Away games for Cal Lutheran
    home_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Cal Lutheran", 2, home_team_score),
    away_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Cal Lutheran", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "Whitworth" & Away == "Cal Lutheran", 3, home_team_score),
    away_team_score = ifelse(Home == "Whitworth" & Away == "Cal Lutheran", 0, away_team_score)
  )

# Update scores for selected Maine-Farmington games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Maine-Farmington
    home_team_score = ifelse(Home == "Thomas" & Away == "Maine-Farmington", 1, home_team_score),
    away_team_score = ifelse(Home == "Thomas" & Away == "Maine-Farmington", 1, away_team_score), # Tie
    home_team_score = ifelse(Home == "Nichols" & Away == "Maine-Farmington", 3, home_team_score),
    away_team_score = ifelse(Home == "Nichols" & Away == "Maine-Farmington", 1, away_team_score),
    home_team_score = ifelse(Home == "Me.-Presque Isle" & Away == "Maine-Farmington", 1, home_team_score),
    away_team_score = ifelse(Home == "Me.-Presque Isle" & Away == "Maine-Farmington", 5, away_team_score),
    home_team_score = ifelse(Home == "Maine Maritime" & Away == "Maine-Farmington", 0, home_team_score),
    away_team_score = ifelse(Home == "Maine Maritime" & Away == "Maine-Farmington", 1, away_team_score)
  )

# Update scores for selected Dickinson games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Dickinson
    home_team_score = ifelse(Home == "Dickinson" & Away == "Hood", 4, home_team_score),
    away_team_score = ifelse(Home == "Dickinson" & Away == "Hood", 0, away_team_score),
    home_team_score = ifelse(Home == "Dickinson" & Away == "Franklin and Marshall", 0, home_team_score),
    away_team_score = ifelse(Home == "Dickinson" & Away == "Franklin and Marshall", 2, away_team_score),
    
    # Away games for Dickinson
    home_team_score = ifelse(Home == "Gettysburg" & Away == "Dickinson", 1, home_team_score),
    away_team_score = ifelse(Home == "Gettysburg" & Away == "Dickinson", 0, away_team_score),
    home_team_score = ifelse(Home == "Rosemont" & Away == "Dickinson", 1, home_team_score),
    away_team_score = ifelse(Home == "Rosemont" & Away == "Dickinson", 3, away_team_score),
    home_team_score = ifelse(Home == "DeSales" & Away == "Dickinson", 1, home_team_score),
    away_team_score = ifelse(Home == "DeSales" & Away == "Dickinson", 3, away_team_score)
  )

# Update scores for selected Franklin games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Franklin
    home_team_score = ifelse(Home == "Franklin" & Away == "Spalding", 1, home_team_score),
    away_team_score = ifelse(Home == "Franklin" & Away == "Spalding", 4, away_team_score),
    home_team_score = ifelse(Home == "Franklin" & Away == "Manchester", 3, home_team_score),
    away_team_score = ifelse(Home == "Franklin" & Away == "Manchester", 5, away_team_score),
    home_team_score = ifelse(Home == "Franklin" & Away == "Earlham", 0, home_team_score),
    away_team_score = ifelse(Home == "Franklin" & Away == "Earlham", 1, away_team_score),

    # Away game for Franklin
    home_team_score = ifelse(Home == "DePauw" & Away == "Franklin", 1, home_team_score),
    away_team_score = ifelse(Home == "DePauw" & Away == "Franklin", 0, away_team_score)
  )

# Update scores for selected St. Vincent games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for St. Vincent
    home_team_score = ifelse(Home == "St. Vincent" & Away == "Penn State-Mont Alto", 7, home_team_score),
    away_team_score = ifelse(Home == "St. Vincent" & Away == "Penn State-Mont Alto", 0, away_team_score),
    home_team_score = ifelse(Home == "St. Vincent" & Away == "Thiel", 0, home_team_score),
    away_team_score = ifelse(Home == "St. Vincent" & Away == "Thiel", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "St. Vincent" & Away == "Chatham", 0, home_team_score),
    away_team_score = ifelse(Home == "St. Vincent" & Away == "Chatham", 3, away_team_score),

    # Away games for St. Vincent
    home_team_score = ifelse(Home == "Waynesburg" & Away == "St. Vincent", 1, home_team_score),
    away_team_score = ifelse(Home == "Waynesburg" & Away == "St. Vincent", 0, away_team_score),
    home_team_score = ifelse(Home == "Grove City" & Away == "St. Vincent", 5, home_team_score),
    away_team_score = ifelse(Home == "Grove City" & Away == "St. Vincent", 1, away_team_score)
  )

# Update scores for selected Yeshiva games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Yeshiva
    home_team_score = ifelse(Home == "Yeshiva" & Away == "Manhattanville", 0, home_team_score),
    away_team_score = ifelse(Home == "Yeshiva" & Away == "Manhattanville", 2, away_team_score),
    home_team_score = ifelse(Home == "Yeshiva" & Away == "Purchase", 1, home_team_score),
    away_team_score = ifelse(Home == "Yeshiva" & Away == "Purchase", 1, away_team_score), # Tie

    # Away games for Yeshiva
    home_team_score = ifelse(Home == "Sarah Lawrence" & Away == "Yeshiva", 2, home_team_score),
    away_team_score = ifelse(Home == "Sarah Lawrence" & Away == "Yeshiva", 3, away_team_score),
    home_team_score = ifelse(Home == "Mount St. Mary" & Away == "Yeshiva", 2, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Mary" & Away == "Yeshiva", 2, away_team_score), # Tie
    home_team_score = ifelse(Home == "FDU-Florham" & Away == "Yeshiva", 2, home_team_score),
    away_team_score = ifelse(Home == "FDU-Florham" & Away == "Yeshiva", 1, away_team_score)
  )

# Update scores for selected Brandeis games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Brandeis
    home_team_score = ifelse(Home == "Brandeis" & Away == "Chicago", 0, home_team_score),
    away_team_score = ifelse(Home == "Brandeis" & Away == "Chicago", 0, away_team_score), # Tie

    # Away games for Brandeis
    home_team_score = ifelse(Home == "MIT" & Away == "Brandeis", 2, home_team_score),
    away_team_score = ifelse(Home == "MIT" & Away == "Brandeis", 1, away_team_score),
    home_team_score = ifelse(Home == "Washington U." & Away == "Brandeis", 1, home_team_score),
    away_team_score = ifelse(Home == "Washington U." & Away == "Brandeis", 2, away_team_score)
  )

# Update scores for selected Eastern Connecticut games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Eastern Connecticut
    home_team_score = ifelse(Home == "Eastern Connecticut" & Away == "MCLA", 0, home_team_score),
    away_team_score = ifelse(Home == "Eastern Connecticut" & Away == "MCLA", 0, away_team_score), # Tie

    # Away games for Eastern Connecticut
    home_team_score = ifelse(Home == "Plymouth State" & Away == "Eastern Connecticut", 1, home_team_score),
    away_team_score = ifelse(Home == "Plymouth State" & Away == "Eastern Connecticut", 5, away_team_score),
    home_team_score = ifelse(Home == "Wheaton (Mass.)" & Away == "Eastern Connecticut", 2, home_team_score),
    away_team_score = ifelse(Home == "Wheaton (Mass.)" & Away == "Eastern Connecticut", 2, away_team_score) # Tie
  )

# Update scores for selected Manchester games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Manchester
    home_team_score = ifelse(Home == "Manchester" & Away == "Grace Christian (Mich.)", 5, home_team_score),
    away_team_score = ifelse(Home == "Manchester" & Away == "Grace Christian (Mich.)", 0, away_team_score),
    home_team_score = ifelse(Home == "Manchester" & Away == "Transylvania", 1, home_team_score),
    away_team_score = ifelse(Home == "Manchester" & Away == "Transylvania", 0, away_team_score),

    # Away games for Manchester
    home_team_score = ifelse(Home == "Earlham" & Away == "Manchester", 1, home_team_score),
    away_team_score = ifelse(Home == "Earlham" & Away == "Manchester", 1, away_team_score) # Tie
  )

# Update scores for selected Muhlenberg games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Muhlenberg
    home_team_score = ifelse(Home == "McDaniel" & Away == "Muhlenberg", 1, home_team_score),
    away_team_score = ifelse(Home == "McDaniel" & Away == "Muhlenberg", 0, away_team_score),
    home_team_score = ifelse(Home == "Misericordia" & Away == "Muhlenberg", 1, home_team_score),
    away_team_score = ifelse(Home == "Misericordia" & Away == "Muhlenberg", 2, away_team_score),
    home_team_score = ifelse(Home == "William Paterson" & Away == "Muhlenberg", 0, home_team_score),
    away_team_score = ifelse(Home == "William Paterson" & Away == "Muhlenberg", 4, away_team_score)
  )

# Update scores for selected Trinity (Conn.) games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Trinity (Conn.)
    home_team_score = ifelse(Home == "Hamilton" & Away == "Trinity (Conn.)", 0, home_team_score), # Tie
    away_team_score = ifelse(Home == "Hamilton" & Away == "Trinity (Conn.)", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Hartford" & Away == "Trinity (Conn.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Hartford" & Away == "Trinity (Conn.)", 6, away_team_score),
    home_team_score = ifelse(Home == "Wesleyan" & Away == "Trinity (Conn.)", 2, home_team_score), # Tie
    away_team_score = ifelse(Home == "Wesleyan" & Away == "Trinity (Conn.)", 2, away_team_score) # Tie
  )

# Update scores for selected Albright games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate( 
    # Away game for Albright
    home_team_score = ifelse(Home == "Rosemont" & Away == "Albright", 1, home_team_score),
    away_team_score = ifelse(Home == "Rosemont" & Away == "Albright", 0, away_team_score)
  )

# Update scores for selected Alfred games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Alfred
    home_team_score = ifelse(Home == "Alfred" & Away == "Sage", 1, home_team_score),
    away_team_score = ifelse(Home == "Alfred" & Away == "Sage", 1, away_team_score), # Tie

    # Away game for Alfred
    home_team_score = ifelse(Home == "Nazareth" & Away == "Alfred", 2, home_team_score),
    away_team_score = ifelse(Home == "Nazareth" & Away == "Alfred", 0, away_team_score)
  )

# Update scores for selected Amherst games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Amherst
    home_team_score = ifelse(Home == "Connecticut College" & Away == "Amherst", 3, home_team_score),
    away_team_score = ifelse(Home == "Connecticut College" & Away == "Amherst", 2, away_team_score),
    home_team_score = ifelse(Home == "Montclair State" & Away == "Amherst", 1, home_team_score),
    away_team_score = ifelse(Home == "Montclair State" & Away == "Amherst", 2, away_team_score),
    home_team_score = ifelse(Home == "Wesleyan" & Away == "Amherst", 1, home_team_score),
    away_team_score = ifelse(Home == "Wesleyan" & Away == "Amherst", 1, away_team_score) # Tie
  )

# Update scores for selected Colby games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Colby
    home_team_score = ifelse(Home == "Connecticut College" & Away == "Colby", 3, home_team_score),
    away_team_score = ifelse(Home == "Connecticut College" & Away == "Colby", 0, away_team_score),
    home_team_score = ifelse(Home == "Thomas" & Away == "Colby", 0, home_team_score),
    away_team_score = ifelse(Home == "Thomas" & Away == "Colby", 4, away_team_score)
  )

#ores for selected Gordon games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Gordon
    home_team_score = ifelse(Home == "University of New England" & Away == "Gordon", 0, home_team_score), # Tie
    away_team_score = ifelse(Home == "University of New England" & Away == "Gordon", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Hartford" & Away == "Gordon", 1, home_team_score),
    away_team_score = ifelse(Home == "Hartford" & Away == "Gordon", 2, away_team_score)
  )

# Update the score for New York U. game at Chicago

all_schedule_data <- all_schedule_data %>%
  mutate(
    home_team_score = ifelse(Home == "Chicago" & Away == "New York U.", 0, home_team_score),
    away_team_score = ifelse(Home == "Chicago" & Away == "New York U.", 1, away_team_score)
  )

# Update scores for selected Franklin and Marshall games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Franklin and Marshall
    home_team_score = ifelse(Home == "McDaniel" & Away == "Franklin and Marshall", 1, home_team_score),
    away_team_score = ifelse(Home == "McDaniel" & Away == "Franklin and Marshall", 3, away_team_score),
    home_team_score = ifelse(Home == "Alvernia" & Away == "Franklin and Marshall", 0, home_team_score),
    away_team_score = ifelse(Home == "Alvernia" & Away == "Franklin and Marshall", 4, away_team_score)
  )

# Update scores for selected Mass-Dartmouth games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Mass-Dartmouth
    home_team_score = ifelse(Home == "Mass-Dartmouth" & Away == "Rhode Island Col.", 0, home_team_score),
    away_team_score = ifelse(Home == "Mass-Dartmouth" & Away == "Rhode Island Col.", 2, away_team_score),
    home_team_score = ifelse(Home == "Mass-Dartmouth" & Away == "Vermont State Castleton", 0, home_team_score),
    away_team_score = ifelse(Home == "Mass-Dartmouth" & Away == "Vermont State Castleton", 0, away_team_score) # Tie
  )

# Update scores for selected Plymouth State games with home status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Plymouth State
    home_team_score = ifelse(Home == "Plymouth State" & Away == "Western Connecticut", 2, home_team_score),
    away_team_score = ifelse(Home == "Plymouth State" & Away == "Western Connecticut", 4, away_team_score),
    home_team_score = ifelse(Home == "Plymouth State" & Away == "Vermont State Lyndon", 8, home_team_score),
    away_team_score = ifelse(Home == "Plymouth State" & Away == "Vermont State Lyndon", 0, away_team_score)
  )

# Update scores for selected Pomona-Pitzer games with home status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home games for Pomona-Pitzer
    home_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Vanguard", 0, home_team_score), # Tie
    away_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Vanguard", 0, away_team_score), # Tie
    home_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Linfield", 3, home_team_score),
    away_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Linfield", 2, away_team_score),
    home_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Occidental", 3, home_team_score),
    away_team_score = ifelse(Home == "Pomona-Pitzer" & Away == "Occidental", 5, away_team_score)
  )

# Update scores for selected Randolph games with home/away status

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away game for Randolph
    home_team_score = ifelse(Home == "Averett" & Away == "Randolph", 0, home_team_score), # Tie
    away_team_score = ifelse(Home == "Averett" & Away == "Randolph", 0, away_team_score), # Tie

    # Home game for Randolph
    home_team_score = ifelse(Home == "Randolph" & Away == "Lynchburg", 0, home_team_score),
    away_team_score = ifelse(Home == "Randolph" & Away == "Lynchburg", 3, away_team_score)
  )

# Update score for Swarthmore game with New Jersey City

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Swarthmore
    home_team_score = ifelse(Home == "Swarthmore" & Away == "New Jersey City", 2, home_team_score),
    away_team_score = ifelse(Home == "Swarthmore" & Away == "New Jersey City", 3, away_team_score)
  )

# Update score for Texas Lutheran game at Mary Hardin-Baylor

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away game for Texas Lutheran
    home_team_score = ifelse(Home == "Mary Hardin-Baylor" & Away == "Texas Lutheran", 0, home_team_score),
    away_team_score = ifelse(Home == "Mary Hardin-Baylor" & Away == "Texas Lutheran", 2, away_team_score)
  )

# Remove duplicate rows based on "Home" and "Away" columns
all_schedule_data <- all_schedule_data %>%
  distinct(Home, Away, .keep_all = TRUE)

# Remove rows where Time.Status is "Cancelled" or "Postponed"
all_schedule_data <- all_schedule_data %>%
  filter(!(Time.Status %in% c("Cancelled", "Postponed")))

# Remove rows where "Home" or "Away" contains "alumni"
all_schedule_data <- all_schedule_data %>%
  filter(!grepl("alumni", Home, ignore.case = TRUE) & 
         !grepl("alumni", Away, ignore.case = TRUE))

# Update scores for Maritime (N.Y.) games as the away team

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Away games for Maritime (N.Y.)
    home_team_score = ifelse(Home == "Mount St. Mary" & Away == "Maritime (N.Y.)", 0, home_team_score),
    away_team_score = ifelse(Home == "Mount St. Mary" & Away == "Maritime (N.Y.)", 1, away_team_score),
    home_team_score = ifelse(Home == "Sarah Lawrence" & Away == "Maritime (N.Y.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Sarah Lawrence" & Away == "Maritime (N.Y.)", 2, away_team_score) # Tie
  )

# Update scores for New Jersey City games

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Game at SUNY-Old Westbury
    home_team_score = ifelse(Home == "SUNY-Old Westbury" & Away == "New Jersey City", 2, home_team_score),
    away_team_score = ifelse(Home == "SUNY-Old Westbury" & Away == "New Jersey City", 1, away_team_score),
  )

# Update scores for Pacific (Ore.) games with Puget Sound

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Pacific (Ore.) vs Puget Sound
    home_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Puget Sound", 0, home_team_score),
    away_team_score = ifelse(Home == "Pacific (Ore.)" & Away == "Puget Sound", 0, away_team_score), # Tie
    
    # Away game at Puget Sound
    home_team_score = ifelse(Home == "Puget Sound" & Away == "Pacific (Ore.)", 2, home_team_score),
    away_team_score = ifelse(Home == "Puget Sound" & Away == "Pacific (Ore.)", 1, away_team_score)
  )

# Update score for Utica game at Hobart

# Update scores for games with Greensboro, Shenandoah, Virginia Wesleyan, and Averett

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Greensboro vs Guilford
    home_team_score = ifelse(Home == "Greensboro" & Away == "Guilford", 0, home_team_score),
    away_team_score = ifelse(Home == "Greensboro" & Away == "Guilford", 1, away_team_score),
    
    # Home game for Shenandoah vs Rutgers-Newark
    home_team_score = ifelse(Home == "Shenandoah" & Away == "Rutgers-Newark", 2, home_team_score),
    away_team_score = ifelse(Home == "Shenandoah" & Away == "Rutgers-Newark", 1, away_team_score),
    
    # Home game for Virginia Wesleyan vs Averett (tie)
    home_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Averett", 2, home_team_score),
    away_team_score = ifelse(Home == "Virginia Wesleyan" & Away == "Averett", 2, away_team_score),
    
    # Home game for Averett vs Johnson & Wales (NC) (tie)
    home_team_score = ifelse(Home == "Averett" & Away == "Johnson & Wales (NC)", 2, home_team_score),
    away_team_score = ifelse(Home == "Averett" & Away == "Johnson & Wales (NC)", 2, away_team_score)
  )

# Update score for Chicago game vs Carthage (tie)

all_schedule_data <- all_schedule_data %>%
  mutate(
    # Home game for Chicago vs Carthage
    home_team_score = ifelse(Home == "Chicago" & Away == "Carthage", 1, home_team_score),
    away_team_score = ifelse(Home == "Chicago" & Away == "Carthage", 1, away_team_score)
  )

# Remove rows with NA in home_team_score or away_team_score
all_schedule_data <- all_schedule_data %>%
  filter(!is.na(home_team_score) & !is.na(away_team_score))

# Remove specified columns and add home_score_margin column
all_schedule_data <- all_schedule_data %>%
  select(-Time.Status, -Links) %>%  # Remove Time.Status and Links columns
  mutate(home_score_margin = home_team_score - away_team_score)  # Calculate home score margin

# Create a data frame for Macalester's home and away games with accurate scores and "yes" for Date

# Data frame for Macalester's home games with accurate scores and dates
# Data frame for Macalester's home games with accurate scores and dates
macalester_home_games <- data.frame(
  Away = c("Carthage", "Luther", "Saint John's (Minn.)", "Central", "Bethel (Minn.)", "St. Scholastica", "Hamline", "St. Mary's (Minn.)"),
  away_team_score = c(0, 0, 1, 1, 1, 0, 0, 0),
  Home = "Macalester",
  home_team_score = c(3, 3, 5, 2, 1, 3, 3, 4),
  Date = format(as.Date(c("2023-09-01", "2023-09-06", "2023-09-13", "2023-09-17", "2023-09-23", "2023-09-27", "2023-10-04", "2023-10-11")), "%Y-%m-%d"),
  home_score_margin = c(3 - 0, 3 - 0, 5 - 1, 2 - 1, 1 - 1, 3 - 0, 3 - 0, 4 - 0)
)

# Data frame for Macalester's away games with accurate scores and dates
macalester_away_games <- data.frame(
  Away = "Macalester",
  away_team_score = c(4, 1, 0, 3, 1, 1, 3, 2),
  Home = c("Simpson", "Wartburg", "Gustavus Adolphus", "Concordia (MI)", "St. Olaf", "Carleton", "UW-Superior", "Augsburg"),
  home_team_score = c(2, 1, 1, 1, 1, 2, 1, 2),
  Date = format(as.Date(c("2023-09-03", "2023-09-09", "2023-09-20", "2023-09-26", "2023-09-30", "2023-10-07", "2023-10-15", "2023-10-21")), "%Y-%m-%d"),
  home_score_margin = c(2 - 4, 1 - 1, 1 - 0, 1 - 3, 1 - 1, 2 - 1, 1 - 3, 2 - 2)
)

# Combine Macalester's home and away games and add to the main dataset
all_schedule_data <- rbind(all_schedule_data, macalester_home_games, macalester_away_games)



# Update scores for UW-Superior games with dates
library(dplyr)

# Convert the Date column to character to ensure consistency
all_schedule_data <- all_schedule_data %>%
  mutate(Date = as.character(Date))

# Add the new rows
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "St. John's (Minn.)", Away = "UW-Superior", home_team_score = 1, away_team_score = 0, Date = "2023-09-05", home_score_margin = 1 - 0) %>%
  add_row(Home = "UW-Platteville", Away = "UW-Superior", home_team_score = 1, away_team_score = 1, Date = "2023-09-10", home_score_margin = 1 - 1) %>%
  add_row(Home = "Minn.-Morris", Away = "UW-Superior", home_team_score = 0, away_team_score = 4, Date = "2023-09-16", home_score_margin = 0 - 4) %>%
  add_row(Home = "Bethany Lutheran", Away = "UW-Superior", home_team_score = 0, away_team_score = 2, Date = "2023-10-14", home_score_margin = 0 - 2) %>%
  add_row(Home = "Martin Luther", Away = "UW-Superior", home_team_score = 0, away_team_score = 3, Date = "2023-10-21", home_score_margin = 0 - 3) %>%
  add_row(Home = "Crown (Minn.)", Away = "UW-Superior", home_team_score = 1, away_team_score = 4, Date = "2023-10-28", home_score_margin = 1 - 4) %>%
  
  # Home games for UW-Superior
  add_row(Home = "UW-Superior", Away = "North Central (Minn.)", home_team_score = 5, away_team_score = 1, Date = "2023-09-13", home_score_margin = 5 - 1) %>%
  add_row(Home = "UW-Superior", Away = "Northwestern (Minn.)", home_team_score = 2, away_team_score = 1, Date = "2023-09-19", home_score_margin = 2 - 1) %>%
  add_row(Home = "UW-Superior", Away = "Augsburg", home_team_score = 1, away_team_score = 0, Date = "2023-09-20", home_score_margin = 1 - 0) %>%
  add_row(Home = "UW-Superior", Away = "Bethany Lutheran", home_team_score = 0, away_team_score = 1, Date = "2023-09-24", home_score_margin = 0 - 1) %>%
  add_row(Home = "UW-Superior", Away = "Northland", home_team_score = 6, away_team_score = 2, Date = "2023-09-27", home_score_margin = 6 - 2) %>%
  add_row(Home = "UW-Superior", Away = "Martin Luther", home_team_score = 7, away_team_score = 0, Date = "2023-09-30", home_score_margin = 7 - 0) %>%
  add_row(Home = "UW-Superior", Away = "Crown (Minn.)", home_team_score = 3, away_team_score = 0, Date = "2023-10-03", home_score_margin = 3 - 0) %>%
  add_row(Home = "UW-Superior", Away = "St. Scholastica", home_team_score = 6, away_team_score = 0, Date = "2023-10-04", home_score_margin = 6 - 0) %>%
  add_row(Home = "UW-Superior", Away = "Minn.-Morris", home_team_score = 6, away_team_score = 0, Date = "2023-10-07", home_score_margin = 6 - 0) %>%
  add_row(Home = "UW-Superior", Away = "North Central (Minn.)", home_team_score = 6, away_team_score = 0, Date = "2023-10-18", home_score_margin = 6 - 0) %>%
  add_row(Home = "UW-Superior", Away = "Northland", home_team_score = 2, away_team_score = 1, Date = "2023-10-24", home_score_margin = 2 - 1)

# Optional: Convert Date column back to date format
all_schedule_data <- all_schedule_data %>%
  mutate(Date = as.Date(Date, format = "%Y-%m-%d"))


library(dplyr)

# Convert Date column to Date class for consistency in all_schedule_data
all_schedule_data <- all_schedule_data %>%
  mutate(Date = as.Date(Date, format = "%Y-%m-%d"))

# Create the new games data frame for regular season games only
new_games <- data.frame(
  Home = c("Gustavus Adolphus", "Loras", "Hamline", "Augsburg", "Gustavus Adolphus", "Gustavus Adolphus", 
           "Luther", "Gustavus Adolphus", "Bethel (Minn.)", "St. Olaf", "Gustavus Adolphus", "Saint John's"),
  Away = c("Knox", "Gustavus Adolphus", "Gustavus Adolphus", "Gustavus Adolphus", "Saint Mary's", 
           "Saint John's (Minn.)", "Gustavus Adolphus", "Bethany Lutheran", "Gustavus Adolphus", 
           "Gustavus Adolphus", "St. Scholastica", "Gustavus Adolphus"),
  home_team_score = c(1, 1, 3, 0, 0, 2, 1, 5, 2, 2, 6, 2),
  away_team_score = c(0, 1, 3, 0, 1, 0, 1, 2, 1, 2, 1, 0),
  Date = as.Date(c("2023-08-30", "2023-09-08", "2023-09-23", "2023-09-30", "2023-10-03", 
                   "2023-10-06", "2023-10-16", "2023-10-19", "2023-10-21", "2023-10-24", 
                   "2023-10-28", "2023-10-30")),
  home_score_margin = c(1 - 0, 1 - 1, 3 - 3, 0 - 0, 0 - 1, 2 - 0, 1 - 1, 5 - 2, 2 - 1, 2 - 2, 6 - 1, 2 - 0)
)

# Add the new games to all_schedule_data
all_schedule_data <- bind_rows(all_schedule_data, new_games)



# Adding St. Olaf's regular season games
new_st_olaf_games <- tibble(
  Home = c("St. Olaf", "Hamline", "Saint John's (Minn.)", "St. Olaf", "St. Olaf", "St. Olaf", "Augsburg", "Bethel (Minn.)"),
  Away = c("Luther", "St. Olaf", "St. Olaf", "Saint Mary's (Minn.)", "Northwestern (Minn.)", "Minn.-Morris", "St. Olaf", "St. Olaf"),
  home_team_score = c(0, 1, 1, 3, 4, 6, 0, 0),
  away_team_score = c(0, 1, 2, 1, 1, 0, 1, 2),
  Date = as.Date(c("2023-09-01", "2023-09-05", "2023-09-12", "2023-09-19", "2023-09-24", "2023-09-27", "2023-10-07", "2023-10-14")),
  home_score_margin = c(0, -1, -1, 2, 3, 6, -1, -2)
)

# Adding the new games to the existing dataset
all_schedule_data <- bind_rows(all_schedule_data, new_st_olaf_games)


# Standardize all variations of "St. John's" to "Saint John's (Minn.)"
all_schedule_data <- all_schedule_data %>%
  mutate(
    Home = str_replace_all(Home, "St\\. John's \\(MN\\)|St\\. John's \\(Minn\\.\\)|St\\. Johns \\(MN\\)", "Saint John's (Minn.)"),
    Away = str_replace_all(Away, "St\\. John's \\(MN\\)|St\\. John's \\(Minn\\.\\)|St\\. Johns \\(MN\\)", "Saint John's (Minn.)")
  )


# Load necessary library
library(dplyr)

# Add regular season games for Milwaukee Engineering to the dataset
all_schedule_data <- all_schedule_data %>%
  add_row(Away = "Wartburg", Home = "Milwaukee Engineering", away_team_score = 3, home_team_score = 2, Date = as.Date("2023-09-01"), home_score_margin = 2 - 3) %>%
  add_row(Away = "Wheaton (Ill.)", Home = "Milwaukee Engineering", away_team_score = 1, home_team_score = 2, Date = as.Date("2023-09-09"), home_score_margin = 2 - 1) %>%
  add_row(Away = "Elmhurst", Home = "Milwaukee Engineering", away_team_score = 1, home_team_score = 2, Date = as.Date("2023-09-13"), home_score_margin = 2 - 1) %>%
  add_row(Away = "Milwaukee Engineering", Home = "Edgewood", away_team_score = 4, home_team_score = 1, Date = as.Date("2023-09-16"), home_score_margin = 1 - 4) %>%
  add_row(Away = "Carthage", Home = "Milwaukee Engineering", away_team_score = 1, home_team_score = 3, Date = as.Date("2023-09-17"), home_score_margin = 3 - 1) %>%
  add_row(Away = "Milwaukee Engineering", Home = "Lakeland", away_team_score = 1, home_team_score = 0, Date = as.Date("2023-09-20"), home_score_margin = 0 - 1) %>%
  add_row(Away = "Marian", Home = "Milwaukee Engineering", away_team_score = 0, home_team_score = 2, Date = as.Date("2023-09-27"), home_score_margin = 2 - 0) %>%
  add_row(Away = "Milwaukee Engineering", Home = "Dominican", away_team_score = 2, home_team_score = 0, Date = as.Date("2023-09-30"), home_score_margin = 0 - 2) %>%
  add_row(Away = "Concordia-Chicago", Home = "Milwaukee Engineering", away_team_score = 0, home_team_score = 8, Date = as.Date("2023-10-07"), home_score_margin = 8 - 0) %>%
  add_row(Away = "Milwaukee Engineering", Home = "Aurora", away_team_score = 2, home_team_score = 2, Date = as.Date("2023-10-14"), home_score_margin = 2 - 2) %>%
  add_row(Away = "Milwaukee Engineering", Home = "St. Norbert", away_team_score = 1, home_team_score = 1, Date = as.Date("2023-10-18"), home_score_margin = 1 - 1) %>%
  add_row(Away = "Benedictine", Home = "Milwaukee Engineering", away_team_score = 2, home_team_score = 6, Date = as.Date("2023-10-21"), home_score_margin = 6 - 2) %>%
  add_row(Away = "Wisconsin Lutheran", Home = "Milwaukee Engineering", away_team_score = 1, home_team_score = 2, Date = as.Date("2023-10-25"), home_score_margin = 2 - 1) %>%
  add_row(Away = "Concordia (Wis.)", Home = "Milwaukee Engineering", away_team_score = 1, home_team_score = 3, Date = as.Date("2023-10-04"), home_score_margin = 3 - 1)

# Add regular season games for Lebanon Valley to the dataset
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Lebanon Valley", Away = "Rutgers-Newarkr", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-09-01"), home_score_margin = 4 - 0) %>%
  add_row(Home = "Lebanon Valley", Away = "Gettysburg", home_team_score = 3, away_team_score = 0, Date = as.Date("2023-09-12"), home_score_margin = 3 - 0) %>%
  add_row(Home = "Cairn", Away = "Lebanon Valley", home_team_score = 1, away_team_score = 6, Date = as.Date("2023-09-16"), home_score_margin = 1 - 6) %>%
  add_row(Home = "Lebanon Valley", Away = "York (Pa.)", home_team_score = 3, away_team_score = 1, Date = as.Date("2023-09-20"), home_score_margin = 3 - 1) %>%
  add_row(Home = "Misericordia", Away = "Lebanon Valley", home_team_score = 2, away_team_score = 5, Date = as.Date("2023-09-30"), home_score_margin = 2 - 5) %>%
  add_row(Home = "Lebanon Valley", Away = "Lancaster Bible", home_team_score = 3, away_team_score = 3, Date = as.Date("2023-10-03"), home_score_margin = 3 - 3) %>%
  add_row(Home = "Lebanon Valley", Away = "FDU-Florham", home_team_score = 3, away_team_score = 0, Date = as.Date("2023-10-07"), home_score_margin = 3 - 0) %>%
  add_row(Home = "Lebanon Valley", Away = "Delaware Valley", home_team_score = 4, away_team_score = 3, Date = as.Date("2023-10-14"), home_score_margin = 4 - 3) %>%
  add_row(Home = "Alvernia", Away = "Lebanon Valley", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-10"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Arcadia", Away = "Lebanon Valley", home_team_score = 0, away_team_score = 2, Date = as.Date("2023-10-24"), home_score_margin = 0 - 2) %>%
  add_row(Home = "DeSales", Away = "Lebanon Valley", home_team_score = 1, away_team_score = 1, Date = as.Date("2023-10-18"), home_score_margin = 1 - 1) %>%
  add_row(Home = "Stevens", Away = "Lebanon Valley", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-28"), home_score_margin = 0 - 0)


# Ensure Date column in all_schedule_data is in Date format
all_schedule_data <- all_schedule_data %>%
  mutate(Date = as.Date(Date, format = "%Y-%m-%d"))

# Add regular season games for Rhodes, excluding specified games
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Mary Hardin-Baylor", Away = "Rhodes", home_team_score = 1, away_team_score = 1, Date = as.Date("2023-09-01"), home_score_margin = 1 - 1) %>%
  add_row(Home = "Rhodes", Away = "Stockton", home_team_score = 1, away_team_score = 2, Date = as.Date("2023-09-15"), home_score_margin = 1 - 2) %>%
  add_row(Home = "Millsaps", Away = "Rhodes", home_team_score = 0, away_team_score = 3, Date = as.Date("2023-09-22"), home_score_margin = 0 - 3) %>%
  add_row(Home = "Belhaven", Away = "Rhodes", home_team_score = 2, away_team_score = 3, Date = as.Date("2023-09-26"), home_score_margin = 2 - 3) %>%
  add_row(Home = "Rhodes", Away = "Birmingham Southern", home_team_score = 3, away_team_score = 1, Date = as.Date("2023-09-30"), home_score_margin = 3 - 1) %>%
  add_row(Home = "Sewanee", Away = "Rhodes", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-06"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Centre", Away = "Rhodes", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-08"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Rhodes", Away = "Oglethorpe", home_team_score = 2, away_team_score = 1, Date = as.Date("2023-10-13"), home_score_margin = 2 - 1) %>%
  add_row(Home = "Rhodes", Away = "Berry", home_team_score = 1, away_team_score = 0, Date = as.Date("2023-10-15"), home_score_margin = 1 - 0) %>%
  add_row(Home = "Rhodes", Away = "Hendrix", home_team_score = 2, away_team_score = 0, Date = as.Date("2023-10-21"), home_score_margin = 2 - 0)

library(dplyr)

# Add the missing games to your dataset
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Dominican", Away = "Elmhurst", 
          home_team_score = 2, away_team_score = 0, 
          Date = as.Date("2023-09-06"), 
          home_score_margin = 2 - 0) %>%
  add_row(Home = "Dominican", Away = "Aurora", 
          home_team_score = 2, away_team_score = 2, 
          Date = as.Date("2023-09-13"), 
          home_score_margin = 2 - 2) %>%
  add_row(Home = "Dominican", Away = "Luther", 
          home_team_score = 0, away_team_score = 1, 
          Date = as.Date("2023-09-16"), 
          home_score_margin = 0 - 1) %>%
  add_row(Home = "Benedictine", Away = "Dominican", 
          home_team_score = 1, away_team_score = 2, 
          Date = as.Date("2023-09-20"), 
          home_score_margin = 1 - 2) %>%
  add_row(Home = "St. Norbert", Away = "Dominican", 
          home_team_score = 1, away_team_score = 3, 
          Date = as.Date("2023-09-23"), 
          home_score_margin = 1 - 3) %>%
  add_row(Home = "Dominican", Away = "Loras", 
          home_team_score = 0, away_team_score = 2, 
          Date = as.Date("2023-09-24"), 
          home_score_margin = 0 - 2) %>%
  add_row(Home = "Dominican", Away = "Lakeland", 
          home_team_score = 2, away_team_score = 0, 
          Date = as.Date("2023-09-27"), 
          home_score_margin = 2 - 0) %>%
  add_row(Home = "Marian", Away = "Dominican", 
          home_team_score = 1, away_team_score = 3, 
          Date = as.Date("2023-10-07"), 
          home_score_margin = 1 - 3) %>%
  add_row(Home = "Dominican", Away = "Edgewood", 
          home_team_score = 2, away_team_score = 1, 
          Date = as.Date("2023-10-11"), 
          home_score_margin = 2 - 1) %>%
  add_row(Home = "Dominican", Away = "Wisconsin Lutheran", 
          home_team_score = 3, away_team_score = 1, 
          Date = as.Date("2023-10-14"), 
          home_score_margin = 3 - 1) %>%
  add_row(Home = "Dominican", Away = "Rockford", 
          home_team_score = 3, away_team_score = 0, 
          Date = as.Date("2023-10-18"), 
          home_score_margin = 3 - 0) %>%
  add_row(Home = "Concordia-Chicago", Away = "Dominican", 
          home_team_score = 0, away_team_score = 3, 
          Date = as.Date("2023-10-25"), 
          home_score_margin = 0 - 3)

library(dplyr)

# Adding Montclair State's games to the dataset
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Montclair State", Away = "Hunter", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-09-03"), home_score_margin = 4 - 0) %>%
  add_row(Home = "Montclair State", Away = "Vassar", home_team_score = 1, away_team_score = 1, Date = as.Date("2023-09-16"), home_score_margin = 1 - 1) %>%
  add_row(Home = "Montclair State", Away = "Alvernia", home_team_score = 2, away_team_score = 1, Date = as.Date("2023-09-20"), home_score_margin = 2 - 1) %>%
  add_row(Home = "New Jersey City", Away = "Montclair State", home_team_score = 4, away_team_score = 1, Date = as.Date("2023-09-22"), home_score_margin = 4 - 1) %>%
  add_row(Home = "Montclair State", Away = "Stockton", home_team_score = 3, away_team_score = 0, Date = as.Date("2023-09-27"), home_score_margin = 3 - 0) %>%
  add_row(Home = "Ramapo", Away = "Montclair State", home_team_score = 4, away_team_score = 1, Date = as.Date("2023-09-30"), home_score_margin = 4 - 1) %>%
  add_row(Home = "Penn St.-Abington", Away = "Montclair State", home_team_score = 2, away_team_score = 1, Date = as.Date("2023-10-03"), home_score_margin = 2 - 1) %>%
  add_row(Home = "Rowan", Away = "Montclair State", home_team_score = 4, away_team_score = 1, Date = as.Date("2023-10-07"), home_score_margin = 4 - 1) %>%
  add_row(Home = "Montclair State", Away = "Rutgers-Newark", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-10-11"), home_score_margin = 4 - 0) %>%
  add_row(Home = "TCNJ", Away = "Montclair State", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-10-14"), home_score_margin = 4 - 0) %>%
  add_row(Home = "William Paterson", Away = "Montclair State", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-10-18"), home_score_margin = 4 - 0) 

library(dplyr)

# Adding Wartburg's games to the dataset
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Cornell", Away = "Wartburg", home_team_score = 0, away_team_score = 4, Date = as.Date("2023-09-03"), home_score_margin = 0 - 4) %>%
  add_row(Home = "Wartburg", Away = "St. Scholastica", home_team_score = 3, away_team_score = 0, Date = as.Date("2023-09-05"), home_score_margin = 3 - 0) %>%
  add_row(Home = "Knox", Away = "Wartburg", home_team_score = 0, away_team_score = 1, Date = as.Date("2023-09-10"), home_score_margin = 0 - 1) %>%
  add_row(Home = "North Park", Away = "Wartburg", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-09-15"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Wartburg", Away = "Coe", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-09-30"), home_score_margin = 4 - 0) %>%
  add_row(Home = "Neb. Wesleyan", Away = "Wartburg", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-04"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Luther", Away = "Wartburg", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-07"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Wartburg", Away = "Loras", home_team_score = 0, away_team_score = 2, Date = as.Date("2023-10-10"), home_score_margin = 0 - 2) %>%
  add_row(Home = "Central", Away = "Wartburg", home_team_score = 0, away_team_score = 1, Date = as.Date("2023-10-14"), home_score_margin = 0 - 1) %>%
  add_row(Home = "Wartburg", Away = "Saint John's", home_team_score = 2, away_team_score = 0, Date = as.Date("2023-10-15"), home_score_margin = 2 - 0) %>%
  add_row(Home = "Wartburg", Away = "Buena Vista", home_team_score = 2, away_team_score = 0, Date = as.Date("2023-10-24"), home_score_margin = 2 - 0) 

# Adding Pacific Lutheran games to all_schedule_data
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Neutral", Away = "Nebraska Wesleyan", home_team_score = 2, away_team_score = 2, Date = as.Date("2023-09-03"), home_score_margin = 2 - 2) %>%
  add_row(Home = "Pacific Lutheran", Away = "Whitworth", home_team_score = 4, away_team_score = 1, Date = as.Date("2023-09-16"), home_score_margin = 4 - 1) %>%
  add_row(Home = "Pacific Lutheran", Away = "Whitman", home_team_score = 6, away_team_score = 0, Date = as.Date("2023-09-17"), home_score_margin = 6 - 0) %>%
  add_row(Home = "George Fox", Away = "Pacific Lutheran", home_team_score = 0, away_team_score = 9, Date = as.Date("2023-09-23"), home_score_margin = 0 - 9) %>%
  add_row(Home = "Linfield", Away = "Pacific Lutheran", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-09-24"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Puget Sound", Away = "Pacific Lutheran", home_team_score = 2, away_team_score = 6, Date = as.Date("2023-10-04"), home_score_margin = 2 - 6) %>%
  add_row(Home = "Whitworth", Away = "Pacific Lutheran", home_team_score = 2, away_team_score = 4, Date = as.Date("2023-10-14"), home_score_margin = 2 - 4) %>%
  add_row(Home = "Whitman", Away = "Pacific Lutheran", home_team_score = 1, away_team_score = 3, Date = as.Date("2023-10-15"), home_score_margin = 1 - 3) %>%
  add_row(Home = "Pacific Lutheran", Away = "George Fox", home_team_score = 7, away_team_score = 0, Date = as.Date("2023-10-21"), home_score_margin = 7 - 0) %>%
  add_row(Home = "Pacific Lutheran", Away = "Linfield", home_team_score = 2, away_team_score = 0, Date = as.Date("2023-10-22"), home_score_margin = 2 - 0) %>%
  add_row(Home = "Pacific Lutheran", Away = "Lewis & Clark", home_team_score = 5, away_team_score = 0, Date = as.Date("2023-10-29"), home_score_margin = 5 - 0) %>%
  add_row(Home = "Pacific Lutheran", Away = "Puget Sound", home_team_score = 3, away_team_score = 1, Date = as.Date("2023-11-01"), home_score_margin = 3 - 1) %>%
  add_row(Home = "Willamette", Away = "Pacific Lutheran", home_team_score = 2, away_team_score = 1, Date = as.Date("2023-11-01"), home_score_margin = 2 - 1)



# Adding games for North Central (Ill.)
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "North Central (Ill.)", Away = "Benedictine", home_team_score = 3, away_team_score = 1, Date = as.Date("2023-09-05"), home_score_margin = 3 - 1) %>%
  add_row(Home = "North Central (Ill.)", Away = "Elmhurst", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-09-23"), home_score_margin = 4 - 0) %>%
  add_row(Home = "North Central (Ill.)", Away = "Aurora", home_team_score = 2, away_team_score = 1, Date = as.Date("2023-09-25"), home_score_margin = 2 - 1) %>%
  add_row(Home = "North Central (Ill.)", Away = "Wheaton (Ill.)", home_team_score = 2, away_team_score = 2, Date = as.Date("2023-10-04"), home_score_margin = 2 - 2) %>%
  add_row(Home = "North Central (Ill.)", Away = "Carthage", home_team_score = 7, away_team_score = 2, Date = as.Date("2023-10-07"), home_score_margin = 7 - 2) %>%
  add_row(Home = "North Central (Ill.)", Away = "Millikin", home_team_score = 3, away_team_score = 0, Date = as.Date("2023-10-18"), home_score_margin = 3 - 0) %>%
  add_row(Home = "North Park", Away = "North Central (Ill.)", home_team_score = 1, away_team_score = 1, Date = as.Date("2023-10-11"), home_score_margin = 1 - 1) %>%
  add_row(Home = "Carroll", Away = "North Central (Ill.)", home_team_score = 1, away_team_score = 2, Date = as.Date("2023-10-14"), home_score_margin = 1 - 2) %>%
  add_row(Home = "Illinois Wesleyan", Away = "North Central (Ill.)", home_team_score = 1, away_team_score = 5, Date = as.Date("2023-10-21"), home_score_margin = 1 - 5) %>%
  add_row(Home = "Augustana", Away = "North Central (Ill.)", home_team_score = 0, away_team_score = 5, Date = as.Date("2023-10-25"), home_score_margin = 0 - 5)

# Adding games for Oglethorpe
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Piedmont", Away = "Oglethorpe", home_team_score = 0, away_team_score = 4, Date = as.Date("2023-09-17"), home_score_margin = 0 - 4) %>%
  add_row(Home = "Oglethorpe", Away = "Centre", home_team_score = 2, away_team_score = 0, Date = as.Date("2023-09-23"), home_score_margin = 2 - 0) %>%
  add_row(Home = "Sewanee", Away = "Oglethorpe", home_team_score = 1, away_team_score = 2, Date = as.Date("2023-09-29"), home_score_margin = 1 - 2) %>%
  add_row(Home = "Oglethorpe", Away = "Birmingham Southern", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-10-06"), home_score_margin = 4 - 0) %>%
  add_row(Home = "Oglethorpe", Away = "Millsaps", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-10-08"), home_score_margin = 4 - 0) %>%
  add_row(Home = "Hendrix", Away = "Oglethorpe", home_team_score = 0, away_team_score = 3, Date = as.Date("2023-10-15"), home_score_margin = 0 - 3) %>%
  add_row(Home = "Oglethorpe", Away = "Berry", home_team_score = 1, away_team_score = 0, Date = as.Date("2023-10-21"), home_score_margin = 1 - 0)

# Add Hobart's games to the dataset
all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Hobart", Away = "Keuka", home_team_score = 6, away_team_score = 0, 
          Date = as.Date("2023-09-01"), home_score_margin = 6 - 0) %>%
  add_row(Home = "Hobart", Away = "Nazareth", home_team_score = 1, away_team_score = 1, 
          Date = as.Date("2023-09-13"), home_score_margin = 1 - 1) %>%
  add_row(Home = "Skidmore", Away = "Hobart", home_team_score = 2, away_team_score = 1, 
          Date = as.Date("2023-09-23"), home_score_margin = 2 - 1) %>%
  add_row(Home = "Ithaca", Away = "Hobart", home_team_score = 0, away_team_score = 2, 
          Date = as.Date("2023-09-27"), home_score_margin = 0 - 2) %>%
  add_row(Home = "Clarkson", Away = "Hobart", home_team_score = 0, away_team_score = 2, 
          Date = as.Date("2023-09-30"), home_score_margin = 0 - 2) %>%
  add_row(Home = "Hobart", Away = "Rochester Tech", home_team_score = 1, away_team_score = 0, 
          Date = as.Date("2023-10-04"), home_score_margin = 1 - 0) %>%
  add_row(Home = "Hobart", Away = "Vassar", home_team_score = 2, away_team_score = 2, 
          Date = as.Date("2023-10-07"), home_score_margin = 2 - 2) %>%
  add_row(Home = "RPI", Away = "Hobart", home_team_score = 1, away_team_score = 0, 
          Date = as.Date("2023-10-13"), home_score_margin = 1 - 0) %>%
  add_row(Home = "Hobart", Away = "Utica", home_team_score = 1, away_team_score = 0, 
          Date = as.Date("2023-10-17"), home_score_margin = 1 - 0) %>%
  add_row(Home = "Hobart", Away = "Bard", home_team_score = 3, away_team_score = 2, 
          Date = as.Date("2023-10-21"), home_score_margin = 3 - 2) %>%
  add_row(Home = "Hobart", Away = "St. Lawrence", home_team_score = 3, away_team_score = 2, 
          Date = as.Date("2023-10-28"), home_score_margin = 3 - 2)

library(dplyr)

all_schedule_data <- all_schedule_data %>%
  add_row(Home = "Stevens", Away = "TCNJ", home_team_score = 3, away_team_score = 0, Date = as.Date("2023-09-16"), home_score_margin = 3 - 0) %>%
  add_row(Home = "Widener", Away = "Stevens", home_team_score = 3, away_team_score = 2, Date = as.Date("2023-09-26"), home_score_margin = 3 - 2) %>%
  add_row(Home = "FDU-Florham", Away = "Stevens", home_team_score = 1, away_team_score = 2, Date = as.Date("2023-09-30"), home_score_margin = 1 - 2) %>%
  add_row(Home = "Stevens", Away = "Rutgers-Newark", home_team_score = 2, away_team_score = 1, Date = as.Date("2023-10-04"), home_score_margin = 2 - 1) %>%
  add_row(Home = "Misericordia", Away = "Stevens", home_team_score = 0, away_team_score = 0, Date = as.Date("2023-10-07"), home_score_margin = 0 - 0) %>%
  add_row(Home = "Stevens", Away = "DeSales", home_team_score = 4, away_team_score = 0, Date = as.Date("2023-10-14"), home_score_margin = 4 - 0) %>%
  add_row(Home = "Stevens", Away = "Arcadia", home_team_score = 1, away_team_score = 0, Date = as.Date("2023-10-21"), home_score_margin = 1 - 0) %>%
  add_row(Home = "Delaware Valley", Away = "Stevens", home_team_score = 0, away_team_score = 3, Date = as.Date("2023-10-24"), home_score_margin = 0 - 3)





# View the updated dataset
print(all_schedule_data)








```


```{r}
# Combine Home and Away teams with their respective score columns, then filter for NAs
# Count occurrences of each team in the dataset
library(tidyr)
team_counts <- all_schedule_data %>%
  select(Home, Away) %>%
  pivot_longer(cols = c(Home, Away), names_to = "location", values_to = "Team") %>%
  count(Team, name = "count") %>%
  arrange(desc(count))

# Display the result
print(team_counts)

# Remove duplicate games based on "Home" and "Away" columns
all_schedule_data <- all_schedule_data %>%
  distinct(Home, Away, .keep_all = TRUE)




```


```{r}

library(dplyr)

# Define functions for Elo rating calculation
expected_win_prob <- function(rating_i, rating_j, is_home) {
  if (is_home) {
    rating_i <- rating_i + home_field_advantage
  }
  return(1 / (1 + 10^((rating_j - rating_i) / 400)))
}

mov_multiplier <- function(score_diff, expected_outcome, beta = 0.5) {
  return((score_diff + 1) ^ beta / (expected_outcome + 1))
}

update_elo_ratings <- function(rating_i, rating_j, actual_outcome, score_diff, is_home, K = 32, beta = 0.5) {
  expected_i <- expected_win_prob(rating_i, rating_j, is_home)
  multiplier <- mov_multiplier(score_diff, expected_i, beta)
  
  new_rating_i <- rating_i + (K * multiplier) * (actual_outcome - expected_i)
  new_rating_j <- rating_j + (K * multiplier) * ((1 - actual_outcome) - (1 - expected_i))
  
  return(c(new_rating_i, new_rating_j))
}

# Re-initialize `teams` to include only Division 3 soccer teams from `all_schedule_data`
teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))

# Initialize Elo ratings based on tournament results
initialize_elo_ratings <- function(teams) {
  initial_ratings <- c(
    "National Champion" = 1675,
    "Runner-Up" = 1650,
    "Semifinalist" = 1625,
    "Quarterfinalist" = 1600,
    "Round of 16" = 1575,
    "Round of 32" = 1550,
    "First Round" = 1525,
    "Non-tournament Team" = 1500
  )
  
  tournament_teams <- list(
    "Chicago" = "National Champion",
    "Williams" = "Runner-Up",
    "Stevens" = "Semifinalist",
    "Mary Washington" = "Semifinalist",
    "Gustavus Adolphus" = "Quarterfinalist",
    "Bowdoin" = "Quarterfinalist",
    "Kenyon" = "Quarterfinalist",
    "Johns Hopkins" = "Quarterfinalist",
    "St. Olaf" = "Round of 16",
    "Oneonta State" = "Round of 16",
    "Ohio Northern" = "Round of 16",
    "Cortland State" = "Round of 16",
    "Catholic" = "Round of 16",
    "Washington and Lee" = "Round of 16",
    "Amherst" = "Round of 16",
    "St. Thomas (Tex.)" = "Round of 16",
    "North Central (Ill.)" = "Round of 32",
    "Muhlenberg" = "Round of 32",
    "Calvin" = "Round of 32",
    "UW-Eau Claire" = "Round of 32",
    "North Park" = "Round of 32",
    "Pacific Lutheran" = "Round of 32",
    "Messiah" = "Round of 32",
    "Willamette" = "Round of 32",
    "Rowan" = "Round of 32",
    "St. Lawrence" = "Round of 32",
    "Ohio Wesleyan" = "Round of 32",
    "Franklin and Marshall" = "Round of 32",
    "John Carroll" = "Round of 32",
    "Christopher Newport" = "Round of 32",
    "Tufts" = "Round of 32",
    "Vassar" = "Round of 32",
    # Add teams that lost in the first round
    "Scranton" = "First Round",
    "Babson" = "First Round",
    "Lehman" = "First Round",
    "Merchant Marine" = "First Round",
    "Mass-Boston" = "First Round",
    "Lynchburg" = "First Round",
    "New England College" = "First Round",
    "Rosemont" = "First Round",
    "Penn St.-Harrisburg" = "First Round",
    "Saint Joseph (Conn.)" = "First Round",
    "Marymount" = "First Round",
    "Roger Williams" = "First Round",
    "Middlebury" = "First Round",
    "Worcester State" = "First Round",
    "Husson" = "First Round",
    "Chapman" = "First Round",
    "Carnegie Mellon" = "First Round",
    "Lake Forest" = "First Round",
    "UW-Superior" = "First Round",
    "Greenville" = "First Round",
    "Case Western Reserve" = "First Round",
    "Luther" = "First Round",
    "Aurora" = "First Round",
    "Brevard" = "First Round",
    "Mary Hardin-Baylor" = "First Round",
    "Rose-Hulman" = "First Round",
    "Mt. Aloysius" = "First Round",
    "Wis.-Platteville" = "First Round",
    "New York U." = "First Round",
    "Franciscan" = "First Round",
    "Birmingham Southern" = "First Round"
  )
  
  # Initialize ratings for all teams with a default of 1500
  ratings <- setNames(rep(1500, length(teams)), teams)
  
  # Update ratings based on tournament results
  for (team in names(tournament_teams)) {
    if (team %in% teams) {
      stage <- tournament_teams[[team]]
      ratings[team] <- initial_ratings[stage]
    }
  }
  
  return(ratings)
}

# Step 1: Initialize the ratings for all teams
initial_ratings <- initialize_elo_ratings(teams)

# Step 2: Check the initial ratings for each team before running the algorithm
print("Initial Ratings for Each Team:")
print(initial_ratings)

# Optional: Display tournament teams and their initial ratings separately for easy verification
initial_ratings_df <- data.frame(
  Team = names(initial_ratings),
  Rating = unlist(initial_ratings)
)

# Display only tournament teams with adjusted ratings
tournament_teams_df <- initial_ratings_df %>% filter(Rating > 1500)
print("Tournament Teams and their Initial Ratings:")
print(tournament_teams_df)

# Display non-tournament teams with default ratings
non_tournament_teams_df <- initial_ratings_df %>% filter(Rating == 1500)
print("Non-Tournament Teams with Default Rating of 1500:")
print(non_tournament_teams_df)

# Elo Rating Calculation for Division 3 Soccer with home-field adjustment
elo_ratings_div3 <- function(all_schedule_data, team_ratings, K = 32, beta = 0.5) {
  initial_sum <- sum(team_ratings)  # Calculate initial sum for reference
  
  # Loop through each match to update ratings
  for (i in 1:nrow(all_schedule_data)) {
    home_team <- all_schedule_data$Home[i]
    away_team <- all_schedule_data$Away[i]
    home_team_score <- all_schedule_data$home_team_score[i]
    away_team_score <- all_schedule_data$away_team_score[i]
    
    home_score_margin <- home_team_score - away_team_score
    actual_outcome <- ifelse(home_score_margin > 0, 1, ifelse(home_score_margin == 0, 0.5, 0))
    score_diff <- abs(home_score_margin)
    
    rating_home <- team_ratings[home_team]
    rating_away <- team_ratings[away_team]
    
    # Update ratings with home field advantage for the home team
    new_ratings <- update_elo_ratings(rating_home, rating_away, actual_outcome, score_diff, is_home = TRUE, K, beta)
    team_ratings[home_team] <- new_ratings[1]
    team_ratings[away_team] <- new_ratings[2]
    
    # Optional: Check for zero-sum consistency after each update
    current_sum <- sum(team_ratings)
    if (abs(current_sum - initial_sum) > 1e-6) {
      print(paste("Zero-sum discrepancy detected after game", i, ": current sum =", current_sum))
    }
  }
  
  # Final check to see if the model is zero-sum overall
  final_sum <- sum(team_ratings)
  print(paste("Initial sum of ratings:", initial_sum))
  print(paste("Final sum of ratings:", final_sum))
  
  if (abs(final_sum - initial_sum) < 1e-6) {
    print("The Elo model maintains a zero-sum property.")
  } else {
    print("The Elo model does not maintain a zero-sum property.")
  }
  
  return(team_ratings)
}

# Set the home field advantage
home_field_advantage <- 50  # Adjust as needed

# Step 3: Calculate Elo ratings for all games in the schedule
final_elo_ratings_div3 <- elo_ratings_div3(all_schedule_data, initial_ratings, K = 32)

# Step 4: Convert to a data frame and sort by Elo rating in descending order
elo_ratings_sorted_df <- data.frame(
  Team = names(final_elo_ratings_div3),
  Elo_Rating = unlist(final_elo_ratings_div3)
) %>%
  arrange(desc(Elo_Rating))  # Sort by Elo rating in descending order

# Display the sorted result
print(elo_ratings_sorted_df)





```


```{r, pagerank}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to create an adjusted transition matrix with Laplacian smoothing
create_adjusted_transition_matrix <- function(all_schedule_data, damping_factor = 0.85, beta = 0.5, alpha = 0.01) {
  # Get unique teams
  teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
  
  # Initialize transition matrix
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams) # Map team names to indices
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  
  # Populate the transition matrix based on match results
  for (i in 1:nrow(all_schedule_data)) {
    home_team <- all_schedule_data$Home[i]
    away_team <- all_schedule_data$Away[i]
    home_score <- all_schedule_data$home_team_score[i]
    away_score <- all_schedule_data$away_team_score[i]
    margin <- abs(home_score - away_score)
    
    # Determine the actual outcome (1 = win, 0.5 = draw, 0 = loss)
    # Assign weights based on outcomes
  if (home_score > away_score) {
    # Home win: Reduce the weight slightly
    transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.9
  } else if (home_score < away_score) {
    # Away win: Increase the weight slightly
    transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 1.1
  } else {
    # Draw case
    transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 0.5
    transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.5
  }
}
  
  # Normalize the transition matrix row-wise
  row_sums <- rowSums(transition_matrix)
  
  # Handle rows that sum to zero
  zero_row_indices <- which(row_sums == 0)
  if (length(zero_row_indices) > 0) {
    transition_matrix[zero_row_indices, ] <- 1 / n  # Assign uniform probabilities to zero rows
    row_sums <- rowSums(transition_matrix) # Recalculate row sums
  }
  
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0 # Replace any remaining NA with 0
  
  # Apply Laplacian smoothing (add alpha to all elements and re-normalize rows)
  transition_matrix <- transition_matrix + alpha
  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  
  # Apply damping factor to ensure ergodicity
  transition_matrix <- damping_factor * transition_matrix + (1 - damping_factor) / n
  
  return(transition_matrix)
}

# Function to compute the stationary distribution
compute_stationary_distribution <- function(transition_matrix) {
  eigen_results <- eigen(t(transition_matrix)) # Transpose for left eigenvector
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix) # Assign team names
  return(Re(stationary_distribution)) # Ensure real values
}

# Visualization function
visualize_transition_matrix <- function(transition_matrix) {
  graph <- graph_from_adjacency_matrix(transition_matrix, mode = "directed", weighted = TRUE)
  plot(
    graph,
    vertex.size = 7.5,
    vertex.label.cex = 0.4,
    edge.width = E(graph)$weight * 5,
    edge.arrow.size = 0.25,
    main = "Adjusted Transition Graph for D3 Soccer Rankings"
  )
}

# Main script
# Step 1: Create the adjusted transition matrix
transition_matrix <- create_adjusted_transition_matrix(all_schedule_data)

# Step 2: Validate the transition matrix
print("Check for NA or NaN values:")
print(any(is.na(transition_matrix)))

print("Check for Inf values:")
print(any(is.infinite(transition_matrix)))

print("Row Sums:")
print(rowSums(transition_matrix))

# Step 3: Compute the stationary distribution
stationary_distribution <- compute_stationary_distribution(transition_matrix)

stationary_df_pagerank <- data.frame(Team = names(stationary_distribution), Rating = stationary_distribution)
stationary_df_pagerank <- stationary_df_pagerank %>% arrange(desc(Rating))

# Step 5: Display the results
print("Stationary Distribution Data Frame:")
print(stationary_df_pagerank)

# Step 6: Visualize the transition matrix
visualize_transition_matrix(transition_matrix)






```


```{r, filtered transition}

# Step 1: Filter teams based on games played
# Count the number of games each team has played
laplace.smooth <- .1
team_games_count <- table(c(all_schedule_data$Home, all_schedule_data$Away))

# Only keep teams that have played at least 4 games
qualified_teams <- names(team_games_count[team_games_count >= 4])

# Update the list of teams to include only qualified teams
teams <- qualified_teams
n <- length(teams)
tmat <- matrix(0, n, n, dimnames = list(teams, teams))  # Initialize transition matrix for qualified teams only

# Step 2: Populate the transition matrix with direct match data for qualified teams
team_strengths <- rep(0, n)
names(team_strengths) <- teams
beta <- 1.2  # Increased scaling factor for margin impact to enhance dominant wins

for (i in 1:length(teams)) {
  for (j in (i + 1):length(teams)) {
    # Find all matches between qualified team i and team j
    grow <- which((all_schedule_data$Away == teams[i] | all_schedule_data$Home == teams[i]) & 
                  (all_schedule_data$Away == teams[j] | all_schedule_data$Home == teams[j]))
    
    if (length(grow) > 0) {
      subdata <- all_schedule_data[grow, ]
      ihome <- (subdata$Home == teams[i])
      pitoj <- c()
      
      # Calculate the probabilities for each match with adjusted weights
      for (k in 1:length(grow)) {
        home_score <- subdata$home_team_score[k]
        away_score <- subdata$away_team_score[k]
        margin <- abs(home_score - away_score)
        
        # Determine the outcome and assign weights accordingly
        if (home_score > away_score) {
          # Home win: Apply margin-based weight and slightly increase to emphasize wins
          weight <- margin^beta * 1.2  # Increased the weight factor for home wins
          p <- (home_score + laplace.smooth) / (home_score + away_score + 2 * laplace.smooth)
          p <- p + (1 - 2 * p) * ihome[k]  # Adjust based on home advantage
          pitoj[k] <- max(0, min(1, p * weight))  # Ensure value is within [0, 1]
        } else if (away_score > home_score) {
          # Away win: Apply margin-based weight and increase slightly more for away wins
          weight <- margin^beta * 1.3  # Increased the weight factor for away wins
          p <- (home_score + laplace.smooth) / (home_score + away_score + 2 * laplace.smooth)
          p <- p + (1 - 2 * p) * ihome[k]  # Adjust based on home advantage
          pitoj[k] <- max(0, min(1, p * weight))  # Ensure value is within [0, 1]
        } else {
          # Draw case: Apply a draw weight
          weight <- margin^beta * 0.75  # Increased draw weight to represent parity
          p <- 0.5  # Draws are evenly split
          pitoj[k] <- max(0, min(1, p * weight))  # Ensure value is within [0, 1]
        }
      }
      
      # Calculate the average probability for all matches between teams i and j
      pitoj1 <- mean(pitoj)
      
      # Normalize pitoj1 to ensure it lies between 0 and 1
      pitoj1 <- max(0, min(1, pitoj1))
      
      # Fill the transition matrix
      tmat[i, j] <- pitoj1
      tmat[j, i] <- 1 - pitoj1

      # Update team strengths based on results
      team_strengths[teams[i]] <- team_strengths[teams[i]] + sum(pitoj * ihome)  # Home matches contribution
      team_strengths[teams[j]] <- team_strengths[teams[j]] + sum((1 - pitoj) * (1 - ihome))  # Away matches contribution
    }
  }
}

# Normalize team strengths to be between 0 and 1
max_strength <- max(team_strengths)
if (max_strength > 0) {
  team_strengths <- team_strengths / max_strength
}

# Step 3: Handle teams that have not played each other
# Replace any NA values in the transition matrix with 0 for safety
tmat[is.na(tmat)] <- 0

# Estimate probability for teams that have not played each other based on team strengths
for (i in 1:n) {
  for (j in 1:n) {
    if (i != j && tmat[i, j] == 0) {
      # Use team strengths to estimate probability of team i beating team j
      strength_i <- team_strengths[teams[i]]
      strength_j <- team_strengths[teams[j]]
      
      # Assign probability based on relative strengths, allowing higher values for dominant teams
      if (strength_i + strength_j > 0) {
        tmat[i, j] <- max(0, min(1, strength_i / (strength_i + strength_j)))
        tmat[j, i] <- max(0, min(1, strength_j / (strength_i + strength_j)))
      } else {
        tmat[i, j] <- 0.5
        tmat[j, i] <- 0.5
      }
    }
  }
}

# Step 4: Normalize the transition matrix row-wise to ensure each row sums to 1
row_sums <- rowSums(tmat)

# Normalize rows by dividing each row by its sum
tmat <- sweep(tmat, 1, row_sums, FUN = "/")

# Step 5: Apply damping factor to ensure ergodicity
damping_factor <- 0.85
tmat <- damping_factor * tmat + (1 - damping_factor) / n

# Step 6: Compute the stationary distribution using the eigenvalue-based approach
compute_stationary_distribution <- function(transition_matrix) {
  eigen_results <- eigen(t(transition_matrix))  # Transpose for left eigenvector
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix)  # Assign team names
  return(Re(stationary_distribution))  # Ensure real values
}

# Calculate the stationary distribution
stationary_distribution <- compute_stationary_distribution(tmat)

# Convert and sort stationary distribution for better understanding
stationary_df_filtered <- data.frame(Team = names(stationary_distribution), Rating = as.numeric(stationary_distribution))

# Sort the dataframe in descending order by Rating so that the highest-rated team is at the top
stationary_df_filtered <- stationary_df_filtered[order(-stationary_df_filtered$Rating), ]

# Reset row names for better readability
rownames(stationary_df_filtered) <- NULL

# Step 7: Display the results
print("Stationary Distribution Data Frame (Team Rankings):")
print(stationary_df_filtered)

# Visualization of the transition matrix with igraph
library(igraph)

visualize_transition_matrix <- function(transition_matrix) {
  # Ensure all edge weights are positive for igraph
  graph <- graph_from_adjacency_matrix(transition_matrix, mode = "directed", weighted = TRUE)
  plot(
    graph,
    vertex.size = 7.5,
    vertex.label.cex = 0.4,
    edge.width = pmax(E(graph)$weight * 5, 0.1),  # Set a minimum edge width for visibility
    edge.arrow.size = 0.25,
    main = "Transition Graph for Team Ratings"
  )
}

# Visualize the transition matrix
visualize_transition_matrix(tmat)


```


```{r}
laplace.smooth <- .1
tmat <- matrix(0,length(teams), length(teams))
for (i in 1:length(teams)) {
  for (j in (i+1):length(teams)) {
   grow <- which((all_schedule_data$Away==teams[i] | all_schedule_data$Home==teams[i]) & (all_schedule_data$Away==teams[j] | all_schedule_data$Home==teams[j]))   
   if (length(grow) > 1) {
   subdata <- all_schedule_data[grow,]
   ihome <- (subdata$Home == teams[i])
   pitoj <- c()
   for (k in 1:length(grow)) { 
     pitoj[k] <- (subdata$home_team_score[k]+laplace.smooth)/(subdata$away_team_score[k]+subdata$home_team_score[k]+2*laplace.smooth) 
     pitoj[k] <- pitoj[k] + (1-2*pitoj[k])*ihome[k]
   }
   pitoj1 <- mean(pitoj)
   tmat[i,j] <- pitoj1
   tmat[j,i] <- 1-pitoj1
   }
  }
}

```

```{r, winmargin}

# Load necessary libraries
library(dplyr)
library(igraph)
# Function to create an adjusted transition matrix with Laplacian smoothing
create_adjusted_transition_matrix <- function(all_schedule_data, damping_factor = 0.85, beta = 1.2, alpha = 0.01) {
  # Get unique teams
  teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
  
  # Initialize transition matrix with team names as row and column labels
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)  # Map team names to indices
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  
  # Populate the transition matrix with direct match data
  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      # Find all matches between team i and team j
      grow <- which((all_schedule_data$Away == teams[i] | all_schedule_data$Home == teams[i]) & 
                    (all_schedule_data$Away == teams[j] | all_schedule_data$Home == teams[j]))
      
      if (length(grow) >= 1) {  # Proceed with at least one match
        subdata <- all_schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()
        
        # Calculate the probabilities for each match with adjusted weights
        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]
          margin <- abs(home_score - away_score)
          
          # Calculate pitoj with Laplacian smoothing and incorporate margin
          if (home_score + away_score > 0) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else {
            p <- 0.5  # Assign equal probability if both scores are zero
          }
          pitoj[k] <- max(0, min(1, p))  # Ensure value is between 0 and 1
        }
        
        # Average probability for all matches between i and j
        pitoj1 <- mean(pitoj)
        
        # Update transition matrix
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }
  
  # Normalize the transition matrix row-wise
  row_sums <- rowSums(transition_matrix)
  #row_sums[row_sums == 0] <- 1  # Prevent division by zero
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  
  # Apply damping factor to ensure ergodicity
  #transition_matrix <- damping_factor * transition_matrix + (1 - damping_factor) / n
  
  return(transition_matrix)
}


# Create the transition matrix using your game data
transition_matrix <- create_adjusted_transition_matrix(all_schedule_data)


# Simulate a Random Walk to See How the Markov Chain Behaves
i <- 47  # Starting from team index 47
for (j in 1:1000) {
  i <- sample(nrow(transition_matrix), 1, prob = transition_matrix[i, ])
  print(rownames(transition_matrix)[i])  # Display the team name
}

# Matrix Multiplication to Find the Stationary Distribution
b <- transition_matrix
for (i in 1:1000) {
  b <- b %*% transition_matrix
}

# Extract the Stationary Distribution (any row will be the same after convergence)
stationary_distribution <- b[1, ]  # Take the first row after convergence

# Normalize to ensure it's a valid probability distribution
stationary_distribution <- stationary_distribution / sum(stationary_distribution)

# Assign team names to the distribution for clarity
names(stationary_distribution) <- rownames(transition_matrix)

# Display the stationary distribution sorted by ranking
stationary_df_winmargin <- data.frame(Team = names(stationary_distribution), 
                            Probability = as.numeric(stationary_distribution))
stationary_df_winmargin <- stationary_df_winmargin[order(-stationary_df_winmargin$Probability), ]
rownames(stationary_df_winmargin) <- NULL

# View the stationary distribution
print("Stationary Distribution (Team Rankings):")
print(stationary_df_winmargin)

# Convert the matrix to a data frame
transition_df <- as.data.frame(transition_matrix)

# Add team names as a column for easier reference
transition_df$Team <- rownames(transition_matrix)

# Move 'Team' column to the front
transition_df <- transition_df[, c("Team", setdiff(names(transition_df), "Team"))]

# View the transition matrix as a data frame
print("Transition Matrix (as Data Frame):")
print(transition_df)


visualize_transition_matrix <- function(transition_matrix, schedule_data, min_games = 3, min_edge_weight = 0.02) {
  library(igraph)
  library(dplyr)

  # Step 1: Determine valid teams based on actual schedule data
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Home_Games = n(), .groups = "drop") %>%
    full_join(
      schedule_data %>% group_by(Away) %>% summarise(Away_Games = n(), .groups = "drop"),
      by = c("Home" = "Away")
    ) %>%
    mutate(Total_Games = rowSums(across(c(Home_Games, Away_Games)), na.rm = TRUE)) %>%
    filter(Total_Games >= min_games)

  valid_teams <- team_game_counts$Home

  # Step 2: Subset the transition matrix to valid teams only
  filtered_matrix <- transition_matrix[rownames(transition_matrix) %in% valid_teams,
                                       colnames(transition_matrix) %in% valid_teams]

  # Step 3: Create igraph object
  g <- graph_from_adjacency_matrix(filtered_matrix, mode = "directed", weighted = TRUE)

  # Step 4: Remove low-weight edges
  g <- delete_edges(g, E(g)[weight < min_edge_weight])

  # Step 5: Add node labels and layout
  V(g)$label <- V(g)$name
  layout <- layout_with_fr(g)

  # Step 6: Plot
  plot(
    g,
    layout = layout,
    vertex.size = 8,              # Slightly larger nodes
    vertex.label.cex = 0.3,       # Slightly smaller labels
    vertex.label.color = "black",
    edge.width = E(g)$weight * 4,
    edge.arrow.size = 0.05,
    main = paste0(" Transition Matrix Graph (Teams w/  ", min_games, " Games)")
  )
}

visualize_transition_matrix(transition_matrix, all_schedule_data, min_games = 3)


```

```{r}
library(igraph)

# Convert transition matrix to graph
graph <- graph_from_adjacency_matrix(transition_matrix, mode = "directed", weighted = TRUE)

# Compute PageRank centrality
pagerank_scores <- page.rank(graph)$vector

# Compute betweenness centrality
betweenness_scores <- betweenness(graph, directed = TRUE, weights = E(graph)$weight)

# Create a dataframe with results
centrality_df <- data.frame(
  Team = rownames(transition_matrix),
  PageRank = pagerank_scores,
  Betweenness = betweenness_scores
)

 sciac_teams<- c("Cal Lutheran", "Chapman", "Claremont-Mudd-Scripps", "La Verne", 
                        "Occidental", "Pomona-Pitzer", "Redlands", "Whittier", "Caltech")

# Identify SCIAC teams
centrality_df$Conference <- ifelse(centrality_df$Team %in% sciac_teams, "SCIAC", "Non-SCIAC")

# Compare SCIAC vs Non-SCIAC in terms of connectivity
library(ggplot2)
ggplot(centrality_df, aes(x = Conference, y = PageRank)) + 
  geom_boxplot() + 
  ggtitle("Comparison of PageRank Centrality: SCIAC vs Non-SCIAC")

```







```{r}
# Function to simulate Poisson-distributed match results with adjusted SCIAC lambda
simulate_poisson_games_alt <- function(all_schedule_data, lambda_sciac_alt = 2.5, lambda_other_alt = 1.0) {
  sciac_teams_alt <- c("Cal Lutheran", "Chapman", "Claremont-Mudd-Scripps", "La Verne", 
                        "Occidental", "Pomona-Pitzer", "Redlands", "Whittier", "Caltech")
  
  # Copy original dataset to avoid modifying all_schedule_data
  simulated_schedule_alt <- all_schedule_data
  
  for (i in 1:nrow(simulated_schedule_alt)) {
    home_team_alt <- simulated_schedule_alt$Home[i]
    away_team_alt <- simulated_schedule_alt$Away[i]
    
    # Assign lambda based on whether the team is in SCIAC or not
    lambda_home_alt <- ifelse(home_team_alt %in% sciac_teams_alt, lambda_sciac_alt, lambda_other_alt)
    lambda_away_alt <- ifelse(away_team_alt %in% sciac_teams_alt, lambda_sciac_alt, lambda_other_alt)
    
    # Simulate new scores using Poisson distribution
    simulated_schedule_alt$home_team_score[i] <- rpois(1, lambda_home_alt)
    simulated_schedule_alt$away_team_score[i] <- rpois(1, lambda_away_alt)

    # Correctly compute the home score margin
    simulated_schedule_alt$home_score_margin[i] <- simulated_schedule_alt$home_team_score[i] - simulated_schedule_alt$away_team_score[i]
  }
  
  return(simulated_schedule_alt)
}

# Generate a new dataset with Poisson-simulated results
simulated_schedule_poisson_alt <- simulate_poisson_games_alt(all_schedule_data)

# Check if the home_score_margin column was correctly computed
head(simulated_schedule_poisson_alt)




```
```{r}
# Define SCIAC team names
sciac_teams <- c("Cal Lutheran", "Chapman", "Claremont-Mudd-Scripps", "La Verne", 
                 "Occidental", "Pomona-Pitzer", "Redlands", "Whittier", "Caltech")

# Filter to only games where one team is SCIAC and the other is not
sciac_vs_non <- simulated_schedule_poisson_alt %>%
  filter((Home %in% sciac_teams & !(Away %in% sciac_teams)) |
         (Away %in% sciac_teams & !(Home %in% sciac_teams)))

# Count number of SCIAC wins
sciac_wins <- sciac_vs_non %>%
  mutate(
    winner = case_when(
      Home %in% sciac_teams & home_team_score > away_team_score ~ "SCIAC",
      Away %in% sciac_teams & away_team_score > home_team_score ~ "SCIAC",
      TRUE ~ "Other"
    )
  ) %>%
  summarise(
    total_OOC_games = n(),
    sciac_wins = sum(winner == "SCIAC"),
    sciac_win_rate = mean(winner == "SCIAC")
  )

# Print result
print(sciac_wins)


# Define SCIAC team names
sciac_teams <- c("Cal Lutheran", "Chapman", "Claremont-Mudd-Scripps", "La Verne", 
                 "Occidental", "Pomona-Pitzer", "Redlands", "Whittier", "Caltech")

# Filter to only games where one team is SCIAC and the other is not
sciac_vs_non_real <- all_schedule_data %>%
  filter((Home %in% sciac_teams & !(Away %in% sciac_teams)) |
         (Away %in% sciac_teams & !(Home %in% sciac_teams)))

# Count number of SCIAC wins in real data
sciac_wins_real <- sciac_vs_non_real %>%
  mutate(
    winner = case_when(
      Home %in% sciac_teams & home_team_score > away_team_score ~ "SCIAC",
      Away %in% sciac_teams & away_team_score > home_team_score ~ "SCIAC",
      TRUE ~ "Other"
    )
  ) %>%
  summarise(
    total_OOC_games = n(),
    sciac_wins = sum(winner == "SCIAC"),
    sciac_win_rate = mean(winner == "SCIAC")
  )

# Print the real-life SCIAC OOC record
print(sciac_wins_real)


```

```{r}
# Generate the adjusted transition matrix using the new simulated results
transition_matrix_simulated_alt <- create_adjusted_transition_matrix(simulated_schedule_poisson_alt)


# Simulate a Random Walk on the new transition matrix
i_alt <- 47  # Starting from team index 47
for (j in 1:1000) {
  i_alt <- sample(nrow(transition_matrix_simulated_alt), 1, prob = transition_matrix_simulated_alt[i_alt, ])
  print(rownames(transition_matrix_simulated_alt)[i_alt])  # Display the team name
}

# Matrix Multiplication to Find the Stationary Distribution
b_alt <- transition_matrix_simulated_alt
for (i in 1:1000) {
  b_alt <- b_alt %*% transition_matrix_simulated_alt
}

# Extract the Stationary Distribution (any row will be the same after convergence)
stationary_distribution_alt <- b_alt[1, ]  # Take the first row after convergence

# Normalize to ensure it's a valid probability distribution
stationary_distribution_alt <- stationary_distribution_alt / sum(stationary_distribution_alt)

# Assign team names to the distribution for clarity
names(stationary_distribution_alt) <- rownames(transition_matrix_simulated_alt)

# Display the stationary distribution sorted by ranking
stationary_df_alt <- data.frame(Team = names(stationary_distribution_alt), 
                                Probability = as.numeric(stationary_distribution_alt))
stationary_df_alt <- stationary_df_alt[order(-stationary_df_alt$Probability), ]
rownames(stationary_df_alt) <- NULL

# View the stationary distribution
print("Stationary Distribution for Simulated Dataset:")
print(stationary_df_alt)


```

```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to generate simulated non-conference games for SCIAC teams
generate_non_conference_games <- function(final_elo_ratings_div3, all_schedule_data, num_games_per_team = 5) {
  set.seed(42)  # For reproducibility
  
  all_teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
  non_sciac_teams <- setdiff(all_teams, sciac_teams)
  
  simulated_games <- data.frame()
  
  for (team in sciac_teams) {
    for (i in 1:num_games_per_team) {
      # Randomly select an opponent from non-SCIAC teams
      opponent <- sample(non_sciac_teams, 1)
      
      # Compute expected win probability using precomputed Elo ratings
      elo_team <- final_elo_ratings_div3[team]
      elo_opponent <- final_elo_ratings_div3[opponent]
      win_prob <- 1 / (1 + 10^((elo_opponent - elo_team) / 400))  # Elo probability formula
      
      # Simulate match outcome
      result <- rbinom(1, 1, win_prob)  # 1 if SCIAC team wins, 0 if they lose
      home_team <- ifelse(runif(1) > 0.5, team, opponent)
      away_team <- ifelse(home_team == team, opponent, team)
      home_win <- ifelse(home_team == team, result, 1 - result)
      
      # Generate a reasonable scoreline
      home_score <- round(runif(1, 1, 4)) + home_win
      away_score <- round(runif(1, 1, 4)) + (1 - home_win)
      
      # Append simulated game
      simulated_games <- rbind(simulated_games, data.frame(
        Date = Sys.Date(),  # Placeholder date
        Home = home_team,
        Away = away_team,
        home_team_score = home_score,
        away_team_score = away_score,
        Conference = "Non-Conf"  # Label for non-conference games
      ))
    }
  }
  
  return(simulated_games)
}

# Generate the simulated non-conference dataset using precomputed Elo ratings
simulated_games_data <- generate_non_conference_games(final_elo_ratings_div3, all_schedule_data)

# Create a new dataset that includes both real and simulated games
expanded_schedule_data <- bind_rows(all_schedule_data, simulated_games_data)

# Ensure the original dataset remains unchanged
print("Original dataset remains unchanged:")
print(dim(all_schedule_data))  # Should match original dimensions

print("New dataset with simulated games:")
print(dim(expanded_schedule_data))  # Should be larger due to added games


# Function to create an adjusted transition matrix with Laplacian smoothing for the expanded dataset
create_adjusted_transition_matrix_expanded <- function(expanded_schedule_data, damping_factor = 0.85, beta = 1.2, alpha = 0.01) {
  # Get unique teams
  teams_expanded <- unique(c(expanded_schedule_data$Home, expanded_schedule_data$Away))
  
  # Initialize transition matrix with team names as row and column labels
  n_expanded <- length(teams_expanded)
  team_index_expanded <- setNames(seq_len(n_expanded), teams_expanded)  # Map team names to indices
  transition_matrix_expanded <- matrix(0, nrow = n_expanded, ncol = n_expanded, dimnames = list(teams_expanded, teams_expanded))
  
  # Populate the transition matrix with direct match data
  for (i in 1:(length(teams_expanded) - 1)) {
    for (j in (i + 1):length(teams_expanded)) {
      # Find all matches between team i and team j
      grow_expanded <- which((expanded_schedule_data$Away == teams_expanded[i] | expanded_schedule_data$Home == teams_expanded[i]) & 
                             (expanded_schedule_data$Away == teams_expanded[j] | expanded_schedule_data$Home == teams_expanded[j]))
      
      if (length(grow_expanded) >= 1) {  # Proceed with at least one match
        subdata_expanded <- expanded_schedule_data[grow_expanded, ]
        ihome_expanded <- (subdata_expanded$Home == teams_expanded[i])
        pitoj_expanded <- c()
        
        # Calculate the probabilities for each match with adjusted weights
        for (k in 1:length(grow_expanded)) {
          home_score_expanded <- subdata_expanded$home_team_score[k]
          away_score_expanded <- subdata_expanded$away_team_score[k]
          margin_expanded <- abs(home_score_expanded - away_score_expanded)
          
          # Calculate pitoj with Laplacian smoothing and incorporate margin
          if (home_score_expanded + away_score_expanded > 0) {
            p_expanded <- (home_score_expanded + alpha) / (home_score_expanded + away_score_expanded + 2 * alpha)
            p_expanded <- p_expanded + (1 - 2 * p_expanded) * ihome_expanded[k]
          } else {
            p_expanded <- 0.5  # Assign equal probability if both scores are zero
          }
          pitoj_expanded[k] <- max(0, min(1, p_expanded))  # Ensure value is between 0 and 1
        }
        
        # Average probability for all matches between i and j
        pitoj1_expanded <- mean(pitoj_expanded)
        
        # Update transition matrix
        transition_matrix_expanded[team_index_expanded[teams_expanded[i]], team_index_expanded[teams_expanded[j]]] <- length(grow_expanded) * pitoj1_expanded
        transition_matrix_expanded[team_index_expanded[teams_expanded[j]], team_index_expanded[teams_expanded[i]]] <- length(grow_expanded) * (1 - pitoj1_expanded)
      }
    }
  }
  
  # Normalize the transition matrix row-wise
  row_sums_expanded <- rowSums(transition_matrix_expanded)
  transition_matrix_expanded <- sweep(transition_matrix_expanded, 1, row_sums_expanded, FUN = "/")
  
  # Apply damping factor to ensure ergodicity
  #transition_matrix_expanded <- damping_factor * transition_matrix_expanded + (1 - damping_factor) / n_expanded
  
  return(transition_matrix_expanded)
}

# Create the transition matrix using the expanded dataset
transition_matrix_expanded <- create_adjusted_transition_matrix_expanded(expanded_schedule_data)

# Simulate a Random Walk to See How the Markov Chain Behaves on the expanded dataset
i_expanded <- 47  # Starting from team index 47
for (j in 1:1000) {
  i_expanded <- sample(nrow(transition_matrix_expanded), 1, prob = transition_matrix_expanded[i_expanded, ])
  print(rownames(transition_matrix_expanded)[i_expanded])  # Display the team name
}

# Matrix Multiplication to Find the Stationary Distribution for the expanded dataset
b_expanded <- transition_matrix_expanded
for (i in 1:1000) {
  b_expanded <- b_expanded %*% transition_matrix_expanded
}

# Extract the Stationary Distribution (any row will be the same after convergence)
stationary_distribution_expanded <- b_expanded[1, ]  # Take the first row after convergence

# Normalize to ensure it's a valid probability distribution
stationary_distribution_expanded <- stationary_distribution_expanded / sum(stationary_distribution_expanded)

# Assign team names to the distribution for clarity
names(stationary_distribution_expanded) <- rownames(transition_matrix_expanded)

# Display the stationary distribution sorted by ranking
stationary_df_expanded <- data.frame(Team = names(stationary_distribution_expanded), 
                                     Probability = as.numeric(stationary_distribution_expanded))
stationary_df_expanded <- stationary_df_expanded[order(-stationary_df_expanded$Probability), ]
rownames(stationary_df_expanded) <- NULL

# View the stationary distribution
print("Stationary Distribution (Team Rankings with Additional Non-Conference Games):")
print(stationary_df_expanded)


```

```{r}
# Load necessary libraries
# Load necessary libraries
library(dplyr)

# Step 1: Filter out teams with fewer than 3 games
filter_teams_by_games <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)
  
  # Get teams with at least `min_games` played
  valid_teams <- team_game_counts %>% filter(Total_Games >= min_games) %>% pull(Home)
  
  # Filter dataset to only include teams with sufficient games
  filtered_schedule <- schedule_data %>%
    filter(Home %in% valid_teams & Away %in% valid_teams)
  
  return(filtered_schedule)
}

# Apply filtering to remove teams with <3 games
filtered_simulated_schedule_poisson_alt <- filter_teams_by_games(simulated_schedule_poisson_alt, min_games = 3)

# Step 2: Compute Opponent Win Percentage (OWP) including ties as 0.5 wins
compute_owp_poisson <- function(schedule_data) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  
  # Compute team win percentages
  team_win_pct <- setNames(rep(0, length(teams)), teams)
  
  for (team in teams) {
    team_games <- schedule_data %>% filter(Home == team | Away == team)
    
    total_games <- nrow(team_games)
    wins <- sum((team_games$Home == team & team_games$home_team_score > team_games$away_team_score) |
                (team_games$Away == team & team_games$away_team_score > team_games$home_team_score))
    
    # Count ties as 0.5 wins for both teams
    ties <- sum(team_games$home_team_score == team_games$away_team_score)
    
    team_win_pct[team] <- ifelse(total_games > 0, (wins + 0.5 * ties) / total_games, NA)
  }
  
  # Compute OWP for each team
  owp_scores <- setNames(rep(0, length(teams)), teams)
  
  for (team in teams) {
    team_games <- schedule_data %>% filter(Home == team | Away == team)
    opponents <- ifelse(team_games$Home == team, team_games$Away, team_games$Home)
    
    # Average opponent win percentage
    owp_scores[team] <- mean(team_win_pct[opponents], na.rm = TRUE)
  }
  
  return(owp_scores)
}

# Step 3: Compute Opponent's Strength of Schedule (OOSOS)
compute_oosos_poisson <- function(owp_scores, schedule_data) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  
  # Compute OOSOS for each team
  oosos_scores <- setNames(rep(0, length(teams)), teams)
  
  for (team in teams) {
    team_games <- schedule_data %>% filter(Home == team | Away == team)
    opponents <- ifelse(team_games$Home == team, team_games$Away, team_games$Home)
    
    # Average opponent's OWP
    oosos_scores[team] <- mean(owp_scores[opponents], na.rm = TRUE)
  }
  
  return(oosos_scores)
}

# Step 4: Compute Final KenPom-Style SOS
compute_kenpom_sos_poisson <- function(schedule_data) {
  owp_scores <- compute_owp_poisson(schedule_data)
  oosos_scores <- compute_oosos_poisson(owp_scores, schedule_data)
  
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  
  # Compute KenPom-style SOS using 2/3 weight for OWP and 1/3 weight for OOSOS
  kenpom_sos_scores <- setNames(rep(0, length(teams)), teams)
  
  for (team in teams) {
    kenpom_sos_scores[team] <- 0.67 * owp_scores[team] + 0.33 * oosos_scores[team]
  }
  
  return(kenpom_sos_scores)
}

# Compute KenPom SOS for the filtered dataset
kenpom_sos_poisson_alt <- compute_kenpom_sos_poisson(filtered_simulated_schedule_poisson_alt)

# Convert to DataFrame
kenpom_sos_df <- data.frame(Team = names(kenpom_sos_poisson_alt), KenPom_SOS = kenpom_sos_poisson_alt)

# Sort by Strength of Schedule (High to Low)
kenpom_sos_df <- kenpom_sos_df %>% arrange(desc(KenPom_SOS))

# Print Results
print("KenPom-Style Strength of Schedule (Filtered Poisson-Distributed Dataset with Ties Adjusted):")
print(kenpom_sos_df)

# Compare SCIAC teams vs. Non-SCIAC teams
sciac_kenpom_sos <- kenpom_sos_df %>% filter(Team %in% sciac_teams)
non_sciac_kenpom_sos <- kenpom_sos_df %>% filter(!(Team %in% sciac_teams))

print("Average KenPom Strength of Schedule for SCIAC Teams:")
print(mean(sciac_kenpom_sos$KenPom_SOS, na.rm = TRUE))

print("Average KenPom Strength of Schedule for Non-SCIAC Teams:")
print(mean(non_sciac_kenpom_sos$KenPom_SOS, na.rm = TRUE))


# Filter teams with at least 3 games in the real dataset
real_filtered_schedule <- filter_teams_by_games(all_schedule_data, min_games = 3)

# Compute KenPom-style SoS for real dataset
kenpom_sos_real <- compute_kenpom_sos_poisson(real_filtered_schedule)

# Convert to a ranked dataframe
kenpom_sos_real_df <- data.frame(
  Rank = 1:length(kenpom_sos_real),
  Team = names(kenpom_sos_real),
  KenPom_SOS = kenpom_sos_real
) %>%
  arrange(desc(KenPom_SOS)) %>%
  mutate(Rank = row_number())  # ensures rank matches after sorting

# View the ranked SOS table
print(" KenPom-Style Strength of Schedule Rankings (with Rank Column):")
print(kenpom_sos_real_df)





```
```{r}
# Ensure teams that played at least 3 games before doing calculations
filtered_schedule_data <- all_schedule_data %>%
  filter(Home %in% names(table(c(all_schedule_data$Home, all_schedule_data$Away))[
    table(c(all_schedule_data$Home, all_schedule_data$Away)) >= 3
  ]) &
  Away %in% names(table(c(all_schedule_data$Home, all_schedule_data$Away))[
    table(c(all_schedule_data$Home, all_schedule_data$Away)) >= 3
  ]))


# Apply the existing KenPom-style SOS function to the original dataset
kenpom_sos_original <- compute_kenpom_sos_poisson(filtered_schedule_data)

# Convert to DataFrame
kenpom_sos_df_original <- data.frame(Team = names(kenpom_sos_original), KenPom_Strength_of_Schedule = kenpom_sos_original)

# Sort by KenPom SOS (High to Low)
kenpom_sos_df_original <- kenpom_sos_df_original %>% arrange(desc(KenPom_Strength_of_Schedule))

# Print Results
print("KenPom Strength of Schedule for the Original Dataset (Real Data):")
print(kenpom_sos_df_original)

# Compare SCIAC teams vs. Non-SCIAC teams
sciac_teams <- c("Cal Lutheran", "Chapman", "Claremont-Mudd-Scripps", "La Verne", 
                 "Occidental", "Pomona-Pitzer", "Redlands", "Whittier", "Caltech")

sciac_kenpom_sos_original <- kenpom_sos_df_original %>% filter(Team %in% sciac_teams)
non_sciac_kenpom_sos_original <- kenpom_sos_df_original %>% filter(!(Team %in% sciac_teams))

print("Average KenPom Strength of Schedule for SCIAC Teams (Real Data):")
print(mean(sciac_kenpom_sos_original$KenPom_Strength_of_Schedule, na.rm = TRUE))

print("Average KenPom Strength of Schedule for Non-SCIAC Teams (Real Data):")
print(mean(non_sciac_kenpom_sos_original$KenPom_Strength_of_Schedule, na.rm = TRUE))

```
```{r sos model}

# Load necessary libraries
library(dplyr)
library(igraph)

# Create Strength-of-Schedule Adjusted Transition Matrix
create_sos_adjusted_transition_matrix <- function(schedule_data, kenpom_sos, damping_factor = 0.85, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  
  # Normalize KenPom SOS to [0,1] for weighting
  max_sos <- max(kenpom_sos, na.rm = TRUE)
  kenpom_sos <- kenpom_sos / max_sos
  
  # Initialize transition matrix
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  
  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]
    margin <- abs(home_score - away_score) + 1  # Avoid zero margins
    
    if (home_team %in% teams & away_team %in% teams) {
      # Weight by opponent's KenPom SOS
      home_weight <- kenpom_sos[away_team] + alpha
      away_weight <- kenpom_sos[home_team] + alpha
      
      # Normalize weights
      weight_total <- home_weight + away_weight
      home_weight <- home_weight / weight_total
      away_weight <- away_weight / weight_total
      
      if (home_score > away_score) {
        transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * home_weight
      } else if (home_score < away_score) {
        transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * away_weight
      } else { # Tie case
        transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 0.5 * away_weight
        transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.5 * home_weight
      }
    }
  }
  
  # Normalize rows
  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  
  # Apply damping factor
  transition_matrix <- damping_factor * transition_matrix + (1 - damping_factor) / n
  
  return(transition_matrix)
}

# Compute the stationary distribution
compute_stationary_distribution <- function(transition_matrix) {
  eigen_results <- eigen(t(transition_matrix))  # Transpose for left eigenvector
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix)  # Assign team names
  
  return(Re(stationary_distribution))  # Ensure real values
}

# Visualize the transition matrix
visualize_transition_matrix <- function(transition_matrix) {
  graph <- graph_from_adjacency_matrix(transition_matrix, mode = "directed", weighted = TRUE)
  plot(
    graph,
    vertex.size = 7.5,
    vertex.label.cex = 0.5,
    edge.width = E(graph)$weight * 5,
    edge.arrow.size = 0.2,
    main = "SOS-Adjusted Transition Graph for D3 Soccer Rankings"
  )
}

# Main Execution
# Step 1: Filter teams with at least 3 games in the real dataset
filtered_all_schedule_data <- filter_teams_by_games(all_schedule_data, min_games = 3)

# Step 2: Compute KenPom SOS for the real dataset
kenpom_sos_all_schedule <- compute_kenpom_sos_poisson(filtered_all_schedule_data)

# Step 3: Create the SOS-adjusted transition matrix
transition_matrix_sos <- create_sos_adjusted_transition_matrix(filtered_all_schedule_data, kenpom_sos_all_schedule)

# Step 4: Compute the stationary distribution
stationary_distribution_sos <- compute_stationary_distribution(transition_matrix_sos)

# Step 5: Convert and sort the stationary distribution
stationary_df_sos <- data.frame(Team = names(stationary_distribution_sos), Rating = stationary_distribution_sos)
stationary_df_sos <- stationary_df_sos %>% arrange(desc(Rating))

# Step 6: Display the results
print("SOS-Adjusted Stationary Distribution (Team Rankings):")
print(stationary_df_sos)

# Step 7: Visualize the transition matrix
visualize_transition_matrix(transition_matrix_sos)



```
```{r baysian priors}


library(dplyr)
library(igraph)

# Step 1: Initialize Elo-based priors
initialize_elo_ratings <- function(teams) {
  initial_ratings <- c(
    "National Champion" = 1675,
    "Runner-Up" = 1650,
    "Semifinalist" = 1625,
    "Quarterfinalist" = 1600,
    "Round of 16" = 1575,
    "Round of 32" = 1550,
    "First Round" = 1525,
    "Non-tournament Team" = 1500
  )
  
  tournament_teams <- list(
    "Chicago" = "National Champion",
    "Williams" = "Runner-Up",
    "Stevens" = "Semifinalist",
    "Mary Washington" = "Semifinalist",
    "Gustavus Adolphus" = "Quarterfinalist",
    "Bowdoin" = "Quarterfinalist",
    "Kenyon" = "Quarterfinalist",
    "Johns Hopkins" = "Quarterfinalist",
    "St. Olaf" = "Round of 16",
    "Oneonta State" = "Round of 16",
    "Ohio Northern" = "Round of 16",
    "Cortland State" = "Round of 16",
    "Catholic" = "Round of 16",
    "Washington and Lee" = "Round of 16",
    "Amherst" = "Round of 16",
    "St. Thomas (Tex.)" = "Round of 16"
  )
  
  ratings <- setNames(rep(1500, length(teams)), teams)
  
  for (team in names(tournament_teams)) {
    if (team %in% teams) {
      stage <- tournament_teams[[team]]
      ratings[team] <- initial_ratings[stage]
    }
  }
  
  return(ratings)
}

# Step 2: Count the number of games played by each team
get_valid_teams <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)
  
  # Get teams with at least `min_games` played
  valid_teams <- team_game_counts %>% filter(Total_Games >= min_games) %>% pull(Home)
  
  return(valid_teams)
}

# Step 3: Create a Bayesian Markov Chain Transition Matrix
create_bayesian_transition_matrix <- function(all_schedule_data, elo_priors, beta_strength = 0.5) {
  teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  
  # Assign prior win counts based on Elo (scaling factor for Beta distribution)
  prior_wins <- (elo_priors - min(elo_priors)) / (max(elo_priors) - min(elo_priors)) * 5 + 1
  prior_losses <- 6 - prior_wins  # Ensuring Beta(, ) remains within a valid range

  # Populate transition matrix based on matches
  for (i in 1:nrow(all_schedule_data)) {
    home_team <- all_schedule_data$Home[i]
    away_team <- all_schedule_data$Away[i]
    home_score <- all_schedule_data$home_team_score[i]
    away_score <- all_schedule_data$away_team_score[i]
    
    home_win <- as.numeric(home_score > away_score)
    away_win <- as.numeric(away_score > home_score)
    tie <- as.numeric(home_score == away_score)
    
    # Prior-based update for Bayesian Transition Probabilities
    transition_matrix[team_index[away_team], team_index[home_team]] <- 
      (prior_wins[home_team] + home_win) / (prior_wins[home_team] + prior_losses[home_team] + 1)
    
    transition_matrix[team_index[home_team], team_index[away_team]] <- 
      (prior_wins[away_team] + away_win) / (prior_wins[away_team] + prior_losses[away_team] + 1)
    
    # Handle ties dynamically
    if (tie == 1) {
      transition_matrix[team_index[home_team], team_index[away_team]] <- 
        (prior_wins[away_team] + 0.5) / (prior_wins[away_team] + prior_losses[away_team] + 1)
      transition_matrix[team_index[away_team], team_index[home_team]] <- 
        (prior_wins[home_team] + 0.5) / (prior_wins[home_team] + prior_losses[home_team] + 1)
    }
  }
  
  # Normalize each row to ensure valid transition probabilities
  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  
  return(transition_matrix)
}

# Step 4: Compute the Bayesian Markov Chain Stationary Distribution
compute_stationary_distribution <- function(transition_matrix, valid_teams) {
  eigen_results <- eigen(t(transition_matrix))
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix)
  
  # Filter out teams with fewer than 3 games
  stationary_distribution_filtered <- stationary_distribution[names(stationary_distribution) %in% valid_teams]
  
  return(Re(stationary_distribution_filtered))
}

# Step 5: Run the Bayesian Markov Chain Model
teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
elo_priors <- initialize_elo_ratings(teams)
valid_teams <- get_valid_teams(all_schedule_data, min_games = 3)

bayesian_transition_matrix <- create_bayesian_transition_matrix(all_schedule_data, elo_priors)
bayesian_stationary_distribution <- compute_stationary_distribution(bayesian_transition_matrix, valid_teams)

# Convert to DataFrame and Sort Rankings
bayesian_rankings_df <- data.frame(
  Team = names(bayesian_stationary_distribution),
  Bayesian_Rating = bayesian_stationary_distribution
) %>% arrange(desc(Bayesian_Rating))

# Display the rankings
print("Bayesian Markov Chain Rankings with Elo Priors (Filtered for Teams with at Least 3 Games):")
print(bayesian_rankings_df)


```
```{r, low favor ties}

# Load necessary libraries
library(dplyr)
library(igraph)

# Function to create an adjusted transition matrix with Laplacian smoothing and low-favor tie handling
create_adjusted_transition_matrix_low_favor_ties <- function(all_schedule_data, damping_factor = 0.85, beta = 1.2, alpha = 0.01) {
  # Get unique teams
  teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
  
  # Initialize transition matrix with team names as row and column labels
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)  # Map team names to indices
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  
  # Probability shift factor for ties (60% weight to lower-ranked team)
  prob_shift <- 0.6  

  # Populate the transition matrix with direct match data
  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      # Find all matches between team i and team j
      grow <- which((all_schedule_data$Away == teams[i] | all_schedule_data$Home == teams[i]) & 
                    (all_schedule_data$Away == teams[j] | all_schedule_data$Home == teams[j]))
      
      if (length(grow) >= 1) {  # Proceed with at least one match
        subdata <- all_schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()
        
        # Calculate the probabilities for each match with adjusted weights
        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]
          margin <- abs(home_score - away_score)
          
          # Calculate pitoj with Laplacian smoothing and incorporate margin
          if (home_score > away_score) {
            # Home wins
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else if (away_score > home_score) {
            # Away wins
            p <- (away_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * (1 - ihome[k])
          } else {
            # Tie case - shift more probability to the lower-ranked team
            p <- 0.5  # Base probability for a tie
            if (teams[i] < teams[j]) {  # If team i is ranked lower, shift more probability to it
              p <- p * (1 - prob_shift)
            } else {
              p <- p * prob_shift
            }
          }
          pitoj[k] <- max(0, min(1, p))  # Ensure value is between 0 and 1
        }
        
        # Average probability for all matches between i and j
        pitoj1 <- mean(pitoj)
        
        # Update transition matrix
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }
  
  # Normalize the transition matrix row-wise
  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  
  # Apply damping factor to ensure ergodicity
  transition_matrix <- damping_factor * transition_matrix + (1 - damping_factor) / n
  
  return(transition_matrix)
}

# Create the transition matrix using your game data with low-favor ties
transition_matrix_low_favor_ties <- create_adjusted_transition_matrix_low_favor_ties(all_schedule_data)

# Simulate a Random Walk to See How the Markov Chain Behaves
i <- 47  # Starting from team index 47
for (j in 1:1000) {
  i <- sample(nrow(transition_matrix_low_favor_ties), 1, prob = transition_matrix_low_favor_ties[i, ])
  print(rownames(transition_matrix_low_favor_ties)[i])  # Display the team name
}

# Matrix Multiplication to Find the Stationary Distribution
b <- transition_matrix_low_favor_ties
for (i in 1:1000) {
  b <- b %*% transition_matrix_low_favor_ties
}

# Extract the Stationary Distribution (any row will be the same after convergence)
stationary_distribution_low_favor_ties <- b[1, ]  # Take the first row after convergence

# Normalize to ensure it's a valid probability distribution
stationary_distribution_low_favor_ties <- stationary_distribution_low_favor_ties / sum(stationary_distribution_low_favor_ties)

# Assign team names to the distribution for clarity
names(stationary_distribution_low_favor_ties) <- rownames(transition_matrix_low_favor_ties)

# Display the stationary distribution sorted by ranking
stationary_df_low_favor_ties <- data.frame(Team = names(stationary_distribution_low_favor_ties), 
                                           Probability = as.numeric(stationary_distribution_low_favor_ties))
stationary_df_low_favor_ties <- stationary_df_low_favor_ties[order(-stationary_df_low_favor_ties$Probability), ]
rownames(stationary_df_low_favor_ties) <- NULL

# View the stationary distribution
print("Stationary Distribution (Team Rankings with Low-Favor Ties):")
print(stationary_df_low_favor_ties)

# Convert the matrix to a data frame
transition_df_low_favor_ties <- as.data.frame(transition_matrix_low_favor_ties)

# Add team names as a column for easier reference
transition_df_low_favor_ties$Team <- rownames(transition_matrix_low_favor_ties)

# Move 'Team' column to the front
transition_df_low_favor_ties <- transition_df_low_favor_ties[, c("Team", setdiff(names(transition_df_low_favor_ties), "Team"))]

# View the transition matrix as a data frame
print("Transition Matrix (as Data Frame with Low-Favor Ties):")
print(transition_df_low_favor_ties)


```

```{r}
# Load necessary libraries
library(dplyr)

# Step 1: Identify common teams across all models
common_teams <- Reduce(intersect, list(
  elo_ratings_sorted_df$Team,
  stationary_df_pagerank$Team,
  stationary_df_filtered$Team,
  stationary_df_winmargin$Team,
  stationary_df_low_favor_ties$Team,
  stationary_df_sos$Team,
  bayesian_rankings_df$Team
))

# Step 2: Filter each dataset to keep only common teams
elo_ratings_sorted_df <- elo_ratings_sorted_df %>% filter(Team %in% common_teams)
stationary_df_pagerank <- stationary_df_pagerank %>% filter(Team %in% common_teams)
stationary_df_filtered <- stationary_df_filtered %>% filter(Team %in% common_teams)
stationary_df_winmargin <- stationary_df_winmargin %>% filter(Team %in% common_teams)
stationary_df_low_favor_ties <- stationary_df_low_favor_ties %>% filter(Team %in% common_teams)
stationary_df_sos <- stationary_df_sos %>% filter(Team %in% common_teams)
bayesian_rankings_df <- bayesian_rankings_df %>% filter(Team %in% common_teams)

# Step 3: Combine all models into a single dataframe
rankings_df <- stationary_df_pagerank %>%
  select(Team, PageRank = Rating) %>%
  left_join(elo_ratings_sorted_df %>% select(Team, Elo_Rating), by = "Team") %>%
  left_join(stationary_df_filtered %>% select(Team, Filtered_Transition = Rating), by = "Team") %>%
  left_join(stationary_df_winmargin %>% select(Team, WinMargin = Probability), by = "Team") %>%
  left_join(stationary_df_low_favor_ties %>% select(Team, Low_Favor_Ties = Probability), by = "Team") %>%
  left_join(stationary_df_sos %>% select(Team, Strength_Schedule = Rating), by = "Team") %>%
  left_join(bayesian_rankings_df %>% select(Team, Bayesian = Bayesian_Rating), by = "Team")


# Step 4: Standardize each model score
rankings_df_scaled <- rankings_df
rankings_df_scaled$Elo_Rating <- base::scale(rankings_df$Elo_Rating)
rankings_df_scaled$PageRank <- base::scale(rankings_df$PageRank)
rankings_df_scaled$Filtered_Transition <- base::scale(rankings_df$Filtered_Transition)
rankings_df_scaled$WinMargin <- base::scale(rankings_df$WinMargin)
rankings_df_scaled$Low_Favor_Ties <- base::scale(rankings_df$Low_Favor_Ties)
rankings_df_scaled$Strength_Schedule <- base::scale(rankings_df$Strength_Schedule)
rankings_df_scaled$Bayesian <- base::scale(rankings_df$Bayesian)

# Step 5: Define the top 32 teams
final_25_teams <- c("St. Olaf", "Amherst", "Washington and Lee", 
                    "Middlebury", "Connecticut College", 
                    "Montclair State", "Calvin", "Tufts", "Mary Washington", 
                    "Cortland State", "North Central (Ill.)", "UW-Eau Claire", "Colorado College",  
                    "Washington College", "Franklin and Marshall", "Chicago", "Messiah", "Kenyon","Carleton","Ohio Northern", "Occidental", "Johns Hopkins", 
                    "Case Western Reserve", "Oneonta State", "Wis.-Platteville")

# Step 6: Assign binary labels for top 32
rankings_df_scaled$Top_25 <- ifelse(rankings_df_scaled$Team %in% final_25_teams, 1, 0)

# Step 7: Train logistic regression model
logit_model <- glm(
  Top_25 ~ Elo_Rating + PageRank + Filtered_Transition + WinMargin +
             Low_Favor_Ties + Strength_Schedule + Bayesian,
  data = rankings_df_scaled,
  family = binomial()
)

# Step 8: Output logistic regression summary (coefficients)
summary(logit_model)

# Step 9: Extract and normalize coefficients
coefs <- coef(logit_model)[-1]  # Remove intercept
abs_coefs <- abs(coefs)
alphas <- abs_coefs / sum(abs_coefs)

print(" Normalized Weights (Alphas) Based on Standardized Logistic Regression Coefficients:")
print(round(alphas, 4))

# Step 10: Compute final weighted ranking
rankings_df_scaled$Final_Ranking <- with(rankings_df_scaled,
  Elo_Rating * alphas["Elo_Rating"] +
  PageRank * alphas["PageRank"] +
  Filtered_Transition * alphas["Filtered_Transition"] +
  WinMargin * alphas["WinMargin"] +
  Low_Favor_Ties * alphas["Low_Favor_Ties"] +
  Strength_Schedule * alphas["Strength_Schedule"] +
  Bayesian * alphas["Bayesian"]
)

# Step 11: Sort final rankings
final_rankings_df <- rankings_df_scaled %>%
  select(Team, Final_Ranking) %>%
  arrange(desc(Final_Ranking))

print(" Final Rankings from Standardized Logistic Regression Weighting:")
print(final_rankings_df)

```
```{r}
# Load library
library(glmnet)

# Step 1: Prepare data matrix (drop Team and Top_25 is response)
X <- as.matrix(rankings_df_scaled %>% select(-Team, -Top_25))
y <- rankings_df_scaled$Top_25

# Step 2: Fit Ridge logistic regression (alpha = 0 means Ridge)
ridge_model <- cv.glmnet(X, y, family = "binomial", alpha = 0)

# Step 3: Extract optimal lambda (penalty) based on cross-validation
best_lambda <- ridge_model$lambda.min
cat("Best Lambda:", best_lambda, "\n")

# Step 4: Extract coefficients at best lambda
ridge_coefs <- coef(ridge_model, s = best_lambda)
print(ridge_coefs)
# Drop intercept and normalize
coefs_vec <- as.numeric(ridge_coefs[-1])
names(coefs_vec) <- rownames(ridge_coefs)[-1]

# Normalize to get alpha weights
ridge_alphas <- abs(coefs_vec) / sum(abs(coefs_vec))
print(" Ridge Regression Alpha Weights (Normalized):")
print(round(ridge_alphas, 4))

# Compute final weighted score using ridge alphas
rankings_df_scaled$Final_Ranking_Ridge <- as.numeric(X %*% ridge_alphas)

# Sort results
final_ridge_rankings <- rankings_df_scaled %>%
  select(Team, Final_Ranking_Ridge) %>%
  arrange(desc(Final_Ranking_Ridge))

print(" Final Team Rankings (Ridge Weighted):")
print(final_ridge_rankings)

```
```{r}
# Rank teams (lower is better)
comparison_df <- rankings_df_scaled %>%
  select(Team, Final_Ranking, Final_Ranking_Ridge)

comparison_df$Rank_Logit <- rank(-comparison_df$Final_Ranking, ties.method = "first")
comparison_df$Rank_Ridge <- rank(-comparison_df$Final_Ranking_Ridge, ties.method = "first")

# Only include teams ranked in top 100 in either model
top_50_filter <- with(comparison_df, Rank_Logit <= 50 | Rank_Ridge <= 50)
comparison_top_50 <- comparison_df[top_50_filter, ]

# Calculate change in rank (Ridge - Logit)
comparison_top_50$Rank_Change <- comparison_top_50$Rank_Ridge - comparison_top_50$Rank_Logit

# Sort by absolute change
movers_df <- comparison_top_50 %>% arrange(desc(abs(Rank_Change)))

# Top 10 biggest movers
cat(" Top 10 Biggest Movers in Top 100:\n")
print(head(movers_df, 10))

# Teams that moved UP the most (i.e. got better in Ridge)
moved_up <- movers_df %>% filter(Rank_Change < 0) %>% arrange(Rank_Change)
cat("\n Top 10 Teams That Moved UP the Most:\n")
print(head(moved_up, 10))

# Teams that moved DOWN the most (i.e. worse in Ridge)
moved_down <- movers_df %>% filter(Rank_Change > 0) %>% arrange(desc(Rank_Change))
cat("\n Top 10 Teams That Moved DOWN the Most:\n")
print(head(moved_down, 10))


```
```{r}
# Define Final Top 25 Teams
final_25_teams <- c(
  "St. Olaf", "Amherst", "Washington and Lee", "Middlebury", "Connecticut College",
  "Montclair State", "Calvin", "Tufts", "Mary Washington", "Cortland State",
  "North Central (Ill.)", "UW-Eau Claire", "Colorado College", "Washington College",
  "Franklin and Marshall", "Chicago", "Messiah", "Kenyon", "Carleton", "Ohio Northern",
  "Occidental", "Johns Hopkins", "Case Western Reserve", "Oneonta State", "Wis.-Platteville"
)

# Build a DataFrame with Rankings from Both Models
final_25_ranks <- rankings_df_scaled %>%
  mutate(
    Rank_Logit = rank(-Final_Ranking, ties.method = "first"),
    Rank_Ridge = rank(-Final_Ranking_Ridge, ties.method = "first")
  ) %>%
  filter(Team %in% final_25_teams) %>%
  select(Team, Rank_Logit, Rank_Ridge) %>%
  arrange(Rank_Logit)  # You can also use Rank_Ridge if you want to sort by Ridge

# Display Results
print(" Final Top 25 Teams and Their Ranks in Each Model:")
print(final_25_ranks)

```
```{r}
# Predict probabilities using the fitted ridge model
ridge_probs <- predict(ridge_model, newx = X, s = best_lambda, type = "response")

# Convert probabilities to binary predictions (Top 25 = 1 if prob > 0.5)
ridge_preds <- ifelse(ridge_probs > 0.4, 1, 0)


# Actual vs. predicted
actuals <- rankings_df_scaled$Top_25
table(Predicted = ridge_preds, Actual = actuals)
TP <- sum(ridge_preds == 1 & actuals == 1)
FP <- sum(ridge_preds == 1 & actuals == 0)
FN <- sum(ridge_preds == 0 & actuals == 1)
TN <- sum(ridge_preds == 0 & actuals == 0)

# Metrics
precision <- TP / (TP + FP)
recall <- TP / (TP + FN)
accuracy <- (TP + TN) / length(actuals)

# Show results
cat("Precision:", round(precision, 3), "\n")
cat("Recall:", round(recall, 3), "\n")
cat("Accuracy:", round(accuracy, 3), "\n")

```
```{r}
# Step 0: Get the teams involved
teams_poisson <- unique(c(simulated_schedule_poisson_alt$Home, simulated_schedule_poisson_alt$Away))

# Step 1: Initialize ratings for Poisson dataset (all teams start at 1500)
initial_ratings_poisson <- setNames(rep(1500, length(teams_poisson)), teams_poisson)

# Step 2: Calculate Elo ratings using the same function but on simulated data
final_elo_ratings_poisson <- elo_ratings_div3(simulated_schedule_poisson_alt, initial_ratings_poisson, K = 32)

# Step 3: Create a DataFrame and sort the results
elo_ratings_sorted_poisson_df <- data.frame(
  Team = names(final_elo_ratings_poisson),
  Elo_Rating = unlist(final_elo_ratings_poisson)
) %>% arrange(desc(Elo_Rating))

# Step 4: Filter to only valid teams (played  3 games)
valid_teams_poisson <- get_valid_teams(simulated_schedule_poisson_alt, min_games = 3)
elo_ratings_sorted_poisson_df <- elo_ratings_sorted_poisson_df %>%
  filter(Team %in% valid_teams_poisson)

# Step 5: Display the result
print(" Elo Ratings on Simulated Poisson Dataset:")
print(elo_ratings_sorted_poisson_df)


```
```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to create an adjusted transition matrix
create_adjusted_transition_matrix <- function(schedule_data, damping_factor = 0.85, beta = 0.5, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]
    margin <- abs(home_score - away_score)

    if (home_score > away_score) {
      transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.9
    } else if (home_score < away_score) {
      transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 1.1
    } else {
      transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 0.5
      transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.5
    }
  }

  row_sums <- rowSums(transition_matrix)
  zero_rows <- which(row_sums == 0)
  if (length(zero_rows) > 0) {
    transition_matrix[zero_rows, ] <- 1 / n
    row_sums <- rowSums(transition_matrix)
  }

  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  # Laplacian smoothing
  transition_matrix <- transition_matrix + alpha
  transition_matrix <- sweep(transition_matrix, 1, rowSums(transition_matrix), FUN = "/")

  return(transition_matrix)
}

# Function to compute the stationary distribution
compute_stationary_distribution <- function(transition_matrix) {
  eigen_results <- eigen(t(transition_matrix))
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- Re(stationary_vector / sum(stationary_vector))
  names(stationary_distribution) <- rownames(transition_matrix)
  return(stationary_distribution)
}

# --- Main Pipeline for Simulated Data ---

# Step 1: Create the transition matrix for the simulated Poisson dataset
transition_matrix_poisson <- create_adjusted_transition_matrix(simulated_schedule_poisson_alt)

# Step 2: Compute the stationary distribution
stationary_distribution_poisson <- compute_stationary_distribution(transition_matrix_poisson)

# Step 3: Convert to a ranked dataframe
stationary_df_pagerank_poisson <- data.frame(
  Team = names(stationary_distribution_poisson),
  Rating = stationary_distribution_poisson
) %>% arrange(desc(Rating))

# Step 4: View or return the results
print(" PageRank Rankings from Simulated Poisson Dataset:")
print(stationary_df_pagerank_poisson)



```

```{r}
# Load required libraries
library(dplyr)
library(igraph)

# --- Functions (same as yours, reused here for simulated data) ---

get_valid_teams <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)
  
  valid_teams <- team_game_counts %>% filter(Total_Games >= min_games) %>% pull(Home)
  return(valid_teams)
}

create_adjusted_transition_matrix <- function(all_schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(all_schedule_data$Home, all_schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:length(teams)) {
    for (j in 1:length(teams)) {
      if (i != j) {
        grow <- which((all_schedule_data$Away == teams[i] | all_schedule_data$Home == teams[i]) &
                      (all_schedule_data$Away == teams[j] | all_schedule_data$Home == teams[j]))
        
        if (length(grow) >= 1) {
          subdata <- all_schedule_data[grow, ]
          ihome <- (subdata$Home == teams[i])
          pitoj <- c()

          for (k in 1:length(grow)) {
            home_score <- subdata$home_team_score[k]
            away_score <- subdata$away_team_score[k]
            margin <- abs(home_score - away_score)
            
            if (home_score + away_score > 0) {
              p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
              p <- p + (1 - 2 * p) * ihome[k]
            } else {
              p <- 0.5
            }
            pitoj[k] <- max(0, min(1, p))
          }

          pitoj1 <- mean(pitoj)
          transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- pitoj1
        }
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  zero_row_indices <- which(row_sums == 0)
  if (length(zero_row_indices) > 0) {
    transition_matrix[zero_row_indices, ] <- 1 / n
    row_sums <- rowSums(transition_matrix)
  }

  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

compute_stationary_distribution <- function(transition_matrix, valid_teams) {
  eigen_results <- eigen(t(transition_matrix))
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix)
  stationary_distribution_filtered <- stationary_distribution[names(stationary_distribution) %in% valid_teams]
  return(Re(stationary_distribution_filtered))
}

# --- Main Pipeline Using Simulated Poisson Data ---

# Step 1: Build transition matrix from simulated data
transition_matrix_sim_poisson <- create_adjusted_transition_matrix(simulated_schedule_poisson_alt)

# Step 2: Filter to teams with at least 3 games
valid_teams_poisson <- get_valid_teams(simulated_schedule_poisson_alt, min_games = 3)

# Step 3: Compute stationary distribution for those valid teams
stationary_distribution_filtered_poisson <- compute_stationary_distribution(
  transition_matrix_sim_poisson,
  valid_teams_poisson
)

# Step 4: Turn into data frame and rank
stationary_df_filtered_poisson <- data.frame(
  Team = names(stationary_distribution_filtered_poisson),
  Rating = stationary_distribution_filtered_poisson
) %>%
  arrange(desc(Rating))

# Step 5: Display output
print(" Filtered Transition Rankings on Simulated Poisson Dataset:")
print(stationary_df_filtered_poisson)



```
```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# --- Win Margin Transition Matrix Function (as you defined) ---
create_adjusted_transition_matrix <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  
  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))
      
      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()
        
        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]
          margin <- abs(home_score - away_score)
          
          if (home_score + away_score > 0) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else {
            p <- 0.5
          }
          pitoj[k] <- max(0, min(1, p))
        }
        
        pitoj1 <- mean(pitoj)
        
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  return(transition_matrix)
}

# --- MAIN PIPELINE using Poisson Simulated Data ---

# Step 1: Build transition matrix from Poisson data
transition_matrix_winmargin_poisson <- create_adjusted_transition_matrix(simulated_schedule_poisson_alt)

# Step 2: Simulate a random walk (optional - for fun)
i <- 47
for (j in 1:1000) {
  i <- sample(nrow(transition_matrix_winmargin_poisson), 1, prob = transition_matrix_winmargin_poisson[i, ])
  print(rownames(transition_matrix_winmargin_poisson)[i])
}

# Step 3: Matrix multiplication to get stationary distribution
b <- transition_matrix_winmargin_poisson
for (i in 1:1000) {
  b <- b %*% transition_matrix_winmargin_poisson
}

# Step 4: Extract and normalize
stationary_distribution_winmargin_poisson <- b[1, ] / sum(b[1, ])
names(stationary_distribution_winmargin_poisson) <- rownames(transition_matrix_winmargin_poisson)

# Step 5: Format results into data frame
stationary_df_winmargin_poisson <- data.frame(
  Team = names(stationary_distribution_winmargin_poisson),
  Probability = as.numeric(stationary_distribution_winmargin_poisson)
) %>%
  arrange(desc(Probability))

rownames(stationary_df_winmargin_poisson) <- NULL

# Step 6: Display results
print(" Stationary Distribution (Win Margin Model on Poisson-Simulated Data):")
print(stationary_df_winmargin_poisson)





```
```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to create adjusted transition matrix with low-favor tie handling
create_adjusted_transition_matrix_low_favor_ties <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  prob_shift <- 0.6  # Bias for ties

  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))
      
      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()

        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]

          if (home_score > away_score) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else if (away_score > home_score) {
            p <- (away_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * (1 - ihome[k])
          } else {
            # Tie case  lower alphabetically gets more weight
            p <- ifelse(teams[i] < teams[j], 0.5 * (1 - prob_shift), 0.5 * prob_shift)
          }
          pitoj[k] <- max(0, min(1, p))
        }

        pitoj1 <- mean(pitoj)
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  return(transition_matrix)
}

# Step 1: Create transition matrix using simulated Poisson results
transition_matrix_low_favor_ties_poisson <- create_adjusted_transition_matrix_low_favor_ties(simulated_schedule_poisson_alt)

# Step 2: Compute stationary distribution via matrix power method
b <- transition_matrix_low_favor_ties_poisson
for (i in 1:1000) {
  b <- b %*% transition_matrix_low_favor_ties_poisson
}
stationary_distribution_low_favor_poisson <- b[1, ] / sum(b[1, ])
names(stationary_distribution_low_favor_poisson) <- rownames(transition_matrix_low_favor_ties_poisson)

# Step 3: Convert to data frame and sort
stationary_df_low_favor_ties_poisson <- data.frame(
  Team = names(stationary_distribution_low_favor_poisson),
  Probability = as.numeric(stationary_distribution_low_favor_poisson)
) %>%
  arrange(desc(Probability))

rownames(stationary_df_low_favor_ties_poisson) <- NULL

# Step 4: Output
print(" Stationary Distribution (Low-Favor Tie Model on Poisson-Simulated Data):")
print(stationary_df_low_favor_ties_poisson)

# Optional: View transition matrix
transition_df_low_favor_ties_poisson <- as.data.frame(transition_matrix_low_favor_ties_poisson)
transition_df_low_favor_ties_poisson$Team <- rownames(transition_matrix_low_favor_ties_poisson)
transition_df_low_favor_ties_poisson <- transition_df_low_favor_ties_poisson[, c("Team", setdiff(names(transition_df_low_favor_ties_poisson), "Team"))]

print(" Transition Matrix with Low-Favor Ties (Poisson Data):")
print(transition_df_low_favor_ties_poisson)


```
```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to compute KenPom-style SOS from simulated data
compute_kenpom_sos_poisson <- function(schedule_data) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  opponents <- list()

  for (team in teams) {
    games_as_home <- schedule_data %>% filter(Home == team) %>% pull(Away)
    games_as_away <- schedule_data %>% filter(Away == team) %>% pull(Home)
    opponents[[team]] <- c(games_as_home, games_as_away)
  }

  owp <- sapply(teams, function(team) {
    opps <- opponents[[team]]
    mean(sapply(opps, function(opp) {
      opp_games <- schedule_data %>% 
        filter(Home == opp | Away == opp)
      opp_results <- ifelse(opp_games$Home == opp,
                            opp_games$home_team_score > opp_games$away_team_score,
                            opp_games$away_team_score > opp_games$home_team_score)
      mean(opp_results)
    }), na.rm = TRUE)
  })

  return(owp)
}

# Create SOS-adjusted transition matrix from Poisson data
create_sos_adjusted_transition_matrix <- function(schedule_data, kenpom_sos, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  max_sos <- max(kenpom_sos, na.rm = TRUE)
  kenpom_sos <- kenpom_sos / max_sos  # Normalize

  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:nrow(schedule_data)) {
    home <- schedule_data$Home[i]
    away <- schedule_data$Away[i]
    hs <- schedule_data$home_team_score[i]
    as <- schedule_data$away_team_score[i]
    margin <- abs(hs - as) + 1

    if (home %in% teams & away %in% teams) {
      hw <- kenpom_sos[away] + alpha
      aw <- kenpom_sos[home] + alpha
      wt <- hw + aw
      hw <- hw / wt
      aw <- aw / wt

      if (hs > as) {
        transition_matrix[team_index[away], team_index[home]] <- margin^beta * hw
      } else if (hs < as) {
        transition_matrix[team_index[home], team_index[away]] <- margin^beta * aw
      } else {
        transition_matrix[team_index[home], team_index[away]] <- margin^beta * 0.5 * aw
        transition_matrix[team_index[away], team_index[home]] <- margin^beta * 0.5 * hw
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

# Compute stationary distribution
compute_stationary_distribution <- function(transition_matrix) {
  eig <- eigen(t(transition_matrix))
  vec <- eig$vectors[, which.max(Re(eig$values))]
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(Re(dist))
}

# Filter Poisson schedule
filtered_poisson_data <- simulated_schedule_poisson_alt %>%
  group_by(Home) %>%
  summarise(Home_Games = n()) %>%
  full_join(simulated_schedule_poisson_alt %>% group_by(Away) %>% summarise(Away_Games = n()), by = c("Home" = "Away")) %>%
  mutate(Total = rowSums(select(., Home_Games, Away_Games), na.rm = TRUE)) %>%
  filter(Total >= 3) %>%
  pull(Home)

# Step-by-step computation
kenpom_sos_sim <- compute_kenpom_sos_poisson(simulated_schedule_poisson_alt)
transition_matrix_sos_sim <- create_sos_adjusted_transition_matrix(simulated_schedule_poisson_alt, kenpom_sos_sim)
stationary_dist_sos_sim <- compute_stationary_distribution(transition_matrix_sos_sim)

# Final SOS ranking from Poisson data
stationary_df_sos_poisson <- data.frame(
  Team = names(stationary_dist_sos_sim),
  Rating = stationary_dist_sos_sim
) %>% arrange(desc(Rating))

print(" SOS-adjusted rankings based on simulated Poisson dataset:")
print(stationary_df_sos_poisson)



```

```{r}
library(dplyr)
library(igraph)

# Step 1: Initialize Elo-based priors (default for simulated Poisson)
initialize_elo_ratings <- function(teams) {
  ratings <- setNames(rep(1500, length(teams)), teams)
  return(ratings)
}

# Step 2: Get valid teams with minimum games
get_valid_teams <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)

  valid_teams <- team_game_counts %>%
    filter(Total_Games >= min_games) %>%
    pull(Home)

  return(valid_teams)
}

# Step 3: Bayesian Transition Matrix (adjusted for simulated data)
create_bayesian_transition_matrix <- function(schedule_data, elo_priors) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  prior_wins <- (elo_priors - min(elo_priors)) / (max(elo_priors) - min(elo_priors) + 1e-6) * 5 + 1
  prior_losses <- 6 - prior_wins

  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]

    if (!(home_team %in% teams && away_team %in% teams)) next

    tie <- (home_score == away_score)

    if (!tie) {
      winner <- ifelse(home_score > away_score, home_team, away_team)
      loser <- ifelse(home_score > away_score, away_team, home_team)
      transition_matrix[team_index[loser], team_index[winner]] <-
        transition_matrix[team_index[loser], team_index[winner]] +
        (prior_wins[winner] + 1) / (prior_wins[winner] + prior_losses[winner] + 2)
    } else {
      transition_matrix[team_index[home_team], team_index[away_team]] <-
        transition_matrix[team_index[home_team], team_index[away_team]] +
        (prior_wins[away_team] + 0.5) / (prior_wins[away_team] + prior_losses[away_team] + 1)

      transition_matrix[team_index[away_team], team_index[home_team]] <-
        transition_matrix[team_index[away_team], team_index[home_team]] +
        (prior_wins[home_team] + 0.5) / (prior_wins[home_team] + prior_losses[home_team] + 1)
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  return(transition_matrix)
}

# Step 4: Compute Stationary Distribution
compute_stationary_distribution <- function(transition_matrix, valid_teams) {
  eig <- eigen(t(transition_matrix))
  vec <- Re(eig$vectors[, which.max(Re(eig$values))])
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(dist[names(dist) %in% valid_teams])
}

# Step 5: Run it on the simulated dataset
teams_sim <- unique(c(simulated_schedule_poisson_alt$Home, simulated_schedule_poisson_alt$Away))
elo_priors_sim <- initialize_elo_ratings(teams_sim)
valid_teams_sim <- get_valid_teams(simulated_schedule_poisson_alt)

bayesian_transition_matrix_sim <- create_bayesian_transition_matrix(simulated_schedule_poisson_alt, elo_priors_sim)
bayesian_stationary_distribution_sim <- compute_stationary_distribution(bayesian_transition_matrix_sim, valid_teams_sim)

# Step 6: Format and print results
bayesian_rankings_simulated_df <- data.frame(
  Team = names(bayesian_stationary_distribution_sim),
  Bayesian_Rating = bayesian_stationary_distribution_sim
) %>% arrange(desc(Bayesian_Rating))

print(" Bayesian Rankings for Simulated Dataset:")
print(bayesian_rankings_simulated_df)




```
```{r}
# Step 0: Load necessary libraries
library(dplyr)

# Step 1: Create a combined dataframe from the simulated Poisson data models
rankings_df_simulated <- stationary_df_pagerank_poisson %>%
  select(Team, PageRank = Rating) %>%
  left_join(elo_ratings_sorted_poisson_df, by = "Team") %>%
  left_join(stationary_df_filtered_poisson %>% rename(Filtered_Transition = Rating), by = "Team") %>%
  left_join(stationary_df_winmargin_poisson %>% rename(WinMargin = Probability), by = "Team") %>%
  left_join(stationary_df_low_favor_ties_poisson %>% rename(Low_Favor_Ties = Probability), by = "Team") %>%
  left_join(stationary_df_sos_poisson %>% rename(Strength_Schedule = Rating), by = "Team") %>%
  left_join(bayesian_rankings_simulated_df, by = "Team") %>%
  na.omit()

# Step 2: Standardize model scores as done in the original ridge regression
rankings_df_simulated_scaled <- rankings_df_simulated %>%
  mutate(across(
    c(Elo_Rating, PageRank, Filtered_Transition, WinMargin,
      Low_Favor_Ties, Strength_Schedule, Bayesian_Rating),
    ~ as.numeric(scale(.x))
  ))

# Step 3: Apply ridge regression alpha weights learned from real data
ridge_alphas <- c(
  PageRank = 0.1814,
  Elo_Rating = 0.1532,
  Filtered_Transition = 0.0012,
  WinMargin = 0.0901,
  Low_Favor_Ties = 0.0829,
  Strength_Schedule = 0.1864,
  Bayesian_Rating = 0.1078
)

# Step 4: Compute final ridge score on simulated data
rankings_df_simulated_scaled$Final_Ranking_Ridge <- with(rankings_df_simulated_scaled,
  Elo_Rating * ridge_alphas["Elo_Rating"] +
  PageRank * ridge_alphas["PageRank"] +
  Filtered_Transition * ridge_alphas["Filtered_Transition"] +
  WinMargin * ridge_alphas["WinMargin"] +
  Low_Favor_Ties * ridge_alphas["Low_Favor_Ties"] +
  Strength_Schedule * ridge_alphas["Strength_Schedule"] +
  Bayesian_Rating * ridge_alphas["Bayesian_Rating"]
)

# Step 5: Output final rankings
final_ridge_simulated_df <- rankings_df_simulated_scaled %>%
  select(Team, Final_Ranking_Ridge) %>%
  arrange(desc(Final_Ranking_Ridge))

# Print results
print(" Final Ridge Rankings on Simulated SCIAC-Prioritized Data:")
print(final_ridge_simulated_df)

```
```{r}
library(dplyr)

set.seed(42)  # for reproducibility

# Step 1: Filter to teams with at least 3 games
team_game_counts <- all_schedule_data %>%
  group_by(Home) %>%
  summarise(Home_Games = n()) %>%
  full_join(all_schedule_data %>% group_by(Away) %>% summarise(Away_Games = n()), by = c("Home" = "Away")) %>%
  mutate(Total_Games = rowSums(across(c(Home_Games, Away_Games)), na.rm = TRUE)) %>%
  filter(Total_Games >= 3)

valid_teams <- team_game_counts$Home

# Step 2: Filter the dataset
filtered_schedule <- all_schedule_data %>%
  filter(Home %in% valid_teams & Away %in% valid_teams)

# Step 3: Get unique teams from filtered data
unique_filtered_teams <- sort(unique(c(filtered_schedule$Home, filtered_schedule$Away)))
```


```{r}
random_lambdas <- runif(length(unique_filtered_teams), min = 0.5, max = 4.5)
true_lambda_values <- setNames(random_lambdas, unique_filtered_teams)

#  Step 5: Simulate matches using those lambdas
simulated_schedule_lambda_unique <- filtered_schedule %>%
  mutate(
    home_lambda = true_lambda_values[Home],
    away_lambda = true_lambda_values[Away],
    home_team_score = rpois(n(), lambda = home_lambda),
    away_team_score = rpois(n(), lambda = away_lambda),
    home_score_margin = home_team_score - away_team_score
  ) %>%
  select(Home, Away, home_team_score, away_team_score, home_score_margin)

#  Step 6: Save ground truth lambda for analysis later
lambda_truth <- data.frame(
  Team = names(true_lambda_values),
  Lambda = as.numeric(true_lambda_values)
) %>% arrange(desc(Lambda))

lambda_truth




```




```{r}
# Load necessary libraries
library(dplyr)

# Step 0: Get the teams involved
teams_lambda_sim <- unique(c(simulated_schedule_lambda_unique$Home, simulated_schedule_lambda_unique$Away))

# Step 1: Initialize ratings for simulated lambda dataset (all teams start at 1500)
initial_ratings_lambda_sim <- setNames(rep(1500, length(teams_lambda_sim)), teams_lambda_sim)

# Step 2: Calculate Elo ratings using your Elo function on the simulated data
final_elo_ratings_lambda_sim <- elo_ratings_div3(simulated_schedule_lambda_unique, initial_ratings_lambda_sim, K = 32)

# Step 3: Create a DataFrame and sort the results
elo_ratings_sorted_lambda_sim_df <- data.frame(
  Team = names(final_elo_ratings_lambda_sim),
  Elo_Rating = unlist(final_elo_ratings_lambda_sim)
) %>% arrange(desc(Elo_Rating))

# Step 4: Filter to only valid teams (played  3 games)
valid_teams_lambda_sim <- get_valid_teams(simulated_schedule_lambda_unique, min_games = 3)
elo_ratings_sorted_lambda_sim_df <- elo_ratings_sorted_lambda_sim_df %>%
  filter(Team %in% valid_teams_lambda_sim)

# Step 5: Display the result
print(" Elo Ratings on Simulated Dataset with Unique Lambdas:")
print(elo_ratings_sorted_lambda_sim_df)



```

```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to create an adjusted transition matrix
create_adjusted_transition_matrix <- function(schedule_data, damping_factor = 0.85, beta = 0.5, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]
    margin <- abs(home_score - away_score)

    if (home_score > away_score) {
      transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.9
    } else if (home_score < away_score) {
      transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 1.1
    } else {
      transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 0.5
      transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.5
    }
  }

  row_sums <- rowSums(transition_matrix)
  zero_rows <- which(row_sums == 0)
  if (length(zero_rows) > 0) {
    transition_matrix[zero_rows, ] <- 1 / n
    row_sums <- rowSums(transition_matrix)
  }

  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  # Laplacian smoothing
  transition_matrix <- transition_matrix + alpha
  transition_matrix <- sweep(transition_matrix, 1, rowSums(transition_matrix), FUN = "/")

  return(transition_matrix)
}

# Function to compute the stationary distribution
compute_stationary_distribution <- function(transition_matrix) {
  eigen_results <- eigen(t(transition_matrix))
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- Re(stationary_vector / sum(stationary_vector))
  names(stationary_distribution) <- rownames(transition_matrix)
  return(stationary_distribution)
}

# --- Main Pipeline for Simulated Lambda Dataset ---

# Step 1: Create the transition matrix
transition_matrix_lambda_sim <- create_adjusted_transition_matrix(simulated_schedule_lambda_unique)

# Step 2: Compute the stationary distribution
stationary_distribution_lambda_sim <- compute_stationary_distribution(transition_matrix_lambda_sim)

# Step 3: Convert to a ranked dataframe
stationary_df_pagerank_lambda_sim <- data.frame(
  Team = names(stationary_distribution_lambda_sim),
  Rating = stationary_distribution_lambda_sim
) %>% arrange(desc(Rating))

# Step 4: View or return the results
print(" PageRank Rankings from Simulated Dataset with Unique Lambdas:")
print(stationary_df_pagerank_lambda_sim)



```

```{r}
# Load required libraries
library(dplyr)

# Step 1: Function to build full bidirectional transition matrix
create_adjusted_transition_matrix <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))

      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()

        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]

          if (home_score + away_score > 0) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else {
            p <- 0.5
          }

          pitoj[k] <- max(0, min(1, p))
        }

        avg_p <- mean(pitoj)

        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * avg_p
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - avg_p)
      }
    }
  }

  transition_matrix <- transition_matrix + alpha
  transition_matrix <- sweep(transition_matrix, 1, rowSums(transition_matrix), FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  return(transition_matrix)
}

# Step 2: Function to get valid teams (played  3 games)
get_valid_teams <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)

  valid_teams <- team_game_counts %>%
    filter(Total_Games >= min_games) %>%
    pull(Home)

  return(valid_teams)
}

# Step 3: Function to compute stationary distribution
compute_stationary_distribution <- function(transition_matrix, valid_teams) {
  eigen_results <- eigen(t(transition_matrix))
  stationary_vector <- Re(eigen_results$vectors[, which.max(Re(eigen_results$values))])
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix)
  return(stationary_distribution[names(stationary_distribution) %in% valid_teams])
}

# Step 4: Run model using your simulated dataset
transition_matrix_lambda_filtered <- create_adjusted_transition_matrix(simulated_schedule_lambda_unique)
valid_teams_lambda <- get_valid_teams(simulated_schedule_lambda_unique)
stationary_distribution_filtered_lambda <- compute_stationary_distribution(
  transition_matrix_lambda_filtered,
  valid_teams_lambda
)

# Step 5: Format results into DataFrame
stationary_df_filtered_lambda <- data.frame(
  Team = names(stationary_distribution_filtered_lambda),
  Rating = stationary_distribution_filtered_lambda
) %>%
  arrange(desc(Rating))

# Step 6: Print final results
cat(" Corrected Filtered Transition Rankings:\n")
print(stationary_df_filtered_lambda)




```

```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# --- Win Margin Transition Matrix Function ---
create_adjusted_transition_matrix <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))

      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()

        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]
          margin <- abs(home_score - away_score)

          if (home_score + away_score > 0) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else {
            p <- 0.5
          }

          pitoj[k] <- max(0, min(1, p))
        }

        pitoj1 <- mean(pitoj)
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

# --- MAIN PIPELINE using simulated_schedule_lambda_unique ---

# Step 1: Build transition matrix from lambda-based simulated data
transition_matrix_winmargin_lambda <- create_adjusted_transition_matrix(simulated_schedule_lambda_unique)

# Step 2: Matrix multiplication to get stationary distribution
b <- transition_matrix_winmargin_lambda
for (i in 1:1000) {
  b <- b %*% transition_matrix_winmargin_lambda
}

# Step 3: Extract and normalize
stationary_distribution_winmargin_lambda <- b[1, ] / sum(b[1, ])
names(stationary_distribution_winmargin_lambda) <- rownames(transition_matrix_winmargin_lambda)

# Step 4: Format results into data frame
stationary_df_winmargin_lambda <- data.frame(
  Team = names(stationary_distribution_winmargin_lambda),
  Probability = as.numeric(stationary_distribution_winmargin_lambda)
) %>%
  arrange(desc(Probability))

rownames(stationary_df_winmargin_lambda) <- NULL

# Step 5: Display results
print(" Stationary Distribution (Win Margin Model on Lambda-Simulated Data):")
print(stationary_df_winmargin_lambda)




```

```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to create adjusted transition matrix with low-favor tie handling for lambda-unique dataset
create_transition_matrix_lowfavor_lambda_unique <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  prob_shift <- 0.6

  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))

      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()

        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]

          if (home_score > away_score) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else if (away_score > home_score) {
            p <- (away_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * (1 - ihome[k])
          } else {
            p <- ifelse(teams[i] < teams[j], 0.5 * (1 - prob_shift), 0.5 * prob_shift)
          }

          pitoj[k] <- max(0, min(1, p))
        }

        pitoj1 <- mean(pitoj)
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  return(transition_matrix)
}

# Step 1: Create the transition matrix
transition_matrix_lowfavor_lambda_unique <- create_transition_matrix_lowfavor_lambda_unique(simulated_schedule_lambda_unique)

# Step 2: Matrix multiplication to converge
b <- transition_matrix_lowfavor_lambda_unique
for (i in 1:1000) {
  b <- b %*% transition_matrix_lowfavor_lambda_unique
}
stationary_distribution_lowfavor_lambda_unique <- b[1, ] / sum(b[1, ])
names(stationary_distribution_lowfavor_lambda_unique) <- rownames(transition_matrix_lowfavor_lambda_unique)

# Step 3: Format results
stationary_df_lowfavor_lambda_unique <- data.frame(
  Team = names(stationary_distribution_lowfavor_lambda_unique),
  Probability = as.numeric(stationary_distribution_lowfavor_lambda_unique)
) %>%
  arrange(desc(Probability))

rownames(stationary_df_lowfavor_lambda_unique) <- NULL

# Step 4: Display final results
print(" Stationary Distribution (Low-Favor Tie Model on Unique Lambda Simulated Data):")
print(stationary_df_lowfavor_lambda_unique)





```

```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Function to compute KenPom-style SOS from simulated data
compute_kenpom_sos_lambda_unique <- function(schedule_data) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  opponents <- list()

  for (team in teams) {
    games_as_home <- schedule_data %>% filter(Home == team) %>% pull(Away)
    games_as_away <- schedule_data %>% filter(Away == team) %>% pull(Home)
    opponents[[team]] <- c(games_as_home, games_as_away)
  }

  owp <- sapply(teams, function(team) {
    opps <- opponents[[team]]
    mean(sapply(opps, function(opp) {
      opp_games <- schedule_data %>% 
        filter(Home == opp | Away == opp)
      opp_results <- ifelse(opp_games$Home == opp,
                            opp_games$home_team_score > opp_games$away_team_score,
                            opp_games$away_team_score > opp_games$home_team_score)
      mean(opp_results)
    }), na.rm = TRUE)
  })

  return(owp)
}

# Function to create SOS-adjusted transition matrix
create_sos_adjusted_transition_matrix_lambda_unique <- function(schedule_data, kenpom_sos, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  max_sos <- max(kenpom_sos, na.rm = TRUE)
  kenpom_sos <- kenpom_sos / max_sos

  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:nrow(schedule_data)) {
    home <- schedule_data$Home[i]
    away <- schedule_data$Away[i]
    hs <- schedule_data$home_team_score[i]
    as <- schedule_data$away_team_score[i]
    margin <- abs(hs - as) + 1

    if (home %in% teams & away %in% teams) {
      hw <- kenpom_sos[away] + alpha
      aw <- kenpom_sos[home] + alpha
      wt <- hw + aw
      hw <- hw / wt
      aw <- aw / wt

      if (hs > as) {
        transition_matrix[team_index[away], team_index[home]] <- margin^beta * hw
      } else if (hs < as) {
        transition_matrix[team_index[home], team_index[away]] <- margin^beta * aw
      } else {
        transition_matrix[team_index[home], team_index[away]] <- margin^beta * 0.5 * aw
        transition_matrix[team_index[away], team_index[home]] <- margin^beta * 0.5 * hw
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

# Function to compute stationary distribution
compute_stationary_distribution <- function(transition_matrix) {
  eig <- eigen(t(transition_matrix))
  vec <- eig$vectors[, which.max(Re(eig$values))]
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(Re(dist))
}

# Step-by-step computation using simulated_schedule_lambda_unique
kenpom_sos_lambda_unique <- compute_kenpom_sos_lambda_unique(simulated_schedule_lambda_unique)
transition_matrix_sos_lambda_unique <- create_sos_adjusted_transition_matrix_lambda_unique(simulated_schedule_lambda_unique, kenpom_sos_lambda_unique)
stationary_dist_sos_lambda_unique <- compute_stationary_distribution(transition_matrix_sos_lambda_unique)

# Final SOS ranking
stationary_df_sos_lambda_unique <- data.frame(
  Team = names(stationary_dist_sos_lambda_unique),
  Rating = stationary_dist_sos_lambda_unique
) %>% arrange(desc(Rating))

# Display results
print(" SOS-adjusted rankings based on unique lambda simulated dataset:")
print(stationary_df_sos_lambda_unique)



```

```{r}
# Load necessary libraries
library(dplyr)
library(igraph)

# Step 1: Initialize Elo-based priors (flat 1500 for simulated)
initialize_elo_ratings <- function(teams) {
  ratings <- setNames(rep(1500, length(teams)), teams)
  return(ratings)
}

# Step 2: Get valid teams ( 3 games)
get_valid_teams <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)

  valid_teams <- team_game_counts %>%
    filter(Total_Games >= min_games) %>%
    pull(Home)

  return(valid_teams)
}

# Step 3: Create Bayesian Transition Matrix
create_bayesian_transition_matrix <- function(schedule_data, elo_priors) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  prior_wins <- (elo_priors - min(elo_priors)) / (max(elo_priors) - min(elo_priors) + 1e-6) * 5 + 1
  prior_losses <- 6 - prior_wins

  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]

    if (!(home_team %in% teams && away_team %in% teams)) next

    tie <- (home_score == away_score)

    if (!tie) {
      winner <- ifelse(home_score > away_score, home_team, away_team)
      loser <- ifelse(home_score > away_score, away_team, home_team)
      transition_matrix[team_index[loser], team_index[winner]] <-
        transition_matrix[team_index[loser], team_index[winner]] +
        (prior_wins[winner] + 1) / (prior_wins[winner] + prior_losses[winner] + 2)
    } else {
      transition_matrix[team_index[home_team], team_index[away_team]] <-
        transition_matrix[team_index[home_team], team_index[away_team]] +
        (prior_wins[away_team] + 0.5) / (prior_wins[away_team] + prior_losses[away_team] + 1)

      transition_matrix[team_index[away_team], team_index[home_team]] <-
        transition_matrix[team_index[away_team], team_index[home_team]] +
        (prior_wins[home_team] + 0.5) / (prior_wins[home_team] + prior_losses[home_team] + 1)
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  return(transition_matrix)
}

# Step 4: Compute Stationary Distribution
compute_stationary_distribution <- function(transition_matrix, valid_teams) {
  eig <- eigen(t(transition_matrix))
  vec <- Re(eig$vectors[, which.max(Re(eig$values))])
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(dist[names(dist) %in% valid_teams])
}

# Step 5: Run on simulated dataset with unique lambdas
teams_sim <- unique(c(simulated_schedule_lambda_unique$Home, simulated_schedule_lambda_unique$Away))
elo_priors_sim <- initialize_elo_ratings(teams_sim)
valid_teams_sim <- get_valid_teams(simulated_schedule_lambda_unique)

bayesian_transition_matrix_sim <- create_bayesian_transition_matrix(simulated_schedule_lambda_unique, elo_priors_sim)
bayesian_stationary_distribution_sim <- compute_stationary_distribution(bayesian_transition_matrix_sim, valid_teams_sim)

# Step 6: Format and display
bayesian_rankings_simulated_df <- data.frame(
  Team = names(bayesian_stationary_distribution_sim),
  Bayesian_Rating = bayesian_stationary_distribution_sim
) %>% arrange(desc(Bayesian_Rating))

print(" Bayesian Rankings for Simulated Lambda Dataset:")
print(bayesian_rankings_simulated_df)
```

```{r}
# Step 0: Load required library
library(dplyr)

# Step 1: Combine model outputs into a single DataFrame
rankings_df_lambda_unique <- stationary_df_pagerank_lambda_sim %>%
  select(Team, PageRank = Rating) %>%
  left_join(elo_ratings_sorted_lambda_sim_df, by = "Team") %>%
  left_join(stationary_df_filtered_lambda %>% rename(Filtered_Transition = Rating), by = "Team") %>%
  left_join(stationary_df_winmargin_lambda %>% rename(WinMargin = Probability), by = "Team") %>%
  left_join(stationary_df_lowfavor_lambda_unique %>% rename(Low_Favor_Ties = Probability), by = "Team") %>%
  left_join(stationary_df_sos_lambda_unique %>% rename(Strength_Schedule = Rating), by = "Team") %>%
  left_join(bayesian_rankings_simulated_df, by = "Team") %>%
  na.omit()

# Step 2: Standardize model columns
rankings_df_lambda_unique_scaled <- rankings_df_lambda_unique %>%
  mutate(across(
    c(Elo_Rating, PageRank, Filtered_Transition, WinMargin,
      Low_Favor_Ties, Strength_Schedule, Bayesian_Rating),
    ~ as.numeric(scale(.x))
  ))

# Step 3: Ridge weights from real data
ridge_alphas <- c(
  PageRank = 0.1814,
  Elo_Rating = 0.1532,
  Filtered_Transition = 0.0012,
  WinMargin = 0.0901,
  Low_Favor_Ties = 0.0829,
  Strength_Schedule = 0.1864,
  Bayesian_Rating = 0.1078
)

# Step 4: Compute ridge ranking score
rankings_df_lambda_unique_scaled$Final_Ranking_Ridge <- with(rankings_df_lambda_unique_scaled,
  Elo_Rating * ridge_alphas["Elo_Rating"] +
  PageRank * ridge_alphas["PageRank"] +
  Filtered_Transition * ridge_alphas["Filtered_Transition"] +
  WinMargin * ridge_alphas["WinMargin"] +
  Low_Favor_Ties * ridge_alphas["Low_Favor_Ties"] +
  Strength_Schedule * ridge_alphas["Strength_Schedule"] +
  Bayesian_Rating * ridge_alphas["Bayesian_Rating"]
)

# Step 5: Sort and compare to ground truth
final_ridge_lambda_df <- rankings_df_lambda_unique_scaled %>%
  select(Team, Final_Ranking_Ridge) %>%
  arrange(desc(Final_Ranking_Ridge)) %>%
  left_join(lambda_truth, by = "Team") %>%
  mutate(Ridge_Rank = row_number()) %>%
  arrange(desc(Lambda)) %>%
  mutate(True_Rank = row_number()) %>%
  arrange(Ridge_Rank)

# Step 6: Display
print(" Ridge vs True Lambda Ranking Comparison (Simulated with Unique Lambdas):")
print(final_ridge_lambda_df)


```




```{r}
# Step 1: Take the top 25 based on Final_Ranking_Ridge
top25_ridge <- final_ridge_lambda_df %>%
  slice(1:25) %>%
  mutate(
    True_Rank_Diff = abs(Ridge_Rank - True_Rank)
  )

# Step 2: View how far off they were ranked
print(" Top 25 Ridge Rankings vs True Lambda Ranks:")
print(top25_ridge %>% select(Team, Final_Ranking_Ridge, Ridge_Rank, True_Rank, True_Rank_Diff))

# Step 3: Summary of error
avg_rank_error <- mean(top25_ridge$True_Rank_Diff)
max_rank_error <- max(top25_ridge$True_Rank_Diff)

cat("\n Summary for Top 25:\n")
cat(" Average Absolute Rank Error:", round(avg_rank_error, 2), "\n")
cat(" Max Absolute Rank Error:", max_rank_error, "\n")

```

```{r}
library(dplyr)
library(scales)

# Step 1: Filter teams with at least 3 games
team_game_counts <- all_schedule_data %>%
  group_by(Home) %>%
  summarise(Home_Games = n()) %>%
  full_join(all_schedule_data %>%
              group_by(Away) %>%
              summarise(Away_Games = n()),
            by = c("Home" = "Away")) %>%
  mutate(Total_Games = rowSums(across(c(Home_Games, Away_Games)), na.rm = TRUE)) %>%
  filter(Total_Games >= 3)

valid_teams <- team_game_counts$Home

# Step 2: Filter full schedule to just valid teams
filtered_schedule <- all_schedule_data %>%
  filter(Home %in% valid_teams & Away %in% valid_teams)

# Step 3: Get the unique team list
unique_filtered_teams <- sort(unique(c(filtered_schedule$Home, filtered_schedule$Away)))

# Step 4: Assign random offensive and defensive lambda values
# We'll use the same uniform distribution used previously for goal realism
off_lambdas <- setNames(runif(length(unique_filtered_teams), 0.5, 4.5), unique_filtered_teams)
def_lambdas <- setNames(runif(length(unique_filtered_teams), 0.5, 4.5), unique_filtered_teams)

# Step 5: Simulate scores using offensive and defensive lambdas
simulated_schedule_lambda_offdef <- filtered_schedule %>%
  mutate(
    home_off_lambda = off_lambdas[Home],
    home_def_lambda = def_lambdas[Home],
    away_off_lambda = off_lambdas[Away],
    away_def_lambda = def_lambdas[Away],
    home_lambda = home_off_lambda / away_def_lambda,
    away_lambda = away_off_lambda / home_def_lambda,
    home_team_score = rpois(n(), lambda = home_lambda),
    away_team_score = rpois(n(), lambda = away_lambda),
    home_score_margin = home_team_score - away_team_score
  ) %>%
  select(Home, Away,
         home_team_score, away_team_score, home_score_margin,
         home_off_lambda, home_def_lambda, away_off_lambda, away_def_lambda)

# Step 6: Create ground truth offensive and defensive values
lambda_truth_offdef <- data.frame(
  Team = names(off_lambdas),
  Offense_Lambda = as.numeric(off_lambdas),
  Defense_Lambda = as.numeric(def_lambdas)
) %>%
  arrange(desc(Offense_Lambda))  # Sort by offensive rating by default

# Output preview
simulated_schedule_lambda_offdef
lambda_truth_offdef

```
```{r}
# Step 0: Get the teams involved in the new off/def simulated dataset
teams_lambda_offdef <- unique(c(simulated_schedule_lambda_offdef$Home, simulated_schedule_lambda_offdef$Away))

# Step 1: Initialize Elo ratings (starting at 1500)
initial_ratings_lambda_offdef <- setNames(rep(1500, length(teams_lambda_offdef)), teams_lambda_offdef)

# Step 2: Calculate Elo ratings using your function on the new dataset
final_elo_ratings_lambda_offdef <- elo_ratings_div3(
  simulated_schedule_lambda_offdef,
  initial_ratings_lambda_offdef,
  K = 32
)

# Step 3: Create and sort into a DataFrame
elo_ratings_sorted_lambda_offdef_df <- data.frame(
  Team = names(final_elo_ratings_lambda_offdef),
  Elo_Rating = unlist(final_elo_ratings_lambda_offdef)
) %>% arrange(desc(Elo_Rating))

# Step 4: Keep only valid teams ( 3 games played)
valid_teams_lambda_offdef <- get_valid_teams(simulated_schedule_lambda_offdef, min_games = 3)
elo_ratings_sorted_lambda_offdef_df <- elo_ratings_sorted_lambda_offdef_df %>%
  filter(Team %in% valid_teams_lambda_offdef)

# Step 5: Display result
print(" Elo Ratings on Simulated Dataset with Offensive and Defensive Lambdas:")
print(elo_ratings_sorted_lambda_offdef_df)

```
```{r}
# Function to create an adjusted transition matrix (Win Margin)
create_adjusted_transition_matrix_offdef <- function(schedule_data, damping_factor = 0.85, beta = 0.5, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]
    margin <- abs(home_score - away_score)

    if (home_score > away_score) {
      transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.9
    } else if (home_score < away_score) {
      transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 1.1
    } else {
      transition_matrix[team_index[home_team], team_index[away_team]] <- margin^beta * 0.5
      transition_matrix[team_index[away_team], team_index[home_team]] <- margin^beta * 0.5
    }
  }

  row_sums <- rowSums(transition_matrix)
  zero_rows <- which(row_sums == 0)
  if (length(zero_rows) > 0) {
    transition_matrix[zero_rows, ] <- 1 / n
    row_sums <- rowSums(transition_matrix)
  }

  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  # Laplacian smoothing
  transition_matrix <- transition_matrix + alpha
  transition_matrix <- sweep(transition_matrix, 1, rowSums(transition_matrix), FUN = "/")

  return(transition_matrix)
}

# Function to compute stationary distribution
compute_stationary_distribution_offdef <- function(transition_matrix) {
  eig <- eigen(t(transition_matrix))
  vec <- eig$vectors[, which.max(Re(eig$values))]
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(Re(dist))
}

# --- Main Execution Pipeline for Off/Def Simulation ---

# Step 1: Create transition matrix from new dataset
transition_matrix_offdef_pagerank <- create_adjusted_transition_matrix_offdef(simulated_schedule_lambda_offdef)

# Step 2: Compute stationary distribution
stationary_distribution_offdef_pagerank <- compute_stationary_distribution_offdef(transition_matrix_offdef_pagerank)

# Step 3: Turn into ranked dataframe
stationary_df_pagerank_offdef <- data.frame(
  Team = names(stationary_distribution_offdef_pagerank),
  Rating = stationary_distribution_offdef_pagerank
) %>% arrange(desc(Rating))

# Step 4: Display
print(" PageRank Rankings from Simulated Dataset with Offensive and Defensive Lambdas:")
print(stationary_df_pagerank_offdef)

```
```{r}
# --- Filtered Transition Model for Simulated Dataset with Offensive and Defensive Lambdas ---

# Step 1: Helper to get valid teams
get_valid_teams_offdef <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    dplyr::group_by(Home) %>%
    dplyr::summarise(Games_Home = n()) %>%
    full_join(
      schedule_data %>%
        dplyr::group_by(Away) %>%
        dplyr::summarise(Games_Away = n()),
      by = c("Home" = "Away")
    ) %>%
    mutate(Total_Games = rowSums(dplyr::select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    dplyr::select(Home, Total_Games)

  valid_teams <- team_game_counts %>% filter(Total_Games >= min_games) %>% pull(Home)
  return(valid_teams)
}

# Step 2: Transition matrix creator
create_adjusted_transition_matrix_offdef_filtered <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:length(teams)) {
    for (j in 1:length(teams)) {
      if (i != j) {
        grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                      (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))

        if (length(grow) >= 1) {
          subdata <- schedule_data[grow, ]
          ihome <- (subdata$Home == teams[i])
          pitoj <- c()

          for (k in 1:length(grow)) {
            home_score <- subdata$home_team_score[k]
            away_score <- subdata$away_team_score[k]
            margin <- abs(home_score - away_score)

            if (home_score + away_score > 0) {
              p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
              p <- p + (1 - 2 * p) * ihome[k]
            } else {
              p <- 0.5
            }
            pitoj[k] <- max(0, min(1, p))
          }

          pitoj1 <- mean(pitoj)
          transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- pitoj1
        }
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  zero_row_indices <- which(row_sums == 0)
  if (length(zero_row_indices) > 0) {
    transition_matrix[zero_row_indices, ] <- 1 / n
    row_sums <- rowSums(transition_matrix)
  }

  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

# Step 3: Stationary distribution
compute_stationary_distribution_offdef_filtered <- function(transition_matrix, valid_teams) {
  eigen_results <- eigen(t(transition_matrix))
  stationary_vector <- eigen_results$vectors[, which.max(Re(eigen_results$values))]
  stationary_distribution <- stationary_vector / sum(stationary_vector)
  names(stationary_distribution) <- rownames(transition_matrix)
  stationary_distribution_filtered <- stationary_distribution[names(stationary_distribution) %in% valid_teams]
  return(Re(stationary_distribution_filtered))
}

# --- Execution ---

# Build transition matrix using the off/def simulation
transition_matrix_offdef_filtered <- create_adjusted_transition_matrix_offdef_filtered(simulated_schedule_lambda_offdef)

# Get valid teams (min 3 games)
valid_teams_offdef <- get_valid_teams_offdef(simulated_schedule_lambda_offdef, min_games = 3)

# Compute filtered stationary distribution
stationary_distribution_offdef_filtered <- compute_stationary_distribution_offdef_filtered(
  transition_matrix_offdef_filtered,
  valid_teams_offdef
)

# Convert to ranked dataframe
stationary_df_filtered_offdef <- data.frame(
  Team = names(stationary_distribution_offdef_filtered),
  Rating = stationary_distribution_offdef_filtered
) %>%
  arrange(desc(Rating))

# Output
print(" Filtered Transition Rankings on Simulated Dataset with Offense/Defense Lambdas:")
print(stationary_df_filtered_offdef)

```
```{r}
# --- Win Margin Transition Matrix Function for Off/Def Lambda Dataset ---
create_adjusted_transition_matrix_winmargin_offdef <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))

      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()

        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]
          margin <- abs(home_score - away_score)

          if (home_score + away_score > 0) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else {
            p <- 0.5
          }

          pitoj[k] <- max(0, min(1, p))
        }

        pitoj1 <- mean(pitoj)
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

# --- MAIN PIPELINE using simulated_schedule_lambda_offdef ---

# Step 1: Build transition matrix from off/def lambda-based simulated data
transition_matrix_winmargin_offdef <- create_adjusted_transition_matrix_winmargin_offdef(simulated_schedule_lambda_offdef)

# Step 2: Matrix multiplication to get stationary distribution
b <- transition_matrix_winmargin_offdef
for (i in 1:1000) {
  b <- b %*% transition_matrix_winmargin_offdef
}

# Step 3: Extract and normalize
stationary_distribution_winmargin_offdef <- b[1, ] / sum(b[1, ])
names(stationary_distribution_winmargin_offdef) <- rownames(transition_matrix_winmargin_offdef)

# Step 4: Format results into data frame
stationary_df_winmargin_offdef <- data.frame(
  Team = names(stationary_distribution_winmargin_offdef),
  Probability = as.numeric(stationary_distribution_winmargin_offdef)
) %>%
  arrange(desc(Probability))

rownames(stationary_df_winmargin_offdef) <- NULL

# Step 5: Display results
print(" Stationary Distribution (Win Margin Model on Offense/Defense Lambda-Simulated Data):")
print(stationary_df_winmargin_offdef)

```

```{r}
# Function to create adjusted transition matrix with low-favor tie handling for off/def lambda dataset
create_transition_matrix_lowfavor_offdef <- function(schedule_data, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))
  prob_shift <- 0.6

  for (i in 1:(length(teams) - 1)) {
    for (j in (i + 1):length(teams)) {
      grow <- which((schedule_data$Away == teams[i] | schedule_data$Home == teams[i]) &
                    (schedule_data$Away == teams[j] | schedule_data$Home == teams[j]))

      if (length(grow) >= 1) {
        subdata <- schedule_data[grow, ]
        ihome <- (subdata$Home == teams[i])
        pitoj <- c()

        for (k in 1:length(grow)) {
          home_score <- subdata$home_team_score[k]
          away_score <- subdata$away_team_score[k]

          if (home_score > away_score) {
            p <- (home_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * ihome[k]
          } else if (away_score > home_score) {
            p <- (away_score + alpha) / (home_score + away_score + 2 * alpha)
            p <- p + (1 - 2 * p) * (1 - ihome[k])
          } else {
            p <- ifelse(teams[i] < teams[j], 0.5 * (1 - prob_shift), 0.5 * prob_shift)
          }

          pitoj[k] <- max(0, min(1, p))
        }

        pitoj1 <- mean(pitoj)
        transition_matrix[team_index[teams[i]], team_index[teams[j]]] <- length(grow) * pitoj1
        transition_matrix[team_index[teams[j]], team_index[teams[i]]] <- length(grow) * (1 - pitoj1)
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  return(transition_matrix)
}

# Step 1: Create the transition matrix for simulated offense/defense lambda data
transition_matrix_lowfavor_offdef <- create_transition_matrix_lowfavor_offdef(simulated_schedule_lambda_offdef)

# Step 2: Matrix multiplication to converge
b <- transition_matrix_lowfavor_offdef
for (i in 1:1000) {
  b <- b %*% transition_matrix_lowfavor_offdef
}
stationary_distribution_lowfavor_offdef <- b[1, ] / sum(b[1, ])
names(stationary_distribution_lowfavor_offdef) <- rownames(transition_matrix_lowfavor_offdef)

# Step 3: Format results
stationary_df_lowfavor_offdef <- data.frame(
  Team = names(stationary_distribution_lowfavor_offdef),
  Probability = as.numeric(stationary_distribution_lowfavor_offdef)
) %>%
  arrange(desc(Probability))

rownames(stationary_df_lowfavor_offdef) <- NULL

# Step 4: Display final results
print(" Stationary Distribution (Low-Favor Tie Model on Off/Def Lambda Simulated Data):")
print(stationary_df_lowfavor_offdef)

```
```{r}
# Function to compute KenPom-style SOS from offense/defense simulated data
compute_kenpom_sos_offdef <- function(schedule_data) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  opponents <- list()

  for (team in teams) {
    games_as_home <- schedule_data %>% filter(Home == team) %>% pull(Away)
    games_as_away <- schedule_data %>% filter(Away == team) %>% pull(Home)
    opponents[[team]] <- c(games_as_home, games_as_away)
  }

  owp <- sapply(teams, function(team) {
    opps <- opponents[[team]]
    mean(sapply(opps, function(opp) {
      opp_games <- schedule_data %>% 
        filter(Home == opp | Away == opp)
      opp_results <- ifelse(opp_games$Home == opp,
                            opp_games$home_team_score > opp_games$away_team_score,
                            opp_games$away_team_score > opp_games$home_team_score)
      mean(opp_results)
    }), na.rm = TRUE)
  })

  return(owp)
}

# Function to create SOS-adjusted transition matrix
create_sos_adjusted_transition_matrix_offdef <- function(schedule_data, kenpom_sos, beta = 1.2, alpha = 0.01) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  max_sos <- max(kenpom_sos, na.rm = TRUE)
  kenpom_sos <- kenpom_sos / max_sos

  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  for (i in 1:nrow(schedule_data)) {
    home <- schedule_data$Home[i]
    away <- schedule_data$Away[i]
    hs <- schedule_data$home_team_score[i]
    as <- schedule_data$away_team_score[i]
    margin <- abs(hs - as) + 1

    if (home %in% teams & away %in% teams) {
      hw <- kenpom_sos[away] + alpha
      aw <- kenpom_sos[home] + alpha
      wt <- hw + aw
      hw <- hw / wt
      aw <- aw / wt

      if (hs > as) {
        transition_matrix[team_index[away], team_index[home]] <- margin^beta * hw
      } else if (hs < as) {
        transition_matrix[team_index[home], team_index[away]] <- margin^beta * aw
      } else {
        transition_matrix[team_index[home], team_index[away]] <- margin^beta * 0.5 * aw
        transition_matrix[team_index[away], team_index[home]] <- margin^beta * 0.5 * hw
      }
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0
  return(transition_matrix)
}

# Function to compute stationary distribution
compute_stationary_distribution_offdef <- function(transition_matrix) {
  eig <- eigen(t(transition_matrix))
  vec <- eig$vectors[, which.max(Re(eig$values))]
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(Re(dist))
}

# --- MAIN PIPELINE on simulated_schedule_lambda_offdef ---

# Step 1: Compute KenPom-style SOS
kenpom_sos_offdef <- compute_kenpom_sos_offdef(simulated_schedule_lambda_offdef)

# Step 2: Create SOS-adjusted transition matrix
transition_matrix_sos_offdef <- create_sos_adjusted_transition_matrix_offdef(simulated_schedule_lambda_offdef, kenpom_sos_offdef)

# Step 3: Compute stationary distribution
stationary_dist_sos_offdef <- compute_stationary_distribution_offdef(transition_matrix_sos_offdef)

# Step 4: Format results
stationary_df_sos_offdef <- data.frame(
  Team = names(stationary_dist_sos_offdef),
  Rating = stationary_dist_sos_offdef
) %>% arrange(desc(Rating))

# Step 5: Display
print(" SOS-adjusted rankings based on Offense/Defense Lambda Simulated Dataset:")
print(stationary_df_sos_offdef)

```
```{r}
# Step 1: Initialize Elo-based priors (flat 1500 for simulated)
initialize_elo_ratings_offdef <- function(teams) {
  ratings <- setNames(rep(1500, length(teams)), teams)
  return(ratings)
}

# Step 2: Get valid teams ( 3 games)
get_valid_teams_offdef <- function(schedule_data, min_games = 3) {
  team_game_counts <- schedule_data %>%
    group_by(Home) %>%
    summarise(Games_Home = n()) %>%
    full_join(schedule_data %>%
                group_by(Away) %>%
                summarise(Games_Away = n()), by = c("Home" = "Away")) %>%
    mutate(Total_Games = rowSums(select(., Games_Home, Games_Away), na.rm = TRUE)) %>%
    select(Home, Total_Games)

  valid_teams <- team_game_counts %>%
    filter(Total_Games >= min_games) %>%
    pull(Home)

  return(valid_teams)
}

# Step 3: Create Bayesian Transition Matrix
create_bayesian_transition_matrix_offdef <- function(schedule_data, elo_priors) {
  teams <- unique(c(schedule_data$Home, schedule_data$Away))
  n <- length(teams)
  team_index <- setNames(seq_len(n), teams)
  transition_matrix <- matrix(0, nrow = n, ncol = n, dimnames = list(teams, teams))

  prior_wins <- (elo_priors - min(elo_priors)) / (max(elo_priors) - min(elo_priors) + 1e-6) * 5 + 1
  prior_losses <- 6 - prior_wins

  for (i in 1:nrow(schedule_data)) {
    home_team <- schedule_data$Home[i]
    away_team <- schedule_data$Away[i]
    home_score <- schedule_data$home_team_score[i]
    away_score <- schedule_data$away_team_score[i]

    if (!(home_team %in% teams && away_team %in% teams)) next

    tie <- (home_score == away_score)

    if (!tie) {
      winner <- ifelse(home_score > away_score, home_team, away_team)
      loser <- ifelse(home_score > away_score, away_team, home_team)
      transition_matrix[team_index[loser], team_index[winner]] <-
        transition_matrix[team_index[loser], team_index[winner]] +
        (prior_wins[winner] + 1) / (prior_wins[winner] + prior_losses[winner] + 2)
    } else {
      transition_matrix[team_index[home_team], team_index[away_team]] <-
        transition_matrix[team_index[home_team], team_index[away_team]] +
        (prior_wins[away_team] + 0.5) / (prior_wins[away_team] + prior_losses[away_team] + 1)

      transition_matrix[team_index[away_team], team_index[home_team]] <-
        transition_matrix[team_index[away_team], team_index[home_team]] +
        (prior_wins[home_team] + 0.5) / (prior_wins[home_team] + prior_losses[home_team] + 1)
    }
  }

  row_sums <- rowSums(transition_matrix)
  transition_matrix <- sweep(transition_matrix, 1, row_sums, FUN = "/")
  transition_matrix[is.na(transition_matrix)] <- 0

  return(transition_matrix)
}

# Step 4: Compute Stationary Distribution
compute_stationary_distribution_offdef <- function(transition_matrix, valid_teams) {
  eig <- eigen(t(transition_matrix))
  vec <- Re(eig$vectors[, which.max(Re(eig$values))])
  dist <- vec / sum(vec)
  names(dist) <- rownames(transition_matrix)
  return(dist[names(dist) %in% valid_teams])
}

# Step 5: Run on Offense/Defense simulated dataset
teams_offdef <- unique(c(simulated_schedule_lambda_offdef$Home, simulated_schedule_lambda_offdef$Away))
elo_priors_offdef <- initialize_elo_ratings_offdef(teams_offdef)
valid_teams_offdef <- get_valid_teams_offdef(simulated_schedule_lambda_offdef)

bayesian_transition_matrix_offdef <- create_bayesian_transition_matrix_offdef(simulated_schedule_lambda_offdef, elo_priors_offdef)
bayesian_stationary_distribution_offdef <- compute_stationary_distribution_offdef(bayesian_transition_matrix_offdef, valid_teams_offdef)

# Step 6: Format and display
bayesian_rankings_offdef_df <- data.frame(
  Team = names(bayesian_stationary_distribution_offdef),
  Bayesian_Rating = bayesian_stationary_distribution_offdef
) %>% arrange(desc(Bayesian_Rating))

print(" Bayesian Rankings for Simulated Offense/Defense Lambda Dataset:")
print(bayesian_rankings_offdef_df)

```
```{r}
# Step 0: Load required library
library(dplyr)

# Step 1: Combine model outputs into a single DataFrame
rankings_df_lambda_offdef <- stationary_df_pagerank_offdef %>%
  select(Team, PageRank = Rating) %>%
  left_join(elo_ratings_sorted_lambda_offdef_df, by = "Team") %>%
  left_join(stationary_df_filtered_offdef %>% rename(Filtered_Transition = Rating), by = "Team") %>%
  left_join(stationary_df_winmargin_offdef %>% rename(WinMargin = Probability), by = "Team") %>%
  left_join(stationary_df_lowfavor_offdef %>% rename(Low_Favor_Ties = Probability), by = "Team") %>%
  left_join(stationary_df_sos_offdef %>% rename(Strength_Schedule = Rating), by = "Team") %>%
  left_join(bayesian_rankings_offdef_df, by = "Team") %>%
  na.omit()

# Step 2: Standardize model columns
rankings_df_lambda_offdef_scaled <- rankings_df_lambda_offdef %>%
  mutate(across(
    c(Elo_Rating, PageRank, Filtered_Transition, WinMargin,
      Low_Favor_Ties, Strength_Schedule, Bayesian_Rating),
    ~ as.numeric(scale(.x))
  ))

# Step 3: Ridge weights from real data (same as before)
ridge_alphas <- c(
  PageRank = 0.1814,
  Elo_Rating = 0.1532,
  Filtered_Transition = 0.0012,
  WinMargin = 0.0901,
  Low_Favor_Ties = 0.0829,
  Strength_Schedule = 0.1864,
  Bayesian_Rating = 0.1078
)

# Step 4: Compute ridge ranking score using real weights
rankings_df_lambda_offdef_scaled$Final_Ranking_Ridge <- with(rankings_df_lambda_offdef_scaled,
  Elo_Rating * ridge_alphas["Elo_Rating"] +
  PageRank * ridge_alphas["PageRank"] +
  Filtered_Transition * ridge_alphas["Filtered_Transition"] +
  WinMargin * ridge_alphas["WinMargin"] +
  Low_Favor_Ties * ridge_alphas["Low_Favor_Ties"] +
  Strength_Schedule * ridge_alphas["Strength_Schedule"] +
  Bayesian_Rating * ridge_alphas["Bayesian_Rating"]
)

final_ridge_lambda_offdef_df <- rankings_df_lambda_offdef_scaled %>%
  select(Team, Final_Ranking_Ridge) %>%
  left_join(lambda_truth_offdef, by = "Team") %>%
  filter(!is.na(Offense_Lambda) & !is.na(Defense_Lambda)) %>%
  mutate(
    Average_Lambda = (Offense_Lambda + Defense_Lambda) / 2,
    True_Off_Rank = rank(-Offense_Lambda, ties.method = "first"),
    True_Def_Rank = rank(-Defense_Lambda, ties.method = "first"),
    Average_Rank = (True_Off_Rank + True_Def_Rank) / 2
  ) %>%
  arrange(desc(Final_Ranking_Ridge)) %>%
  mutate(Ridge_Rank = row_number())

# View top 25 teams
ridge_vs_truth_df <- final_ridge_lambda_offdef_df %>%
  select(Team, Ridge_Rank, Final_Ranking_Ridge,
         Offense_Lambda, True_Off_Rank,
         Defense_Lambda, True_Def_Rank,
         Average_Lambda, Average_Rank)

print(" Ridge vs True Offense & Defense Rankings (With Average Lambda + Rank):")
print(head(ridge_vs_truth_df, 25))





```
```{r}
# Load required libraries
library(ggplot2)
library(dplyr)

team_game_counts_real <- all_schedule_data %>%
  group_by(Home) %>%
  summarise(Home_Games = n()) %>%
  full_join(
    all_schedule_data %>% group_by(Away) %>% summarise(Away_Games = n()),
    by = c("Home" = "Away")
  ) %>%
  mutate(Total_Games = rowSums(across(c(Home_Games, Away_Games)), na.rm = TRUE)) %>%
  filter(Total_Games > 3)

# Filter the real dataset
all_schedule_data_filtered <- all_schedule_data %>%
  filter(Home %in% team_game_counts_real$Home & Away %in% team_game_counts_real$Home)

team_game_counts_sim <- simulated_schedule_lambda_offdef %>%
  group_by(Home) %>%
  summarise(Home_Games = n()) %>%
  full_join(
    simulated_schedule_lambda_offdef %>%
      group_by(Away) %>%
      summarise(Away_Games = n()),
    by = c("Home" = "Away")
  ) %>%
  mutate(Total_Games = rowSums(across(c(Home_Games, Away_Games)), na.rm = TRUE)) %>%
  filter(Total_Games > 3)

# Filter simulated dataset
simulated_schedule_lambda_offdef_filtered <- simulated_schedule_lambda_offdef %>%
  filter(Home %in% team_game_counts_sim$Home & Away %in% team_game_counts_sim$Home)

```





```{r}
library(ggplot2)
library(dplyr)

# Step 1: Compute absolute score differentials
real_diffs <- all_schedule_data_filtered %>%
  mutate(score_diff = abs(home_team_score - away_team_score)) %>%
  pull(score_diff)

sim_diffs <- simulated_schedule_lambda_offdef_filtered %>%
  mutate(score_diff = abs(home_team_score - away_team_score)) %>%
  pull(score_diff)

# Step 2: Combine into one data frame for plotting
diff_df <- data.frame(
  score_diff = c(real_diffs, sim_diffs),
  Source = c(rep("Real", length(real_diffs)), rep("Simulated", length(sim_diffs)))
)

# Step 3: Create histogram
ggplot(diff_df, aes(x = score_diff, fill = Source)) +
  geom_histogram(binwidth = 1, alpha = 0.6, position = "identity", color = "black") +
  scale_fill_manual(values = c("Real" = "blue", "Simulated" = "orange")) +
  labs(
    title = "Histogram of Absolute Score Differentials",
    x = "|Score Differential|",
    y = "Count"
  ) +
  theme_minimal()

# Step 1: Get max goals per match
real_max_goals <- all_schedule_data_filtered %>%
  mutate(max_goals = pmax(home_team_score, away_team_score)) %>%
  pull(max_goals)

sim_max_goals <- simulated_schedule_lambda_offdef_filtered %>%
  mutate(max_goals = pmax(home_team_score, away_team_score)) %>%
  pull(max_goals)

# Step 2: Combine for plotting
max_goals_df <- data.frame(
  max_goals = c(real_max_goals, sim_max_goals),
  Source = c(rep("Real", length(real_max_goals)), rep("Simulated", length(sim_max_goals)))
)

# Step 3: Plot histogram
ggplot(max_goals_df, aes(x = max_goals, fill = Source)) +
  geom_histogram(binwidth = 1, alpha = 0.6, position = "identity", color = "black") +
  scale_fill_manual(values = c("Real" = "blue", "Simulated" = "orange")) +
  labs(
    title = "Histogram of Max Goals Scored in a Match",
    x = "Max Goals by One Team",
    y = "Count"
  ) +
  theme_minimal()


library(dplyr)
library(ggplot2)

# Step 1: Compute team win percentages from real data
real_results <- all_schedule_data_filtered %>%
  mutate(
    Home_Win = as.integer(home_team_score > away_team_score),
    Away_Win = as.integer(away_team_score > home_team_score)
  ) %>%
  select(Home, Away, Home_Win, Away_Win)

real_wins <- bind_rows(
  real_results %>% transmute(Team = Home, Win = Home_Win),
  real_results %>% transmute(Team = Away, Win = Away_Win)
)

real_win_pct <- real_wins %>%
  group_by(Team) %>%
  summarise(Win_Pct = mean(Win), Games = n())

# Step 2: Compute team win percentages from simulated data
sim_results <- simulated_schedule_lambda_offdef_filtered %>%
  mutate(
    Home_Win = as.integer(home_team_score > away_team_score),
    Away_Win = as.integer(away_team_score > home_team_score)
  ) %>%
  select(Home, Away, Home_Win, Away_Win)

sim_wins <- bind_rows(
  sim_results %>% transmute(Team = Home, Win = Home_Win),
  sim_results %>% transmute(Team = Away, Win = Away_Win)
)

sim_win_pct <- sim_wins %>%
  group_by(Team) %>%
  summarise(Win_Pct = mean(Win), Games = n())

# Step 3: Combine both for comparison
win_pct_combined <- bind_rows(
  real_win_pct %>% mutate(Source = "Real"),
  sim_win_pct %>% mutate(Source = "Simulated")
)

# Step 4: Plot histogram
ggplot(win_pct_combined, aes(x = Win_Pct, fill = Source)) +
  geom_histogram(binwidth = 0.05, position = "identity", alpha = 0.6, color = "black") +
  scale_fill_manual(values = c("Real" = "blue", "Simulated" = "orange")) +
  labs(
    title = "Histogram of Team Win Percentages",
    x = "Win Percentage",
    y = "Number of Teams"
  ) +
  theme_minimal()



```
```{r}
library(dplyr)

library(dplyr)
library(ggplot2)

# Step 1: Calculate real data absolute score diffs
real_diffs <- all_schedule_data_filtered %>%
  mutate(abs_diff = abs(home_team_score - away_team_score)) %>%
  pull(abs_diff)

# Step 2: Simulate 10 datasets and store their absolute score diffs
sim_list <- lapply(1:15, function(i) {
  # Re-draw new offensive/defensive lambdas
  off <- setNames(runif(length(unique_filtered_teams), 0.5, 4.5), unique_filtered_teams)
  def <- setNames(runif(length(unique_filtered_teams), 0.5, 4.5), unique_filtered_teams)

  # Simulate a new schedule
  simulated_df <- filtered_schedule %>%
    mutate(
      home_lambda = off[Home] / def[Away],
      away_lambda = off[Away] / def[Home],
      home_score = rpois(n(), lambda = home_lambda),
      away_score = rpois(n(), lambda = away_lambda),
      abs_diff = abs(home_score - away_score)
    ) %>%
    pull(abs_diff)

  return(simulated_df)
})

# Step 3: Combine all into one data frame with simulation ID
plot_data <- bind_rows(
  data.frame(Sim = "Sim_1", Score_Diff = sim_list[[1]]),
  data.frame(Sim = "Sim_2", Score_Diff = sim_list[[2]]),
  data.frame(Sim = "Sim_3", Score_Diff = sim_list[[3]]),
  data.frame(Sim = "Sim_4", Score_Diff = sim_list[[4]]),
  data.frame(Sim = "Sim_5", Score_Diff = sim_list[[5]]),
  data.frame(Sim = "Real",   Score_Diff = real_diffs),           # Insert real in the middle
  data.frame(Sim = "Sim_6", Score_Diff = sim_list[[6]]),
  data.frame(Sim = "Sim_7", Score_Diff = sim_list[[7]]),
  data.frame(Sim = "Sim_8", Score_Diff = sim_list[[8]]),
  data.frame(Sim = "Sim_9", Score_Diff = sim_list[[9]]),
  data.frame(Sim = "Sim_10", Score_Diff = sim_list[[10]]),
  data.frame(Sim = "Sim_11", Score_Diff = sim_list[[11]]),
  data.frame(Sim = "Sim_12", Score_Diff = sim_list[[12]]),
  data.frame(Sim = "Sim_13", Score_Diff = sim_list[[13]]),
  data.frame(Sim = "Sim_14", Score_Diff = sim_list[[14]])
)

# Optional: randomize the order of simulation labels
plot_data$Sim <- factor(plot_data$Sim, levels = sample(unique(plot_data$Sim)))

# Step 4: Boxplot (no colors, just anonymous comparison)
ggplot(plot_data, aes(x = Sim, y = Score_Diff)) +
  geom_boxplot(fill = "gray85", color = "black") +
  labs(
    title = "Visual Test: Real vs Simulated Score Differentials",
    x = "Dataset",
    y = "Absolute Score Differential"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

